{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Swiss EPR Transactions","text":"<p>Primary systems need to implement only a handful of transactions to connect to the Swiss Electronic Patient Record (EPR), i.e., for Patient and Document Mangement as well as for Authentication and Authorisation.</p> <p>The specification of the transactions are published in the ordinances of the law of the electronic patient dossier. There all details and options are found in the ordinances and the references therein.</p> <p>The pages explain the transactions by using samples recorded or adapted from transactions performed during the annual Swiss projectathon (September 2020). The pages shall be used as additional material to support developer and architects of primary systems to integrate to the Swiss EPR or plan to do so in the near future.</p> <p>Primary systems which wan't to test their implementation of the EPR transactions may either use the test systems provided by the communities or public available test systems. Currently there are two public test systems available:</p> <p>The Gazelle test environment provides the full set of tests available for EPR transactions. Tests may be used to verify the EPR compliance of each isolated transation.</p> <p>The EPR Playground is a public available installation of the EPR core infrastructure provided the BfH Bern. To reduce the gap for primary systems and ease the usage, the EPR playground dropped some of the security functions present in the Swiss EPR (e.g., mutual authentication, authorization). Up to this limitation the EPR playground supports the requirements of the Swiss EPR and vendors of primary systems may use the EPR playground to verify the transactions but also full use cases from patient registration to document exchange scenarios.</p> <p>Please see section below for details on the available public test systems.</p>"},{"location":"#patient-management","title":"Patient Management","text":"<p>PDQ V3 - Search for patient data using demographic data as search criteria</p> <p>PIX V3 Feed - Register patient data</p> <p>PIX V3 Query - Query the master patient ID and EPR-SPID for patients</p>"},{"location":"#document-management","title":"Document Management","text":"<p>Registry Stored Query - Get and display document metadata</p> <p>Retrieve Document Set - Get and display documents</p> <p>Provide and Register Document Set - Store documents in the EPR</p>"},{"location":"#authentication","title":"Authentication","text":"<p>Authenticate User - Authenticate a user</p> <p>IdP Renew - Renew a IdP assertion</p> <p>SSO Logout - Logout of authenticated user</p>"},{"location":"#authorization","title":"Authorization","text":"<p>Get X-User Assertion - Retrieve SAML 2.0 Assertions for authorization</p> <p>Provide X-User Assertion - Use SAML 2.0 Assertion in transactions to authorize access</p>"},{"location":"#audit","title":"Audit","text":"<p>Record Audit Event - Send audit events to the EPR</p>"},{"location":"#public-test-systems","title":"Public Test Systems","text":"<p>EPR Playground - Public available test system to test transaction messages and complex use cases.</p> <p>EPR Reference Environment - Public available test system to test isolated transaction for EPR compliance.</p>"},{"location":"#swiss-epr-exchange-formats","title":"Swiss EPR Exchange Formats","text":"<p>Exchange formats permit the simple exchange of data between different health professionals' information technology systems without the need for any special agreement. The specifications of the exchange formats define the technical, syntactic and semantic standards required for the consistent exchange of information. The objective is to standardize data exchange in the healthcare sector, especially with regard to the Swiss Electronic Patient Record (EPR).</p>"},{"location":"#emedication","title":"eMedication","text":"<p>Medication Card document - Complete overview about the current Medication from the patient.</p>"},{"location":"#evaccination","title":"eVaccination","text":"<p>Immunization Administration Document - Contains information on applied immunizations.</p>"},{"location":"#fhir-questionnaire","title":"FHIR Questionnaire","text":"<p>How to build a FHIR-Questionnaire - Contains information on how a FHIR Questionnaire can be built and displayed for an user to fill out.</p>"},{"location":"Atna/","title":"Audit logs","text":"<p>When executing most of the transactions with the EPR, there is a requirement to send an audit log to the community  describing who did what and when, on the client's side. The community also creates such an audit log, and both can be compared if the need arises.</p> <p>Since the audit logs may contain information about the transaction outcome, you have to wait for the community  response before creating the audit log.</p> <p>Warning</p> <p>You have to do your best efforts to send the audit logs, even if the transaction has failed (network issue or  error 500 for example).</p>"},{"location":"Atna/#specifications","title":"Specifications","text":"<p>The base specification of the <code>&lt;AuditMessage&gt;</code> format is given in DICOM PS3.15. Additional requirements are described in:</p> <ul> <li>For each transaction, in the 'Security Considerations' section of each transaction profile;</li> <li>In the IHE Audit Trail and Node Authentication (ATNA) Profile;</li> <li>In IHE ITI-20;</li> <li>In IHE ITI-40 \u00a73.40.4.2;</li> <li>In the Amendment 1 to Annex 5, \u00a71.5 and \u00a71.6.4.3.5.1;</li> </ul>"},{"location":"Atna/#basic-structure","title":"Basic structure","text":"<p>An audit log is simply wrapped in a <code>&lt;AuditMessage&gt;</code> element. No namespace is needed.</p> <p>The first child is a EventIdentification element that describes the transaction: <pre><code>&lt;EventIdentification EventActionCode=\"\u2605action_code\" EventDateTime=\"\u2605date_time\" EventOutcomeIndicator=\"\u2605outcome\"&gt;\n  &lt;EventID csd-code=\"\u2605transaction_code\" codeSystemName=\"DCM\" originalText=\"\u2605transaction_display\"/&gt;\n  &lt;EventTypeCode csd-code=\"\u2605type_code\" codeSystemName=\"IHE Transactions\" originalText=\"\u2605type_display\"/&gt;\n  &lt;PurposeOfUse csd-code=\"\u2605puo_code\" codeSystemName=\"2.16.756.5.30.1.127.3.10.5\" originalText=\"\u2605puo_display\" /&gt;\n&lt;/EventIdentification&gt;\n</code></pre> where:</p> <ul> <li><code>action_code</code>, <code>transaction_code</code>, <code>transaction_display</code>,<code>type_code</code> and <code>type_display</code> depend on the    transaction type and are defined in the IHE transaction profile, in the 'Security Considerations' section;</li> <li><code>date_time</code> is the date and time at which the transaction was made. It shall contain a timezone, and shall follow the    xsd:dateTime format;</li> <li><code>outcome</code> describes whether the transaction was successful or not: <code>0</code> is a success, <code>4</code> is a minor    failure, <code>8</code> is a serious failure and <code>12</code> is a major failure. The choice of the failure type is left to the    implementers;</li> <li><code>puo_code</code> and <code>puo_display</code> are the Purpose of Use code and display name, respectively. It is mandatory when the    transaction is secured by XUA; otherwise, the whole <code>&lt;PurposeOfUse&gt;</code> element shall be omitted.</li> </ul> <p>Then, two ActiveParticipants describe the source and destination participants.</p> ActiveParticipant sourceActiveParticipant destination <p>The first ActiveParticipant describes the source participant, which often is the one that has sent the  transaction (but not always). It has the following content: <pre><code>&lt;ActiveParticipant UserID=\"\u2605user_id\" AlternativeUserID=\"\u2605alt_user_id\" NetworkAccessPointID=\"\u2605nap_id\" NetworkAccessPointTypeCode=\"\u2605nap_type\" UserIsRequest=\"true\"&gt;\n  &lt;RoleIDCode csd-code=\"110153\" codeSystemName=\"DCM\" originalText=\"Source Role ID\"/&gt;\n&lt;/ActiveParticipant&gt;\n</code></pre> where:</p> <ul> <li><code>user_id</code> is required and can be filled as you want. It can be a process ID, a login name, or other identifiers;</li> <li><code>alt_user_id</code> is the process ID as used within the local operating system in the local system logs;</li> <li><code>nap_id</code> is the DNS name or IP address of the source;</li> <li><code>nap_type</code> is <code>1</code> for machine (DNS) name, <code>2</code> for IP address.</li> </ul> <p>Other attributes are optional.</p> <p>The second ActiveParticipant describes the destination participant, which often is the one that has received the  transaction (but not always). It has the following content: <pre><code>&lt;ActiveParticipant UserID=\"\u2605user_id\" NetworkAccessPointID=\"\u2605nap_id\" NetworkAccessPointTypeCode=\"\u2605nap_type\" UserIsRequest=\"false\"&gt;\n  &lt;RoleIDCode csd-code=\"110152\" codeSystemName=\"DCM\" originalText=\"Destination Role ID\"/&gt;\n&lt;/ActiveParticipant&gt;\n</code></pre> where:</p> <ul> <li><code>user_id</code> is the SOAP endpoint URI;</li> <li><code>nap_id</code> is the DNS name or IP address of the destination;</li> <li><code>nap_type</code> is <code>1</code> for machine (DNS) name, <code>2</code> for IP address.</li> </ul> <p>Other attributes are optional.</p> <p>Warning</p> <p>In some transactions such as ITI-43, the source and destination participants are reversed. Always check the IHE  specifications for the correct order. The participant \"server\" is the one having the \"SOAP endpoint URI\", the  participant \"client\" is the one having the \"process ID\".</p> <p>Following that is the <code>&lt;AuditSourceIdentification&gt;</code> element. It contains the following: <pre><code>&lt;AuditSourceIdentification AuditSourceID=\"\u2605source\" AuditEnterpriseSiteID=\"\u2605oid\" /&gt;\n</code></pre> where <code>oid</code> is required by the Amendment 1 to Annex 5 (\u00a71.5.2) and must be an OID of your OID hierarchy. Please ask your community if it has requirements about the use of this OID. The <code>source</code> value is required by the standard, but its value choice is left to the implementers; it should contain an \"Identifier of the source\". You can copy the <code>oid</code> value if you want.</p>"},{"location":"Atna/#requirements-for-transactions-secured-by-xua","title":"Requirements for transactions secured by XUA","text":"<p>If the transaction is secured by XUA (like ITI-18, ITI-41, ITI-43), then additional ActiveParticipants shall be  specified to describe the authenticated participant of the transaction.</p> First ActiveParticipantSecond ActiveParticipantThird ActiveParticipant <p>The first additional ActiveParticipant is described in IHE ITI-40, \u00a73.40.4.2. It is required for all roles. It shall contain: <pre><code>&lt;ActiveParticipant UserID=\"\u2605user_id\" UserName=\"\u2605alias&amp;lt;\u2605user@\u2605issuer&amp;gt;\" UserIsRequest=\"false\" /&gt;\n</code></pre> where:</p> <ul> <li><code>user_id</code> is required and can be filled as you want. It can be a process ID, a login name, or other identifiers;</li> <li><code>alias</code> (optional) is the SAML Assertion's <code>Subject/NameID/@SPProvidedID</code> attribute;</li> <li><code>user</code> (required) is the SAML Assertion's <code>Subject/NameID</code> content;</li> <li><code>issuer</code> (required) is the SAML Assertion's <code>Issuer</code> content.</li> </ul> <p>The other attributes and subject role specification are optional.</p> <p>The second additional ActiveParticipant is described in the Amendment 1 to Annex 5, \u00a71.6.4.3.5.1. It is required for all roles. It shall contain: <pre><code>&lt;ActiveParticipant UserID=\"\u2605user_id\" UserName=\"\u2605user_name\" UserIsRequestor=\"false\"&gt;\n    &lt;RoleIDCode csd-code=\"\u2605code\" codeSystemName=\"2.16.756.5.30.1.127.3.10.6\" originalText=\"\u2605display\"/&gt;\n&lt;/ActiveParticipant&gt;\n</code></pre> where:</p> <ul> <li><code>user_id</code> (required) is the SAML Assertion's <code>Subject/NameID</code> content;</li> <li><code>user_name</code> (required) is the SAML Assertion's <code>AttributeStatement/Attribute[@Name=\"urn:oasis:names:tc:xspa:1.0:subject:subject-id\"]/AttributeValue</code> content;</li> <li><code>code</code> (required) is the SAML Assertion's <code>AttributeStatement/Attribute[@Name=\"urn:oasis:names:tc:xacml:2.0:subject:role\"]/AttributeValue/Role/@code</code> attribute.</li> </ul> <p>Other attributes are optional.</p> <p>The third additional ActiveParticipant is described in the Amendment 1 to Annex 5, \u00a71.6.4.3.5.1. It is only required for assistants and technical users. It shall contain: <pre><code>&lt;ActiveParticipant UserID=\"\u2605user_id\" UserName=\"\u2605user_name\" UserIsRequest=\"false\"&gt;\n    &lt;RoleIDCode csd-code=\"\u2605code\" codeSystemName=\"2.16.756.5.30.1.127.3.10.6\" originalText=\"\u2605display\" /&gt;\n&lt;/ActiveParticipant&gt;\n</code></pre> where:</p> <ul> <li><code>user_id</code> (required) is the SAML Assertion's <code>Subject/SubjectConfirmation/NameID</code> content;</li> <li><code>user_name</code> (required) is the SAML Assertion's <code>Subject/SubjectConfirmation/SubjectConfirmationData/AttributeStatement/Attribute[@Name=\"urn:oasis:names:tc:xspa:1.0:subject:subject-id\"]/AttributeValue</code> content;</li> <li><code>code</code> (required) is either <code>TCU</code> or <code>ASS</code>.</li> </ul>"},{"location":"Atna/#special-parts","title":"Special parts","text":"<p>Some ParticipantObjectIdentification elements may be used to include additional details about the query content.</p>"},{"location":"Atna/#query","title":"Query","text":"<p>For ITI-18 transaction, the query content has to be included in the <code>&lt;ParticipantObjectIdentification&gt;</code> element: <pre><code>&lt;ParticipantObjectIdentification ParticipantObjectID=\"\u2605participant_object_id\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"24\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"\u2605transaction_code\" codeSystemName=\"IHE Transactions\" originalText=\"\u2605transaction_display\" /&gt;\n  &lt;ParticipantObjectQuery&gt;\u2605query_b64&lt;/ParticipantObjectQuery&gt;\n  &lt;ParticipantObjectDetail type=\"QueryEncoding\" value=\"\u2605query_encoding_b64\" /&gt;\n&lt;/ParticipantObjectIdentification&gt;\n</code></pre> where:</p> <ul> <li><code>participant_object_id</code> is the Stored Query ID for ITI-18, or optional for ITI-45 and ITI-47;</li> <li><code>transaction_code</code> and <code>transaction_display</code> are the same as in <code>EventIdentification/EventID</code>;</li> <li><code>query_b64</code> is the XML representation of a part of the query, base64-encoded:<ul> <li>For ITI-18, the <code>AdhocQueryRequest</code>;</li> <li>For ITI-45 and ITI-47, the <code>QueryByParameter</code> segment of the query;</li> </ul> </li> <li><code>query_encoding_b64</code> is the query encoding, encoded in base64. Usually <code>VVRGLTg=</code> (UTF-8).</li> </ul> <p>For ITI-18 transactions, an additional <code>&lt;ParticipantObjectIdentification&gt;</code> is required inside, if the  homeCommunityID is specified in the query: <pre><code>&lt;ParticipantObjectDetail type=\"urn:ihe:iti:xca:2010:homeCommunityId\" value=\"\u2605home_community_id_b64\" /&gt;\n</code></pre> where <code>home_community_id_b64</code> is the value of the homeCommunityId, base64-encoded.</p>"},{"location":"Atna/#patient","title":"Patient","text":"<p><pre><code>&lt;ParticipantObjectIdentification ParticipantObjectID=\"\u2605patient_id\" ParticipantObjectTypeCode=\"1\" ParticipantObjectTypeCodeRole=\"1\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"2\" codeSystemName=\"RFC-3881\" originalText=\"Patient Number\" /&gt;\n&lt;/ParticipantObjectIdentification&gt;\n</code></pre> where <code>patient_id</code> is the patient identifier encoded in HL7 CX format (e.g. <code>value^^^&amp;1.2.3&amp;ISO</code>).</p>"},{"location":"Atna/#submission-set","title":"Submission set","text":"<p>For ITI-41 requests, a <code>&lt;ParticipantObjectIdentification&gt;</code> is required to describe the Submission Set: <pre><code>&lt;ParticipantObjectIdentification ParticipantObjectID=\"\u2605submission_set_unique_id\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"20\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd\" originalText=\"submission set classificationNode\" codeSystemName=\"IHE XDS Metadata\"/&gt;\n&lt;/ParticipantObjectIdentification&gt;\n</code></pre> where <code>submission_set_unique_id</code> is the URN-encoded Submission Set unique ID.</p>"},{"location":"Atna/#document","title":"Document","text":"<p>For ITI-43 transactions, a <code>&lt;ParticipantObjectIdentification&gt;</code> is required to describe the document to be  retrieved: <pre><code>&lt;ParticipantObjectIdentification ParticipantObjectID=\"\u2605document_unique_id\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"3\" ParticipantObjectSensitivity=\"\u2605confidentiality_code\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"9\" codeSystemName=\"RFC-3881\" originalText=\"Report Number\"/&gt;\n  &lt;ParticipantObjectDetail type=\"Repository Unique Id\" value=\"\u2605repo_unique_id_b64\"/&gt;\n&lt;/ParticipantObjectIdentification&gt;\n</code></pre> where:</p> <ul> <li><code>document_unique_id</code> is the document unique ID;</li> <li><code>repo_unique_id_b64</code> is the repository unique ID;</li> <li><code>confidentiality_code</code> is the document confidentiality code, if known. The format is HL7v2 CE with the code   system OID as the code (e.g.: <code>1051000195109^normal^2.16.840.1.113883.6.96</code>).</li> </ul> <p>If the home community ID is known, another ParticipantObjectDetail is required inside:  <code>&lt;ParticipantObjectDetail type=\"ihe:homeCommunityID\" value=\"\u2605home_community_id_b64\"/&gt;</code>. The value must be base64-encoded.</p>"},{"location":"Atna/#requirements-summary","title":"Requirements summary","text":"ActiveParticipant ParticipantObjectIdentification Transaction EventIdentification Source Destination XUA Query Patient Submission Set Document ITI-18\u2705\u2705\u2705\u2705\u2705\u2705\u274c\u274c ITI-41\u2705\u2705\u2705\u2705\u274c\u2705\u2705\u274c ITI-43\u2705\u2705\u2705\u2705\u274c\u2705\u274c\u2705 ITI-44\u2705\u2705\u2705\u274c\u274c\u2705\u274c\u274c ITI-45\u2705\u2705\u2705\u274c\u2705\u2705\u274c\u274c ITI-47\u2705\u2705\u2705\u274c\u2705\u2705\u274c\u274c ITI-57\u2705\u2705\u2705\u2705\u274c\u2705\u2705\u274c"},{"location":"Atna/#sending-an-audit-log","title":"Sending an audit log","text":"<p>The audit log shall be sent to the community as a syslog message either over TCP (with TLS). The relevant specifications are:</p> <ul> <li>RFC 5424: The Syslog Protocol for information about the syslog message format;</li> <li>RFC 5425: Transport Layer Security (TLS) Transport Mapping for Syslog    which formalizes sending Syslog messages over TCP;</li> </ul> <p>The choice of values in the Syslog headers is left to the implementers.</p> <p>An example of a Syslog message sent over TCP is: <pre><code>2027 &lt;85&gt;1 2024-06-25T13:47:57.600Z mag-cara-695f6f7f49-zsxxw IPF 1 IHE+RFC-3881 - \ufeff&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;AuditMessage&gt;&lt;EventIdentification EventActionCode=\"E\" EventDateTime=\"2024-06-25T13:47:57.598829760Z\" EventOutcomeIndicator=\"12\"&gt;&lt;EventID csd-code=\"110112\" codeSystemName=\"DCM\" originalText=\"Query\" /&gt;&lt;EventTypeCode csd-code=\"ITI-67\" codeSystemName=\"IHE Transactions\" originalText=\"Mobile Document Reference Query\" /&gt;&lt;/EventIdentification&gt;&lt;ActiveParticipant UserID=\"/mag-cara/fhir/DocumentReference\" UserIsRequestor=\"true\" NetworkAccessPointID=\"147.87.210.77\" NetworkAccessPointTypeCode=\"2\"&gt;&lt;RoleIDCode csd-code=\"110153\" codeSystemName=\"DCM\" originalText=\"Source Role ID\" /&gt;&lt;/ActiveParticipant&gt;&lt;ActiveParticipant UserID=\"https://test.ahdis.ch/mag-cara/fhir/DocumentReference\" AlternativeUserID=\"1\" UserIsRequestor=\"false\" NetworkAccessPointID=\"10.28.2.28\" NetworkAccessPointTypeCode=\"2\"&gt;&lt;RoleIDCode csd-code=\"110152\" codeSystemName=\"DCM\" originalText=\"Destination Role ID\" /&gt;&lt;/ActiveParticipant&gt;&lt;AuditSourceIdentification AuditEnterpriseSiteID=\"1.3.6.1.4.1.21367.2017.2.7.109\" AuditSourceID=\"IPF\"&gt;&lt;AuditSourceTypeCode csd-code=\"9\" codeSystemName=\"DCM\" originalText=\"Other\" /&gt;&lt;/AuditSourceIdentification&gt;&lt;ParticipantObjectIdentification ParticipantObjectID=\"urn:oid:1.1.1.99.1|215503a0-11d2-4197-822a-053791ab5a8e\" ParticipantObjectTypeCode=\"1\" ParticipantObjectTypeCodeRole=\"1\"&gt;&lt;ParticipantObjectIDTypeCode csd-code=\"2\" codeSystemName=\"RFC-3881\" originalText=\"Patient Number\" /&gt;&lt;/ParticipantObjectIdentification&gt;&lt;ParticipantObjectIdentification ParticipantObjectID=\"MobileDocumentReferenceQuery\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"24\"&gt;&lt;ParticipantObjectIDTypeCode csd-code=\"ITI-67\" codeSystemName=\"IHE Transactions\" originalText=\"Mobile Document Reference Query\" /&gt;&lt;ParticipantObjectQuery&gt;c3RhdHVzPWN1cnJlbnQmcGF0aWVudC5pZGVudGlmaWVyPXVybjpvaWQ6MS4xLjEuOTkuMXwyMTU1MDNhMC0xMWQyLTQxOTctODIyYS0wNTM3OTFhYjVhOGU=&lt;/ParticipantObjectQuery&gt;&lt;/ParticipantObjectIdentification&gt;&lt;/AuditMessage&gt;\n</code></pre></p> <p>Note</p> <p>Notice the UTF-8 BOM at the beginning of the payload (just before <code>&lt;?xml</code>). It is required by the syslog protocol for UTF-8 messages. 2027 is the number of bytes in the following message (2025 characters + 2 extra bytes for  the BOM).</p>"},{"location":"AuthenticateUser/","title":"Authenticate User","text":"<p>Transaction to authenticate a user at a identity provider certified for the Swiss EPR. Primary systems shall use this transaction to retrieve a IdP assertion. The IdP assertion is required to retrieve the XUA Assertion to be used with EPR transactions.</p>"},{"location":"AuthenticateUser/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction to retrieve an IdP assertion authentication the user for the access to the Swiss EPR.</p> <p>The requirements for the transaction are defined in Annex 8 of the ordinances of the Swiss EPR.</p> <p>The EPR requires primary systems to implement authentication as described in the SAML 2.0 specification family, i.e.,</p> <ul> <li>Assertions and Protocols for the OASIS Security Assertion Markup Language (SAML) V2.0.</li> <li>Bindings for the OASIS Security Assertion Markup Language (SAML) V2.0.</li> <li>Profiles for the OASIS Security Assertion Markup Language (SAML) V2.0.</li> </ul> <p>Primary systems do need implement all the bindings and profiles supported by the SAML 2.0 specification family.</p> <p>In the Swiss EPR the following bindings are required:</p> <ul> <li>HTTP POST Binding.</li> <li>HTTP Artifact Binding.</li> <li>SAML SOAP Binding.    </li> </ul> <p>In the Swiss EPR the following profiles are required:</p> <ul> <li>Web Browser SSO Profile.</li> <li>Single Logout Profile.</li> </ul> <p>The usage of the profiles and binding used to authenticate user for the Swiss EPR is described in the following sections.</p>"},{"location":"AuthenticateUser/#transactions","title":"Transactions","text":"<p>The transaction to authenticate a user for the access to the Swiss EPR is a multi-step flow consisting of HTTP Post and SOAP Web Service calls, as displayed in the following figure:</p> <p></p> <p>Figure 1: Authentication Sequence Diagram</p> <p>The sequence consists of the following steps, each using assigned transaction messages:</p> <ul> <li>[01 .. 04] The user (claimant) is redirected to the identity provider via the user agent (browser) with a SAML 2.0 AuthnRequest message.</li> <li>[05] The user (claimant) authenticates at the identity provider with her authentication means.</li> <li>[06 .. 07] The identity provider responds a SAML 2.0 artifact in a HTTP redirect to the primary system (relying party).  </li> <li>[08] The primary system sends a ArtifactResolve message to resolve the SAML artifact to the SAML 2 IdP Assertion via the SOAP backchannel.</li> <li>[09] The IdP responds the IdP Assertion in the ArtifactResponse message.</li> </ul>"},{"location":"AuthenticateUser/#authentication-request","title":"Authentication Request","text":"<p>The transaction shall be performed by the primary system when the user aims to access the EPR. The primary system shall redirect the user agent (browser) to the IdP authentication endpoint with a AuthnRequest message as defined in Assertions and Protocols for the OASIS Security Assertion Markup Language (SAML) V2.0.</p> <p>When the user is authenticated by the IdP, the IdP responds with a HTTP redirect to the registered endpoint of the primary system as specified in Bindings for the OASIS Security Assertion Markup Language (SAML) V2.0.</p>"},{"location":"AuthenticateUser/#message-semantics","title":"Message Semantics","text":""},{"location":"AuthenticateUser/#request-message","title":"Request Message","text":"<p>The following snippet is taken from a sample request recorded during the EPR projectathon in September 2020. Some elements were ommitted to increase readability. The raw request file may be found here.</p> <p>The AuthnRequest conveys the following information to be set by the primary system:</p> <ul> <li>ID: A unique ID of the request message (line 7 in the example below).</li> <li>Issuer: A ID of the primary system as URL (line 9 in the example below).</li> <li>SignedInfo: Signature metadata and the digest value used for the signature.</li> <li>SignatureValue: The signature of the request (line 23 in the example below).</li> <li>X509Certificate: The X509 certificate used to sign the request (line 26 in the example below).</li> </ul> 04_AuthnRequest.xml<pre><code>&lt;AuthnRequest\n xmlns=\"urn:oasis:names:tc:SAML:2.0:protocol\"\n AssertionConsumerServiceURL=\"https://epdtest.mycompany.local:8549/ACS\"\n IssueInstant=\"2020-09-24T13:19:25.208+02:00\"\n Destination=\"https://fed.idp.ch:443/saml/3.0/idp/\"\n ProtocolBinding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\"\n ID=\"SAML-CD88202A-FE57-11EA-800A-ACB5C93CFFF0\"\n Version=\"2.0\"&gt;\n &lt;Issuer xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"&gt;https://epdtest.mycompany.local&lt;/Issuer&gt;\n &lt;Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n  &lt;SignedInfo&gt;\n   &lt;CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n   &lt;SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/&gt;\n   &lt;Reference URI=\"#SAML-CD88202A-FE57-11EA-800A-ACB5C93CFFF0\"&gt;\n    &lt;Transforms&gt;\n     &lt;Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n     &lt;Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n    &lt;/Transforms&gt;\n    &lt;DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/&gt;\n    &lt;DigestValue&gt;TdN8cZ5mvY7pOsrpOK0h+YlnvlhOOHYecaBN59yH4w0=&lt;/DigestValue&gt;\n   &lt;/Reference&gt;\n  &lt;/SignedInfo&gt;\n  &lt;SignatureValue&gt;&lt;!-- omitted for brevity --&gt;&lt;/SignatureValue&gt;\n  &lt;KeyInfo&gt;\n   &lt;X509Data&gt;\n    &lt;X509Certificate&gt;&lt;!-- omitted for brevity --&gt;&lt;/X509Certificate&gt;\n   &lt;/X509Data&gt;\n  &lt;/KeyInfo&gt;\n &lt;/Signature&gt;\n &lt;NameIDPolicy Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" AllowCreate=\"true\"/&gt;\n&lt;/AuthnRequest&gt;\n</code></pre>"},{"location":"AuthenticateUser/#response-message","title":"Response Message","text":"<p>The following snippet is taken from a sample request recorded during the EPR projectathon in September 2020. It conveys two parameter to be used by the primary system:</p> <ul> <li>SAMLart: The SAML artifact to be used in the ArtifactResolve request (see section below).</li> <li>RelayState: A unique identifier of the conversation, the primary system initially sent with the Authentication Request.</li> </ul> <pre><code>https://epdtest.mycompany.local:8549/ACS?SAMLart=AAQAAOjXNPPr%2Fr7FO5WpiZ%2B2vAl5KMFibkRaAGwIkwXh%2Bo7DgsG2LMDE58c%3D&amp;RelayState=idp%23468\n</code></pre>"},{"location":"AuthenticateUser/#transport-protocol","title":"Transport Protocol","text":"<p>The transaction uses front channel HTTP communication via the user agent (browser).</p>"},{"location":"AuthenticateUser/#security-requirements","title":"Security Requirements","text":"<p>The transactions shall use TLS secured transports (HTTPS) to ensure data privacy and with server authentication.</p>"},{"location":"AuthenticateUser/#artifact-resolve","title":"Artifact Resolve","text":"<p>The transaction shall be performed by the primary system to exchange the artifact to a SAML 2.0 IdP Assertion.</p> <p>The primary system shall use the SOAP backchannel with an ArtifactResolve request message as defined in Assertions and Protocols for the OASIS Security Assertion Markup Language (SAML) V2.0.</p> <p>The IdP server responds the SAML 2.0 IdP Assertion of the authenticated user.</p>"},{"location":"AuthenticateUser/#message-semantics_1","title":"Message Semantics","text":""},{"location":"AuthenticateUser/#request-message_1","title":"Request Message","text":"<p>The following snippet is taken from a sample request recorded during the EPR projectathon in September 2020. Some elements are omitted to increase readability. The raw request file may be found here.</p> <p>The ArtifactResolve conveys the following information to be set by the primary system:</p> <ul> <li>Issuer: A ID of the primary system as URL (line 4 in the example below).</li> <li>SignedInfo: Signature metadata and the digest value used for the signature.</li> <li>SignatureValue: The signature of the request (line 18 in the example below).</li> <li>X509Certificate: The X509 certificate used to sign the request (line 21 in the example below).</li> <li>Artifact: The artifact as retrieved from the Authentication Request transaction (line 25).</li> </ul> 08_ArtifactResolve_raw.xml<pre><code>&lt;Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n  &lt;Body&gt;\n   &lt;ArtifactResolve xmlns=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"SAML-D76F77F0-FE57-11EA-8007-9DB4CDFD82EF\" Version=\"2.0\" IssueInstant=\"2020-09-24T13:19:41.822+02:00\" Destination=\"https://fed.idp.ch/nevisauth/services/artifactresolution\"&gt;\n    &lt;Issuer xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"&gt;https://epdtest.mycompany.local&lt;/Issuer&gt;\n    &lt;Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n     &lt;SignedInfo&gt;\n      &lt;CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n      &lt;SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/&gt;\n      &lt;Reference URI=\"#SAML-D76F77F0-FE57-11EA-8007-9DB4CDFD82EF\"&gt;\n       &lt;Transforms&gt;\n        &lt;Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n        &lt;Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n       &lt;/Transforms&gt;\n       &lt;DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/&gt;\n       &lt;DigestValue&gt;R+bMs3semvJBgae/3wnNVZp0eTpIhQQK4+S2KqRj1bM=&lt;/DigestValue&gt;\n      &lt;/Reference&gt;\n     &lt;/SignedInfo&gt;s\n     &lt;SignatureValue&gt; &lt;!-- omitted for brevity --&gt; &lt;/SignatureValue&gt;\n     &lt;KeyInfo&gt;\n      &lt;X509Data&gt;\n       &lt;X509Certificate&gt; &lt;!-- omitted for brevity --&gt; &lt;/X509Certificate&gt;\n      &lt;/X509Data&gt;\n     &lt;/KeyInfo&gt;\n    &lt;/Signature&gt;\n    &lt;Artifact&gt;AAQAAOjXNPPr/r7FO5WpiZ+2vAl5KMFibkRaAGwIkwXh+o7DgsG2LMDE58c=&lt;/Artifact&gt;\n   &lt;/ArtifactResolve&gt;\n  &lt;/Body&gt;\n &lt;/Envelope&gt;\n</code></pre>"},{"location":"AuthenticateUser/#response-message_1","title":"Response Message","text":"<p>The following snippet is taken from a sample response recorded during the EPR projectathon in September 2020. Some elements are omitted to increase readability. The raw version may be found here.</p> <p>The ArtifactResponse conveys the following information which shall be evaluated by the primary system:</p> <ul> <li>Issuer: A ID of the primary system as URL (line 6 in the example below).</li> <li>SignedInfo: Signature metadata and the digest value used for the signature.</li> <li>SignatureValue: The signature of the request (line 26 in the example below) which shall be validated by the    primary system.</li> <li>X509Certificate: The X509 certificate used to sign the request (line 29 in the example below).</li> <li>assertion: The IdP assertion conveying the attributes of the authenticated user.  </li> </ul> 09_ArtifactResponse_raw.xml<pre><code>&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n  &lt;SOAP-ENV:Body&gt;\n    &lt;saml2p:ArtifactResponse\n      xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\"\n      xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\n      ID=\"ArtifactResponse_bf738b81c935d2c2f47604e01388553c2407ac40\"\n      InResponseTo=\"SAML-D76F77F0-FE57-11EA-8007-9DB4CDFD82EF\"\n      IssueInstant=\"2020-09-24T11:19:42.030Z\"\n      Version=\"2.0\"&gt;\n      &lt;saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\"&gt;fed.idp.ch&lt;/saml2:Issuer&gt;\n      &lt;ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n        &lt;ds:SignedInfo&gt;\n          &lt;ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n          &lt;ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/&gt;\n          &lt;ds:Reference URI=\"#ArtifactResponse_bf738b81c935d2c2f47604e01388553c2407ac40\"&gt;\n            &lt;ds:Transforms&gt;\n              &lt;ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n              &lt;ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"&gt;\n                &lt;ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"xs\"/&gt;\n              &lt;/ds:Transform&gt;\n            &lt;/ds:Transforms&gt;\n            &lt;ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/&gt;\n            &lt;ds:DigestValue&gt;1RZPbh508clAQoKhxnQZEenNFyg=&lt;/ds:DigestValue&gt;\n          &lt;/ds:Reference&gt;\n        &lt;/ds:SignedInfo&gt;\n        &lt;ds:SignatureValue&gt;&lt;!-- omitted for brevity --&gt;&lt;/ds:SignatureValue&gt;\n        &lt;ds:KeyInfo&gt;\n          &lt;ds:X509Data&gt;\n            &lt;ds:X509SKI&gt;gYMVdgdR5LG/983GRTJIch0a+zU=&lt;/ds:X509SKI&gt;\n          &lt;/ds:X509Data&gt;\n        &lt;/ds:KeyInfo&gt;\n      &lt;/ds:Signature&gt;\n      &lt;saml2p:Status&gt;\n        &lt;saml2p:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/&gt;\n      &lt;/saml2p:Status&gt;\n      &lt;saml2p:Response\n        xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\"\n        Destination=\"https://epdtest.mycompany.com\"\n        ID=\"Response_ef5597568f1bc48233cac63c5a51ca3026566d59\"\n        InResponseTo=\"SAML-CD88202A-FE57-11EA-800A-ACB5C93CFFF0\"\n        IssueInstant=\"2020-09-24T11:19:41.634Z\"\n        Version=\"2.0\"&gt;\n        &lt;saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\"&gt;fed.idp.ch&lt;/saml2:Issuer&gt;\n        &lt;saml2p:Status&gt;\n          &lt;saml2p:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/&gt;\n        &lt;/saml2p:Status&gt;\n        &lt;saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"Assertion_4f962f0ff6d14c9ea77726da3c2c88bb76fcae67\" IssueInstant=\"2020-09-24T11:19:41.633Z\" Version=\"2.0\"&gt;\n</code></pre> <p>The following snippet shows an example of a IdP Assertion conveyed with the response.</p> <p>The primary system must keep the IdP Assertion in memory to use it to authenticate the Get X-User Assertion transaction.</p> <p>The primary system is not required to analyze the IdP Assertion further, but may extract the following information from the assertion:</p> <ul> <li>NameID : This element conveys the user ID assigned by IdP. Primary systems may use it to locally authenticate the user in the primary system.</li> <li>NotBefore and NotOnOrAfter: The lifetime of the IdP assertion.</li> <li>AttributeStatement: IdP shall provide user attributes in the AttributeStatement child elements. At least the givenname, surname, gender and dateofbirth must be provided. Optional fileds may be provided. The optional fields cover the GLN of the healthcare professional and other attributes, the primary system may use internally to identify the authenticated user.</li> </ul> <pre><code>        &lt;saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"Assertion_4f962f0ff6d14c9ea77726da3c2c88bb76fcae67\" IssueInstant=\"2020-09-24T11:19:41.633Z\" Version=\"2.0\"&gt;\n          &lt;saml2:Issuer&gt;fed.idp.ch&lt;/saml2:Issuer&gt;\n          &lt;ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n            &lt;ds:SignedInfo&gt;\n              &lt;ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n              &lt;ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/&gt;\n              &lt;ds:Reference URI=\"#Assertion_4f962f0ff6d14c9ea77726da3c2c88bb76fcae67\"&gt;\n                &lt;ds:Transforms&gt;\n                  &lt;ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n                  &lt;ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"&gt;\n                    &lt;ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"xs\"/&gt;\n                  &lt;/ds:Transform&gt;\n                &lt;/ds:Transforms&gt;\n                &lt;ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/&gt;\n                &lt;ds:DigestValue&gt;P/I9Ym+p/Zzs0ANXHmAjqZcuBp2FJ75j6oCM6Gd0bVg=&lt;/ds:DigestValue&gt;\n              &lt;/ds:Reference&gt;\n            &lt;/ds:SignedInfo&gt;\n            &lt;ds:SignatureValue&gt;&lt;!-- omitted for brevity --&gt;&lt;/ds:SignatureValue&gt;\n            &lt;ds:KeyInfo&gt;\n              &lt;ds:X509Data&gt;\n                &lt;ds:X509Certificate&gt;&lt;!-- omitted for brevity --&gt;&lt;/ds:X509Certificate&gt;\n              &lt;/ds:X509Data&gt;\n            &lt;/ds:KeyInfo&gt;\n          &lt;/ds:Signature&gt;\n          &lt;saml2:Subject&gt;\n            &lt;saml2:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\"&gt;pjtt31&lt;/saml2:NameID&gt;\n            &lt;saml2:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"&gt;\n              &lt;saml2:SubjectConfirmationData InResponseTo=\"SAML-CD88202A-FE57-11EA-800A-ACB5C93CFFF0\" NotOnOrAfter=\"2020-09-24T12:19:41.634Z\" Recipient=\"https://epdtest.mycompany.com\"/&gt;\n            &lt;/saml2:SubjectConfirmation&gt;\n          &lt;/saml2:Subject&gt;\n          &lt;saml2:Conditions NotBefore=\"2020-09-24T11:19:41.633Z\" NotOnOrAfter=\"2020-09-24T12:09:41.633Z\"&gt;\n            &lt;saml2:AudienceRestriction&gt;\n              &lt;saml2:Audience&gt;https://epdtest.mycompany.com&lt;/saml2:Audience&gt;\n            &lt;/saml2:AudienceRestriction&gt;\n          &lt;/saml2:Conditions&gt;\n          &lt;saml2:AuthnStatement AuthnInstant=\"2020-09-24T11:19:41.633Z\" SessionNotOnOrAfter=\"2020-09-24T13:19:41.633Z\"&gt;\n            &lt;saml2:AuthnContext&gt;\n              &lt;saml2:AuthnContextClassRef&gt;urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified&lt;/saml2:AuthnContextClassRef&gt;\n            &lt;/saml2:AuthnContext&gt;\n          &lt;/saml2:AuthnStatement&gt;\n          &lt;saml2:AttributeStatement&gt;\n            &lt;!-- other vendor specific attributes omitted for brevity --&gt;\n            &lt;saml2:Attribute Name=\"GLN\" NameFormat=\"urn:oasis:names:tc:ebcore:partyid-type:DataUniversalNumberingSystem:0060\"&gt;\n             &lt;saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:token\"&gt;9801000050702&lt;/saml2:AttributeValue&gt;\n            &lt;/saml2:Attribute&gt;\n            &lt;saml2:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"&gt;\n              &lt;saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"&gt;Martina&lt;/saml2:AttributeValue&gt;\n            &lt;/saml2:Attribute&gt;\n            &lt;saml2:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"&gt;\n              &lt;saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"&gt;Musterarzt&lt;/saml2:AttributeValue&gt;\n            &lt;/saml2:Attribute&gt;\n            &lt;saml2:Attribute Name=\"gender\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"&gt;\n              &lt;saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:token\"&gt;F&lt;/saml2:AttributeValue&gt;\n            &lt;/saml2:Attribute&gt;\n            &lt;saml2:Attribute Name=\"dateofbirth\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"&gt;\n              &lt;saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:date\"&gt;1990-09-06&lt;/saml2:AttributeValue&gt;\n            &lt;/saml2:Attribute&gt;\n          &lt;/saml2:AttributeStatement&gt;\n        &lt;/saml2:Assertion&gt;\n</code></pre>"},{"location":"AuthenticateUser/#transport-protocol_1","title":"Transport Protocol","text":"<p>The primary system shall send the request messages to the IdP of the community using the http POST binding as defined in the W3C SOAP specification. It may look like:  </p> <pre><code>POST /IdPAuthenticationService HTTP/1.1\nHost: idp.example.org\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nContent-Type: application/soap+xml; charset=\"utf-8\"\nContent-Length: nnnn  \n</code></pre>"},{"location":"AuthenticateUser/#security-requirements_1","title":"Security Requirements","text":"<p>The Artifact Resolve transaction shall be secured by using the SOAP backchannel with TLS and mutual authentication with client and server certificate validation. The certificates shall be exchanged during the client registration process.  </p>"},{"location":"AuthenticateUser/#audit-log","title":"Audit Log","text":"<p>Primary systems shall protocol the transaction in their logs to ensure traceability. No further requirements are defined in the ordinances of the Swiss EPR.</p>"},{"location":"AuthenticateUser/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment, test systems of the EPR communities or the EPR Playground.</p>"},{"location":"GetXAssertion/","title":"Get X-User Assertion","text":"<p>Transaction to retrieve a SAML 2.0 assertion for authorization of transactions in the Swiss EPR. Primary systems shall use this transaction to retrieve a SAML 2 assertions to be used with EPR transactions, which require authorization.  </p>"},{"location":"GetXAssertion/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction to retrieve a SAML 2 assertions to be used with the Provide X-User Assertion with XDS.b transactions as defined in the IHE XUA profile with Swiss specific extensions defined in Amendment 1 to Annex 5.</p> <p>The primary system shall provide claims (e.g., user role, purpose of use) with the request as defined in Amendment 1 to Annex 5.</p> <p>The community verifies the claims and responds with a XUA compliant SAML 2.0 Assertion defined in Amendment 1 to Annex 5.</p>"},{"location":"GetXAssertion/#transaction","title":"Transaction","text":""},{"location":"GetXAssertion/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in the WS Trust standard, with restrictions defined in the IHE profile and the ordinances to the Swiss EPR.</p>"},{"location":"GetXAssertion/#request-message","title":"Request Message","text":"<p>The following snippet is taken from a sample request recorded during the EPR projectathon in September 2020. Some elements are omitted to increase readability. The raw request file may be found here.</p> <p>The snippet shows a request performed by a healthcare professional performing a the normal access. For other roles and situations the claims are different. Other examples may be found at XUA examples.   </p> <p>The request message shall be a XML SOAP envelope with the query embedded in the Body element of the SOAP envelope. The SOAP Header element conveys the following information:</p> <ul> <li>MessageID element: a UUID of the message.</li> <li>Action element: The SOAP action identifier of the query as defined in the IHE ITI Technical Framework.</li> <li>Security element: The Web Service Security header as defined in the WS Security specification. This element must contain the IdP Assertion taken from user authentication (see Authenticate User).  </li> </ul> SOAP header<pre><code>&lt;env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n &lt;env:Header&gt;\n  &lt;wsa:Action xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue&lt;/wsa:Action&gt;\n  &lt;wsa:MessageID xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:005300f3-c686-4960-8ae8-f8c1720eda41&lt;/wsa:MessageID&gt;\n  &lt;wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"&gt;\n   &lt;saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"Assertion_dbce1232740fcad9e020f927fd25a5d04779b4cc\" IssueInstant=\"2020-09-21T13:38:43.857Z\" Version=\"2.0\"&gt;\n   &lt;!-- IdP Assertion omitted --&gt;\n   &lt;/saml2:Assertion&gt;\n  &lt;/wsse:Security&gt;\n &lt;/env:Header&gt;\n</code></pre> <p>The SOAP Body element contains the RequestSecurityToken element with the following claims to be set by the primary system. It's child element read:</p> <p>AppliesTo the URL of the community endpoint the XUA assertion shall be used for authorization, whose value is set in the Address child element.</p> <pre><code>   &lt;wsp:AppliesTo xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\"&gt;\n    &lt;wsa:EndpointReference xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n     &lt;wsa:Address&gt;https://sp.communilty.ch&lt;/wsa:Address&gt;\n    &lt;/wsa:EndpointReference&gt;\n   &lt;/wsp:AppliesTo&gt;\n</code></pre> <p>resourceID conveying the EPR-SPID of the patient EPR to access in CX format (see see PIXFeed)</p> <pre><code>    &lt;saml2:Attribute xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Name=\"urn:oasis:names:tc:xacml:2.0:resource:resource-id\"&gt;\n     &lt;saml2:AttributeValue xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xsd:token\"&gt;761337610411353650^^^&amp;amp;2.16.756.5.30.1.127.3.10.3&amp;amp;ISO&lt;/saml2:AttributeValue&gt;\n    &lt;/saml2:Attribute&gt;\n</code></pre> <p>purposeOfUse conveying the purpose of use of the request, which must be taken from the EPR value set defined in Annex 3 of the ordinances of the Swiss electronic patient dossier.</p> <pre><code>    &lt;saml2:Attribute xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Name=\"urn:oasis:names:tc:xspa:1.0:subject:purposeofuse\"&gt;\n     &lt;saml2:AttributeValue xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xsd:anyType\"&gt;\n      &lt;PurposeOfUse xmlns=\"urn:hl7-org:v3\" code=\"NORM\" codeSystem=\"2.16.756.5.30.1.127.3.10.5\" codeSystemName=\"eHealth Suisse Verwendungszweck\" displayName=\"Normalzugriff\" xsi:type=\"CE\"/&gt;\n     &lt;/saml2:AttributeValue&gt;\n    &lt;/saml2:Attribute&gt;\n</code></pre> <p>role conveying the EPR role of the user, which must be taken from the EPR value set defined in Annex 3.</p> <pre><code>    &lt;saml2:Attribute xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Name=\"urn:oasis:names:tc:xacml:2.0:subject:role\"&gt;\n     &lt;saml2:AttributeValue xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xsd:anyType\"&gt;\n      &lt;Role xmlns=\"urn:hl7-org:v3\" code=\"HCP\" codeSystem=\"2.16.756.5.30.1.127.3.10.6\" codeSystemName=\"eHealth Suisse EPR Akteure\" displayName=\"Behandelnde(r)\" xsi:type=\"CE\"/&gt;\n     &lt;/saml2:AttributeValue&gt;\n    &lt;/saml2:Attribute&gt;\n</code></pre>"},{"location":"GetXAssertion/#response-message","title":"Response Message","text":"<p>The following snippet is taken from a sample response recorded during the EPR projectathon in September 2020. Some elements were ommitted to increase readability. The raw file may be found here.</p> <p>The response message is a XML SOAP envelope with the XUA Assertion embedded in the the Body element of the SOAP envelope (see example below, lines 21 to 23). Primary systems shall extract the XUA Assertion to use the im the security header of the XDS.b transactions, which require authorization. For primary systems, there is no need to extract information from the XUA assertion.  </p> <p>The XUA Assertion is omitted in the snippet below. For examples of see here.  </p> GetXAssertion_response.xml<pre><code>&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;soapenv:Envelope xmlns:soapenv=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n &lt;soapenv:Header xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n  &lt;wsa:Action&gt;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTRC/IssueFinal&lt;/wsa:Action&gt;\n  &lt;wsa:RelatesTo&gt;urn:uuid:005300f3-c686-4960-8ae8-f8c1720eda41&lt;/wsa:RelatesTo&gt;\n &lt;/soapenv:Header&gt;\n &lt;soapenv:Body&gt;\n  &lt;wst:RequestSecurityTokenResponseCollection xmlns:wst=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\"&gt;\n   &lt;wst:RequestSecurityTokenResponse&gt;\n    &lt;wst:TokenType&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0&lt;/wst:TokenType&gt;\n    &lt;wst:Lifetime&gt;\n     &lt;wsu:Created xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"&gt;2020-09-21T13:39:23.200Z&lt;/wsu:Created&gt;\n     &lt;wsu:Expires xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"&gt;2020-09-21T13:54:23.200Z&lt;/wsu:Expires&gt;\n    &lt;/wst:Lifetime&gt;\n    &lt;wsp:AppliesTo xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\"&gt;\n     &lt;wsa:EndpointReference xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n      &lt;wsa:Address&gt;https://sp.communilty.ch&lt;/wsa:Address&gt;\n     &lt;/wsa:EndpointReference&gt;\n    &lt;/wsp:AppliesTo&gt;\n    &lt;wst:RequestedSecurityToken&gt;\n     &lt;saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" ID=\"_96189571-c72c-4a10-8f1c-6d5b27efa797\" IssueInstant=\"2020-09-21T13:39:23.200Z\" Version=\"2.0\"&gt;\n      &lt;!-- assertion omitted for brevity --&gt;\n     &lt;/saml2:Assertion&gt;\n    &lt;/wst:RequestedSecurityToken&gt;\n    &lt;wst:RequestedAttachedReference&gt;\n     &lt;wsse:SecurityTokenReference xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"&gt;\n      &lt;wsse:Reference URI=\"_96189571-c72c-4a10-8f1c-6d5b27efa797\" ValueType=\"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0\"/&gt;\n     &lt;/wsse:SecurityTokenReference&gt;\n    &lt;/wst:RequestedAttachedReference&gt;\n   &lt;/wst:RequestSecurityTokenResponse&gt;\n  &lt;/wst:RequestSecurityTokenResponseCollection&gt;\n &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre>"},{"location":"GetXAssertion/#transport-protocol","title":"Transport Protocol","text":"<p>The primary system shall send the request messages to the X-Assertion Provider of the community using the http POST binding as defined in the W3C SOAP specification. It may look like:  </p> <pre><code>POST /RegistryStoredQueryService HTTP/1.1\nHost: company.example.org\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nContent-Type: application/soap+xml; charset=\"utf-8\"\nContent-Length: nnnn  \n</code></pre>"},{"location":"GetXAssertion/#audit-log","title":"Audit Log","text":"<p>Primary systems shall protocol the request and response for traceability. There are no further requirements on protocols defined in the ordinances of the Swiss EPR.  </p>"},{"location":"GetXAssertion/#security-requirements","title":"Security Requirements","text":"<p>To ensure privacy the transaction must be secured using https with mutual authentication, using X.509 certificates (extended validation required) and client and server side certificate validation.</p> <p>The retrieval of a XUA assertion requires user authentication by providing the IdP assertion in the Security header of the SOAP envelope (see Message Semantics). The IdP assertion shall be retrieved by the primary system by using the Authenticate User transaction.  </p>"},{"location":"GetXAssertion/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment or the test systems of the EPR communities.</p>"},{"location":"IdPRenew/","title":"IdP Renew","text":"<p>Transaction to renew a IdP Assertion. Primary systems may use this transaction to retrieve a new IdP Assertion, without requiring the user to enter her credentials.</p>"},{"location":"IdPRenew/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction retrieve a new IdP Assertion by sending an assertion retrieved beforehand.   </p>"},{"location":"IdPRenew/#transaction","title":"Transaction","text":""},{"location":"IdPRenew/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in Assertions and Protocols for the OASIS Security Assertion Markup Language (SAML) V2.0 and the ordinances to the Swiss EPR.</p>"},{"location":"IdPRenew/#request-message","title":"Request Message","text":"<p>Primary systems shall use this transaction to renew a assertion whose lifetime is exceeded.</p> <p>The following snippet is adapted from a sample request recorded during the EPR projectathon in September 2020. Some elements and namespaces were omitted to increase readability. The raw request file may be found here.</p> <p>The Header element of the SOAP envelope contains the data used to sign the request message, as required from the ordinances of the Swiss EPR in Annex 8 and specified in the Web Service Security: SOAP Message Security 1.1. specification.</p> SOAP header<pre><code>&lt;Envelope&gt;\n &lt;Header&gt;\n  &lt;Security mustUnderstand=\"1\"&gt;\n   &lt;Timestamp Id=\"TS-15277e04-85e0-4b9c-9692-76c3e7be17bc\"&gt;\n    &lt;Created&gt;2019-03-26T15:13:15.144Z&lt;/Created&gt;\n    &lt;Expires&gt;2019-03-26T15:18:15.144Z&lt;/Expires&gt;\n   &lt;/Timestamp&gt;\n   &lt;BinarySecurityToken\n    EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\"\n    ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\"\n    Id=\"X509-6dfe58da-6804-48ba-ad52-e871c63455df\"&gt;\n    MIIDPTCCAiWgAwIBAgIEPVbC1zANBgkqhkiG9w0BAQUFADBPMQswCQYDVQQGEqSqEb/3VB3ITUav3DIo2o2mRCKyfHV471QUNt4qNFmEwRxpsoGst/UYoTqW8/buv4A=\n   &lt;/BinarySecurityToken&gt;\n   &lt;Signature Id=\"SIG-98f468bf-4022-4e31-9886-6f30f1c676bc\"&gt;\n    &lt;SignedInfo&gt;\n     &lt;CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"&gt;\n      &lt;InclusiveNamespaces PrefixList=\"soap\"/&gt;\n     &lt;/CanonicalizationMethod&gt;\n     &lt;SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256\" /&gt;\n     &lt;Reference URI=\"#TS-15277e04-85e0-4b9c-9692-76c3e7be17bc\" &gt;\n      &lt;Transforms&gt;\n       &lt;Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" &gt;\n        &lt;InclusiveNamespaces PrefixList=\"soap wsse\"/&gt;\n       &lt;/Transform&gt;\n      &lt;/Transforms&gt;\n      &lt;DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /&gt;\n      &lt;DigestValue &gt;LCxW9EORpApnpju2Q17b0MB1LGt8CMCuvoOqCtlhFx0=&lt;/DigestValue&gt;\n     &lt;/Reference&gt;\n     &lt;Reference URI=\"#_33c9f0c5-c7d2-4d53-ad2f-944320637754\" &gt;\n      &lt;Transforms&gt;\n       &lt;Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /&gt;\n      &lt;/Transforms&gt;\n      &lt;DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /&gt;\n      &lt;DigestValue &gt;TwKUz3SxOx1NaFVvy55AbbpWXbUJmfn+mreDpkNa/pg=&lt;/ds:DigestValue&gt;\n     &lt;/Reference&gt;\n    &lt;/SignedInfo&gt;\n    &lt;SignatureValue&gt;\n     &lt;!-- signature value omitted --&gt;\n    &lt;/SignatureValue&gt;\n    &lt;KeyInfo Id=\"KI-2c6438fa-738a-4ffb-aa52-379bd9380b1a\" &gt;\n     &lt;SecurityTokenReference Id=\"STR-76ccd654-581d-446e-a00b-8ed529bcc4ab\"&gt;\n      &lt;X509Data&gt;\n       &lt;X509IssuerSerial&gt;\n        &lt;X509IssuerName &gt;CN=lk,OU=lk,O=lk,L=lsn,ST=vd,C=ch&lt;/X509IssuerName&gt;\n        &lt;X509SerialNumber &gt;1029096151&lt;/X509SerialNumber&gt;\n       &lt;/X509IssuerSerial&gt;\n      &lt;/X509Data&gt;\n     &lt;/SecurityTokenReference&gt;\n    &lt;/KeyInfo&gt;\n   &lt;/Signature&gt;\n  &lt;/Security&gt;\n &lt;/Header&gt;\n</code></pre> <p>Primary systems shall embed the SAML Assertion in the the Body of the SOAP envelope (see lines 58 .. 60 in example  below).</p> SOAP body<pre><code> &lt;Body Id=\"_33c9f0c5-c7d2-4d53-ad2f-944320637754\"&gt;\n  &lt;RequestSecurityToken&gt;\n   &lt;RequestType&gt;http://docs.oasis-open.org/ws-sx/ws-trust/200512/Renew&lt;/RequestType&gt;\n   &lt;TokenType&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0&lt;/TokenType&gt;\n   &lt;RenewTarget&gt;\n    &lt;Assertion ID=\"ID_6ff2590e-8df8-4f04-9ae0-cfd16d816c49\" IssueInstant=\"2019-03-26T15:12:13.246Z\" Version=\"2.0\"&gt;\n     &lt;!-- assertion omitted --&gt;\n    &lt;/Assertion&gt;\n   &lt;/RenewTarget&gt;\n   &lt;Renewing/&gt;\n  &lt;/RequestSecurityToken&gt;\n &lt;/Body&gt;\n&lt;/Envelope&gt;\n</code></pre>"},{"location":"IdPRenew/#response-message","title":"Response Message","text":"<p>The community responds with a SAML 2.0 IdP assertion whose lifetime is updated.  </p> <p>The following snippet is adapted from a sample request recorded during the EPR projectathon in September 2020. Some elements and namespaces were ommitted to increase readability. The raw request file may be found here.</p> <p>A SAML 2.0 IdP Assertion with identical attributes but updated lifetime is conveyed in the the Body of the SOAP envelope (see lines 67 .. 69). Examples of Swiss EPR compliant XUA assertions may be found here.</p> Response<pre><code>&lt;Envelope&gt;\n &lt;Header/&gt;\n &lt;Body&gt;\n  &lt;RequestSecurityTokenResponse Context=\"\"&gt;\n   &lt;TokenType&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0&lt;/TokenType&gt;\n   &lt;Lifetime&gt;\n    &lt;wsu:Created&gt;2019-03-26T15:13:13.378Z&lt;/wsu:Created&gt;\n    &lt;wsu:Expires&gt;2019-03-26T15:18:13.378Z&lt;/wsu:Expires&gt;\n   &lt;/Lifetime&gt;\n   &lt;RequestedSecurityToken&gt;\n    &lt;Assertion&gt;\n     &lt;!-- Assertion returned by the IdP ommitted for brevity --&gt;\n    &lt;/Assertion&gt;\n   &lt;/RequestedSecurityToken&gt;\n   &lt;RequestedAttachedReference&gt;\n    &lt;SecurityTokenReference TokenType=\"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0\"&gt;\n     &lt;KeyIdentifier ValueType=\"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLID\"&gt;#ID_cf6f7da6-c670-4c35-b413-39182b5672f2&lt;/KeyIdentifier&gt;\n    &lt;/SecurityTokenReference&gt;\n   &lt;/RequestedAttachedReference&gt;\n  &lt;/RequestSecurityTokenResponse&gt;\n &lt;/Body&gt;\n&lt;/Envelope&gt;\n</code></pre>"},{"location":"IdPRenew/#transport-protocol","title":"Transport Protocol","text":"<p>The primary system shall send the request messages to the registry of the community using the http POST binding as defined in the W3C SOAP specification. It may look like:  </p> <pre><code>POST /RegistryStoredQueryService HTTP/1.1\nHost: company.example.org\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nContent-Type: application/soap+xml; charset=\"utf-8\"\nContent-Length: nnnn  \n</code></pre>"},{"location":"IdPRenew/#audit-log","title":"Audit Log","text":"<p>Primary systems shall protocol the request and response for traceability. There are no further requirements on protocols defined in the ordinances of the Swiss EPR.  </p>"},{"location":"IdPRenew/#security-requirements","title":"Security Requirements","text":"<p>To ensure privacy the transaction must be secured using the TLS SOAP backchannel with mutual authentication by server and client certificate validation.</p>"},{"location":"IdPRenew/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the Gazelle test suite of the EPR reference environment, or test systems of the EPR communities.</p>"},{"location":"ImmunizationAdministrationDocument/","title":"Immunization Administration Document","text":"<p>In a primary system, different vaccinations are documented in a treatment context. Primary systems can use this Exchange Format to generate a Immunization Administration document.</p>"},{"location":"ImmunizationAdministrationDocument/#bundle","title":"Bundle","text":"<p>Profile information</p> <p>In the resource \"Bundle\", all resources are collected in a container.</p> <ul> <li>id: Local id of the resource (line 3)</li> <li>meta: Shows the metadata of the document (line 4 to 8).</li> <li>identifier: Unique identifier for the bundle - fixed Value: \"urn:ietf:rfc:3986\" (line 9 to 12).</li> <li>type: Indicates the purpose of this bundle - fixed Value: \"document\"; binding: BundleType (line 13).</li> <li>timestamp: The date/time the bundle was composed (line 14).</li> <li>entry: The list to add all resources belonging to the document (line 15-17).</li> </ul> <pre><code>{\n  \"resourceType\" : \"Bundle\",\n  \"id\" : \"A-D2-HCP1-C1\",\n  \"meta\" : {\n    \"profile\" : [\n      \"http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-document-immunization-administration\"\n    ]\n  },\n  \"identifier\" : {\n    \"system\" : \"urn:ietf:rfc:3986\",\n    \"value\" : \"urn:uuid:bef441e1-58b1-48e3-aa51-61237a3c20cd\"\n  },\n  \"type\" : \"document\",\n  \"timestamp\" : \"2021-06-15T00:00:00.390+02:00\",\n  \"entry\" : [\n    ....\n  ]\n}\n</code></pre>"},{"location":"ImmunizationAdministrationDocument/#composition","title":"Composition","text":"<p>Profile information</p> <p>In the resource \"Composition\", general information about the document is specified. It should be the first entry in the list.</p> <ul> <li>entry: An entry in a bundle resource - will either contain a resource or information about a resource (line 1)</li> <li>id: Local id of the resource (line 6).</li> <li>meta: Shows the metadata of the composition (line 7 to 11).</li> <li>language: Specifies the language of the document - binding: CommonLanguages (line 12).</li> <li>text: Presents the narrative text of the resource (line 13 to 16).</li> <li>extension: Extension to version number (line 17 to 23).</li> <li>identifier: A version-independent identifier for the Composition with a fixed system value \"urn:ietf:rfc:3986\" (line 24 to 27).</li> <li>status: The status of the document - fixed Value: \"final\"; binding: CompositionStatus (line 28).</li> <li>type: Specifies the particular kind of composition. Fixed coding value  (line 29 to 37).</li> </ul> <pre><code>\"entry\" : [\n    {\n      \"fullUrl\" : \"http://test.fhir.ch/r4/Composition/A-D2-HCP1-C1-Composition\",\n      \"resource\" : {\n        \"resourceType\" : \"Composition\",\n        \"id\" : \"A-D2-HCP1-C1-Composition\",\n        \"meta\" : {\n          \"profile\" : [\n            \"http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-composition-immunization-administration\"\n          ]\n        },\n        \"language\" : \"en-US\",\n        \"text\" : {\n          \"status\" : \"generated\",\n          \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\" xml:lang=\\\"en-US\\\" lang=\\\"en-US\\\"&gt;&lt;h3&gt;Immunization Administration&lt;/h3&gt;&lt;p&gt;&lt;b&gt;Id: &lt;/b&gt;A-D2-HCP1-C1-Composition&lt;/p&gt;&lt;p&gt;&lt;b&gt;Identifier: &lt;/b&gt;&lt;span&gt;urn:ietf:rfc:3986#urn:uuid:ab0add6e-0049-4567-8609-8d3ffdd84af0&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Status: &lt;/b&gt;Final&lt;/p&gt;&lt;p&gt;&lt;b&gt;Code: &lt;/b&gt;&lt;span&gt;Immunization record (http://snomed.info/sct#41000179103)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Patient: &lt;/b&gt;&lt;a href=\\\"Patient-TC-patient.html\\\"&gt;Patient/TC-patient&lt;/a&gt; Wegmueller Monika&lt;/p&gt;&lt;p&gt;&lt;b&gt;Date: &lt;/b&gt;June 15, 2021&lt;/p&gt;&lt;p&gt;&lt;b&gt;Authors:&lt;/b&gt;&lt;/p&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;a href=\\\"Practitioner-TC-HCP1-C1.html\\\"&gt;Practitioner/TC-HCP1-C1&lt;/a&gt; Bereit Allzeit&lt;/p&gt;&lt;p&gt;&lt;a href=\\\"Organization-TC-ORG1.html\\\"&gt;Organization/TC-ORG1&lt;/a&gt; Gruppenpraxis CH&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;&lt;b&gt;Confidentiality: &lt;/b&gt;null&lt;span&gt; Normal (qualifier value) (http://snomed.info/sct#17621005)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Sections:&lt;/b&gt;&lt;/p&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;Immunization Administration&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;\"\n        },\n        \"extension\" : [\n          {\n            \"id\" : \"versionNumber\",\n            \"url\" : \"http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-versionnumber\",\n            \"valueUnsignedInt\" : 1\n          }\n        ],\n        \"identifier\" : {\n         \"system\" : \"urn:ietf:rfc:3986\",\n         \"value\" : \"urn:uuid:ab0add6e-0049-4567-8609-8d3ffdd84af0\"\n        },\n        \"status\" : \"final\",\n        \"type\" : {\n         \"coding\" : [\n           {\n             \"system\" : \"http://snomed.info/sct\",\n             \"code\" : \"41000179103\",\n             \"display\" : \"Immunization record\"\n           }\n         ]\n       },\n</code></pre> <ul> <li>subject: Who the composition is about. Its a reference to the resource contained as entry in the bundle (line 38 to 40).</li> <li>date: The date of the composition creation (line 41).</li> <li>author: Identifies who is responsible for the information in the composition (line 42 to 46).</li> <li>title: The title of the document. Fixed Value. (line 47).</li> </ul> <pre><code>       \"subject\" : {\n          \"reference\" : \"Patient/TC-patient\"\n        },\n        \"date\" : \"2021-06-15T00:00:00+02:00\",\n        \"author\" : [\n          {\n            \"reference\" : \"PractitionerRole/TC-HCP1-ORG1-ROLE-author\"\n          }\n        ],\n       \"title\" : \"Immunization Administration\",\n</code></pre> <ul> <li>confidentiality: Level of confidentiality of the Composition - binding: v3.ConfidentialityClassification (2014-03-26) and an extension EPR Confidentiality Code with binding to DocumentEntry.confidentialityCode (line 48 to 64).</li> <li>custodian: Organization who is responsible for the document and access.</li> </ul> <pre><code>       \"confidentiality\" : \"N\",\n        \"_confidentiality\" : {\n          \"extension\" : [\n            {\n              \"url\" : \"http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-confidentialitycode\",\n               \"valueCodeableConcept\" : {\n                \"coding\" : [\n                  {\n                    \"system\" : \"http://snomed.info/sct\",\n                    \"code\" : \"17621005\",\n                    \"display\" : \"Normal (qualifier value)\"\n                  }\n                ]\n              }\n            }\n         ]\n       },\n       \"custodian\" : {\n         \"reference\" : \"Organization/TC-ORG1\"\n       },\n</code></pre> <ul> <li>section: The root of the sections that make up the composition. There can be multiple sections (in minimum one of these sections has to be declared and an entry has to be defined) - See Immunization Administration Sections:</li> </ul> <pre><code>       \"section\" : [\n          {\n            \"id\" : \"administration\",\n            \"title\" : \"Immunization Administration\",\n            \"code\" : {\n              \"coding\" : [\n                {\n                  \"system\" : \"http://loinc.org\",\n                  \"code\" : \"11369-6\",\n                  \"display\" : \"Hx of Immunization\"\n                }\n              ]\n            },\n            \"text\" : {\n              \"status\" : \"generated\",\n              \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\" xml:lang=\\\"en-US\\\" lang=\\\"en-US\\\"&gt;&lt;p&gt;&lt;b&gt;Code: &lt;/b&gt;&lt;span&gt;Hx of Immunization (http://loinc.org#11369-6)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Entries:&lt;/b&gt;&lt;/p&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;a href=\\\"Immunization-TCA01-IMMUN2-HCP1-ORG1-ROLE.html\\\"&gt;Immunization/TCA01-IMMUN2-HCP1-ORG1-ROLE&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;\"\n            },\n            \"entry\" : [\n              {\n                \"reference\" : \"Immunization/TCA01-IMMUN2-HCP1-ORG1-ROLE\"\n              }\n            ]\n          }\n        ]\n</code></pre>"},{"location":"ImmunizationAdministrationDocument/#information-about-the-patient","title":"Information about the patient","text":"<p>In the \"Patient\" resource, the demographic and administrative data of a patient are specified.</p> <p>Profile information</p> <pre><code> {\n      \"fullUrl\" : \"http://test.fhir.ch/r4/Patient/TC-patient\",\n      \"resource\" : {\n        \"resourceType\" : \"Patient\",\n        \"id\" : \"TC-patient\",\n        \"meta\" : {\n          \"profile\" : [\n            \"http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-patient-epr\"\n          ]\n        },\n        \"text\" : {\n          \"status\" : \"generated\",\n          \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;div style=\\\"display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%\\\"&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Resource \\\"TC-patient\\\" &lt;/p&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Profile: &lt;a href=\\\"http://fhir.ch/ig/ch-core/StructureDefinition-ch-core-patient-epr.html\\\"&gt;CH Core Patient Profile EPR&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: id: 123.71.332.115, id: 8077560000000000000000&lt;/p&gt;&lt;p&gt;&lt;b&gt;name&lt;/b&gt;: Monika Wegmueller &lt;/p&gt;&lt;p&gt;&lt;b&gt;telecom&lt;/b&gt;: ph: tel:+41.32.685.12.34(HOME)&lt;/p&gt;&lt;p&gt;&lt;b&gt;gender&lt;/b&gt;: female&lt;/p&gt;&lt;p&gt;&lt;b&gt;birthDate&lt;/b&gt;: 1967-02-10&lt;/p&gt;&lt;p&gt;&lt;b&gt;address&lt;/b&gt;: Leidensweg 10 Specimendorf 9876 CH &lt;/p&gt;&lt;/div&gt;\"\n        },\n        \"identifier\" : [\n          {\n           \"system\" : \"urn:oid:2.16.756.5.31\",\n           \"value\" : \"123.71.332.115\"\n         },\n         {\n           \"system\" : \"urn:oid:2.16.756.5.30.1.123.100.1.1.1\",\n           \"value\" : \"8077560000000000000000\"\n         }\n       ],\n       \"name\" : [\n         {\n            \"family\" : \"Wegmueller\",\n            \"given\" : [\n              \"Monika\"\n            ]\n          }\n        ],\n        \"telecom\" : [\n          {\n            \"system\" : \"phone\",\n            \"value\" : \"tel:+41.32.685.12.34\",\n            \"use\" : \"home\"\n          }\n        ],\n        \"gender\" : \"female\",\n        \"birthDate\" : \"1967-02-10\",\n        \"address\" : [\n          {\n            \"type\" : \"both\",\n            \"line\" : [\n              \"Leidensweg 10\"\n            ],\n            \"city\" : \"Specimendorf\",\n            \"postalCode\" : \"9876\",\n            \"country\" : \"CH\"\n          }\n        ]\n      }\n    },\n</code></pre>"},{"location":"ImmunizationAdministrationDocument/#information-about-the-practitioner","title":"Information about the practitioner","text":"<p>The resource Practitioner indicates which practitioner has given a vaccination.</p> <p>Profile information</p> <pre><code>{\n      \"fullUrl\" : \"http://test.fhir.ch/r4/Practitioner/TC-HCP1-C1\",\n      \"resource\" : {\n        \"resourceType\" : \"Practitioner\",\n        \"id\" : \"TC-HCP1-C1\",\n        \"meta\" : {\n          \"profile\" : [\n            \"http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-practitioner-epr\"\n          ]\n        },\n        \"text\" : {\n          \"status\" : \"generated\",\n          \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;div style=\\\"display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%\\\"&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Resource \\\"TC-HCP1-C1\\\" &lt;/p&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Profile: &lt;a href=\\\"http://fhir.ch/ig/ch-core/StructureDefinition-ch-core-practitioner-epr.html\\\"&gt;CH Core Practitioner Profile EPR&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: id: 7608888888888&lt;/p&gt;&lt;p&gt;&lt;b&gt;active&lt;/b&gt;: true&lt;/p&gt;&lt;p&gt;&lt;b&gt;name&lt;/b&gt;: Allzeit Bereit &lt;/p&gt;&lt;p&gt;&lt;b&gt;telecom&lt;/b&gt;: ph: tel:+41.32.234.55.66(WORK), fax: fax:+41.32.234.55.67(WORK), &lt;a href=\\\"mailto:mailto:allzeit.bereit@gruppenpraxis.ch\\\"&gt;mailto:allzeit.bereit@gruppenpraxis.ch&lt;/a&gt;, &lt;a href=\\\"http://www.gruppenpraxis.ch\\\"&gt;http://www.gruppenpraxis.ch&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;address&lt;/b&gt;: Doktorgasse 2 Musterhausen 8888 CH &lt;/p&gt;&lt;/div&gt;\"\n        },\n        \"identifier\" : [\n          {\n            \"system\" : \"urn:oid:2.51.1.3\",\n            \"value\" : \"7608888888888\"\n          }\n        ],\n        \"active\" : true,\n        \"name\" : [\n          {\n            \"family\" : \"Bereit\",\n            \"given\" : [\n              \"Allzeit\"\n            ],\n            \"prefix\" : [\n              \"Dr. med.\"\n            ]\n          }\n        ],\n        \"telecom\" : [\n          {\n            \"system\" : \"phone\",\n            \"value\" : \"tel:+41.32.234.55.66\",\n            \"use\" : \"work\"\n          },\n          {\n            \"system\" : \"fax\",\n            \"value\" : \"fax:+41.32.234.55.67\",\n            \"use\" : \"work\"\n          },\n          {\n            \"system\" : \"email\",\n            \"value\" : \"mailto:allzeit.bereit@gruppenpraxis.ch\",\n            \"use\" : \"work\"\n          },\n          {\n            \"system\" : \"url\",\n            \"value\" : \"http://www.gruppenpraxis.ch\",\n            \"use\" : \"work\"\n          }\n        ],\n        \"address\" : [\n          {\n            \"type\" : \"physical\",\n            \"line\" : [\n              \"Doktorgasse 2\"\n            ],\n            \"city\" : \"Musterhausen\",\n            \"postalCode\" : \"8888\",\n            \"country\" : \"CH\"\n          }\n        ]\n      }\n    },\n</code></pre>"},{"location":"ImmunizationAdministrationDocument/#information-about-the-organization","title":"Information about the organization","text":"<p>The resource stores the information about the organization that creates the Immunization Administration Document</p> <p>Profile information</p> <pre><code>{\n      \"fullUrl\" : \"http://test.fhir.ch/r4/Organization/TC-ORG1\",\n      \"resource\" : {\n        \"resourceType\" : \"Organization\",\n        \"id\" : \"TC-ORG1\",\n        \"meta\" : {\n          \"profile\" : [\n            \"http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-organization-epr\"\n          ]\n        },\n        \"text\" : {\n          \"status\" : \"generated\",\n          \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;div style=\\\"display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%\\\"&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Resource \\\"TC-ORG1\\\" &lt;/p&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Profile: &lt;a href=\\\"http://fhir.ch/ig/ch-core/StructureDefinition-ch-core-organization-epr.html\\\"&gt;CH Core Organization Profile EPR&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: id: 7608888888888&lt;/p&gt;&lt;p&gt;&lt;b&gt;name&lt;/b&gt;: Gruppenpraxis CH&lt;/p&gt;&lt;p&gt;&lt;b&gt;telecom&lt;/b&gt;: ph: tel:+41.32.234.55.66(WORK), fax: fax:+41.32.234.55.67(WORK), &lt;a href=\\\"mailto:mailto:bereit@gruppenpraxis.ch\\\"&gt;mailto:bereit@gruppenpraxis.ch&lt;/a&gt;, &lt;a href=\\\"http://www.gruppenpraxis.ch\\\"&gt;http://www.gruppenpraxis.ch&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;address&lt;/b&gt;: Doktorgasse 2 Musterhausen ZH 8888 CH &lt;/p&gt;&lt;/div&gt;\"\n        },\n        \"identifier\" : [\n          {\n            \"system\" : \"urn:oid:2.51.1.3\",\n            \"value\" : \"7608888888888\"\n          }\n        ],\n        \"name\" : \"Gruppenpraxis CH\",\n        \"telecom\" : [\n          {\n            \"system\" : \"phone\",\n            \"value\" : \"tel:+41.32.234.55.66\",\n            \"use\" : \"work\"\n          },\n          {\n            \"system\" : \"fax\",\n            \"value\" : \"fax:+41.32.234.55.67\",\n            \"use\" : \"work\"\n          },\n          {\n            \"system\" : \"email\",\n            \"value\" : \"mailto:bereit@gruppenpraxis.ch\",\n            \"use\" : \"work\"\n          },\n          {\n            \"system\" : \"url\",\n            \"value\" : \"http://www.gruppenpraxis.ch\",\n            \"use\" : \"work\"\n          }\n        ],\n        \"address\" : [\n          {\n            \"line\" : [\n              \"Doktorgasse 2\"\n            ],\n            \"city\" : \"Musterhausen\",\n            \"state\" : \"ZH\",\n            \"postalCode\" : \"8888\",\n            \"country\" : \"CH\"\n          }\n        ]\n      }\n    },\n</code></pre>"},{"location":"ImmunizationAdministrationDocument/#immunization","title":"Immunization","text":"<p>In the resource \"Immunization\" the data of the patientes vaccination is defined.</p> <p>Profile information</p> <ul> <li>extension: The extension defining the recorder (administering the immunization) of the immunization entry (line 15 to 22).</li> <li>status: The status of the immunization - binding: ImmunizationStatusCodes (line 29)</li> <li>vaccineCode: The vaccine code defining the vaccine given to the patient - different bindings possible (lines 30 to 38): <ul> <li>Swissmedic code for vaccine code</li> <li>Snomed CT for vaccine code</li> <li>ATC for vaccine codes</li> <li>Absent or Unknown Immunization - IPS</li> </ul> </li> <li>occurrenceDateTime: The date the vaccination was done (line 42). </li> <li>recorded: The date the vaccination was entered in the record (line 43).</li> <li>lotNumber: The lot number of the vaccination applied to the patient (line 44).</li> <li>route: The route of administration - binding: Route of Administration for Immunization (lines 45 - 53).</li> <li>performer<ul> <li>actor: The health care professional who applied the vaccination to the patient (lines 54 to 60).</li> </ul> </li> <li>protocolApplied<ul> <li>targetDisease: The diseases the vaccination was given against. See mapping table VaccineCode To TargetDisease Mapping (lines 61 to 94).</li> </ul> </li> </ul> <pre><code> {\n   \"fullUrl\" : \"http://test.fhir.ch/r4/Immunization/TCA01-IMMUN2-HCP1-ORG1-ROLE\",\n   \"resource\" : {\n     \"resourceType\" : \"Immunization\",\n     \"id\" : \"TCA01-IMMUN2-HCP1-ORG1-ROLE\",\n     \"meta\" : {\n       \"profile\" : [\n         \"http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-immunization\"\n       ]\n     },\n     \"text\" : {\n       \"status\" : \"extensions\",\n       \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;div style=\\\"display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%\\\"&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Resource \\\"TCA01-IMMUN2-HCP1-ORG1-ROLE\\\" &lt;/p&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Profile: &lt;a href=\\\"StructureDefinition-ch-vacd-immunization.html\\\"&gt;CH VACD Immunization Profile&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;CH VACD Extension Immunization Recorder Reference&lt;/b&gt;: &lt;a href=\\\"#PractitionerRole_TC-HCP1-ORG1-ROLE-author\\\"&gt;See above (PractitionerRole/TC-HCP1-ORG1-ROLE-author)&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: id: 11853642-8ff4-45ae-af98-44c58b3bf0b7&lt;/p&gt;&lt;p&gt;&lt;b&gt;status&lt;/b&gt;: completed&lt;/p&gt;&lt;p&gt;&lt;b&gt;vaccineCode&lt;/b&gt;: Boostrix &lt;span style=\\\"background: LightGoldenRodYellow; margin: 4px; border: 1px solid khaki\\\"&gt; (&lt;a href=\\\"CodeSystem-ch-vacd-swissmedic-cs.html\\\"&gt;Swiss Medic Authorized Vaccines Codesystem&lt;/a&gt;#637)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;patient&lt;/b&gt;: &lt;a href=\\\"#Patient_TC-patient\\\"&gt;See above (Patient/TC-patient)&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;occurrence&lt;/b&gt;: 2021-06-15&lt;/p&gt;&lt;p&gt;&lt;b&gt;recorded&lt;/b&gt;: 2021-06-15T00:00:00.39+02:00&lt;/p&gt;&lt;p&gt;&lt;b&gt;lotNumber&lt;/b&gt;: 14-34218&lt;/p&gt;&lt;p&gt;&lt;b&gt;route&lt;/b&gt;: Intramuscular use &lt;span style=\\\"background: LightGoldenRodYellow; margin: 4px; border: 1px solid khaki\\\"&gt; (standardterms.edqm.eu#20035000)&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;Performers&lt;/h3&gt;&lt;table class=\\\"grid\\\"&gt;&lt;tr&gt;&lt;td&gt;-&lt;/td&gt;&lt;td&gt;&lt;b&gt;Actor&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;*&lt;/td&gt;&lt;td&gt;&lt;a href=\\\"#PractitionerRole_TC-HCP1-ORG1-ROLE-performer\\\"&gt;See above (PractitionerRole/TC-HCP1-ORG1-ROLE-performer)&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;h3&gt;ProtocolApplieds&lt;/h3&gt;&lt;table class=\\\"grid\\\"&gt;&lt;tr&gt;&lt;td&gt;-&lt;/td&gt;&lt;td&gt;&lt;b&gt;TargetDisease&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;DoseNumber[x]&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;*&lt;/td&gt;&lt;td&gt;Diphtheria caused by Corynebacterium diphtheriae (disorder) &lt;span style=\\\"background: LightGoldenRodYellow; margin: 4px; border: 1px solid khaki\\\"&gt; (&lt;a href=\\\"https://browser.ihtsdotools.org/\\\"&gt;SNOMED CT&lt;/a&gt;#397430003)&lt;/span&gt;, Tetanus (disorder) &lt;span style=\\\"background: LightGoldenRodYellow; margin: 4px; border: 1px solid khaki\\\"&gt; (&lt;a href=\\\"https://browser.ihtsdotools.org/\\\"&gt;SNOMED CT&lt;/a&gt;#76902006)&lt;/span&gt;, Pertussis (disorder) &lt;span style=\\\"background: LightGoldenRodYellow; margin: 4px; border: 1px solid khaki\\\"&gt; (&lt;a href=\\\"https://browser.ihtsdotools.org/\\\"&gt;SNOMED CT&lt;/a&gt;#27836007)&lt;/span&gt;&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;\"\n     },\n     \"extension\" : [\n       {\n         \"url\" : \"http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-ext-immunization-recorder-reference\",\n         \"valueReference\" : {\n           \"reference\" : \"PractitionerRole/TC-HCP1-ORG1-ROLE-author\"\n         }\n       }\n     ],\n     \"identifier\" : [\n       {\n         \"system\" : \"urn:oid:2.16.756.5.30.1.402.1.3.1.1.1\",\n         \"value\" : \"11853642-8ff4-45ae-af98-44c58b3bf0b7\"\n       }\n     ],\n     \"status\" : \"completed\",\n     \"vaccineCode\" : {\n       \"coding\" : [\n         {\n           \"system\" : \"http://fhir.ch/ig/ch-vacd/CodeSystem/ch-vacd-swissmedic-cs\",\n           \"code\" : \"637\",\n           \"display\" : \"Boostrix\"\n         }\n       ]\n     },\n     \"patient\" : {\n       \"reference\" : \"Patient/TC-patient\"\n     },\n     \"occurrenceDateTime\" : \"2021-06-15\",\n     \"recorded\" : \"2021-06-15T00:00:00.390+02:00\",\n     \"lotNumber\" : \"14-34218\",\n     \"route\" : {\n       \"coding\" : [\n         {\n           \"system\" : \"http://standardterms.edqm.eu\",\n           \"code\" : \"20035000\",\n           \"display\" : \"Intramuscular use\"\n         }\n       ]\n     },\n     \"performer\" : [\n       {\n         \"actor\" : {\n           \"reference\" : \"PractitionerRole/TC-HCP1-ORG1-ROLE-performer\"\n         }\n       }\n     ],\n     \"protocolApplied\" : [\n       {\n         \"targetDisease\" : [\n           {\n             \"coding\" : [\n               {\n                 \"system\" : \"http://snomed.info/sct\",\n                 \"code\" : \"397430003\",\n                 \"display\" : \"Diphtheria caused by Corynebacterium diphtheriae (disorder)\"\n               }\n             ]\n           },\n           {\n             \"coding\" : [\n               {\n                 \"system\" : \"http://snomed.info/sct\",\n                 \"code\" : \"76902006\",\n                 \"display\" : \"Tetanus (disorder)\"\n               }\n             ]\n           },\n           {\n             \"coding\" : [\n               {\n                 \"system\" : \"http://snomed.info/sct\",\n                 \"code\" : \"27836007\",\n                 \"display\" : \"Pertussis (disorder)\"\n               }\n             ]\n           }\n         ],\n         \"doseNumberPositiveInt\" : 1\n       }\n     ]\n   }\n }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/","title":"Immunization Administration Sections","text":"<p>A Immunization Administration document contains a compositions with different possible sections inside. In minimum one section (optionality: C) next to the optional sections (optionality: O) has to be defined.</p>"},{"location":"ImmunizationAdministrationSections/#possible-sections","title":"Possible Sections","text":"<p>The following sections can be defined:</p> Name id System Code Display Optionality Immunization Administration administration http://loinc.org 11369-6 Hx of Immunization C Medical Problems medicalproblems http://loinc.org 11450-4 Problem list Reported C Past Illnesses pastillnesses http://loinc.org 11348-0 Hx of Past illness C Allergies and Intolerences allergyintolerances http://loinc.org 48765-2 Allergies and adverse reactions Document C Other Relevant Observatons otherrelevantobservations http://loinc.org 30954-2 Relevant diagnostic tests/laboratory data Narrative C Laboratory-Serology laboratory-serology http://loinc.org 18727-8 Serology studies (set) C Pregnancy pregnancy http://loinc.org 10162-6 Pregnancies Hx C Annotation annotation http://loinc.org 48767-8 Annotation comment Imp O Original representation originalRepresentation http://loinc.org 55108-5 Clinical presentation O"},{"location":"ImmunizationAdministrationSections/#immunization-administration","title":"Immunization Administration","text":"<ul> <li>title: 'Liste der verabreichten Impfungen' in german or 'Liste Vaccin administr\u00e9' in french or 'Lista Vaccinazione somministrata' in italian or 'List Immunization Administration' in english or titles in other languages are also allowed</li> <li>reference: </li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"administration\",\n      \"title\" : \"Immunization Administration\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"11369-6\",\n            \"display\" : \"Hx of Immunization\"\n          }\n       ],\n     },\n     \"text\": {},\n     \"entry\" : [\n       {\n         \"reference\" : \"Immunization/&lt;id&gt;\"\n       }\n     ]\n  }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/#medical-problems","title":"Medical Problems","text":"<ul> <li>title: 'Liste der Medizinischen Problemen' in german or 'Liste Vaccin administr\u00e9' in french or 'Lista Vaccinazione somministrata' in italian or 'List Immunization Administration' in english or titles in other languages are also allowed</li> <li>reference: </li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"medicalproblems\",\n      \"title\" : \"Liste der Medizinischen Problemen\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"11450-4\",\n            \"display\" : \"Problem list Reported\"\n          }\n       ],\n     },\n     \"text\": {},\n     \"entry\" : [\n       {\n         \"reference\" : \"Condition/&lt;id&gt;\"\n       }\n     ]\n  }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/#past-illnesses","title":"Past Illnesses","text":"<ul> <li>titel: 'Bisherige Krankheiten' in german or 'Maladies ant\u00e9rieures' in french or 'Malattie precedenti' in italian or 'Previous illnesses' in english or titles in other languages are also allowed                                                                                                                                                                                            </li> <li>reference: A list of Condition resources declaring past illnesses the patient is recovered from - see CH VACD Past Illness Profile</li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"pastillnesses\",\n      \"title\" : \"Bisherige Krankheiten\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"11348-0\",\n            \"display\" : \"Hx of Past illness\"\n          }\n       ],\n     },\n     \"text\": {},\n     \"entry\" : [\n       {\n         \"reference\" : \"Condition/&lt;id&gt;\"\n       }\n     ]\n  }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/#allergies-and-intolerences","title":"Allergies and Intolerences","text":"<ul> <li>title: 'Allergien' in german or 'Les allergies' in french or 'Allergie' in italian or 'Allergies' in english or titles in other languages are also allowed                                                                                                                                                                                                                                                                  </li> <li>reference: A list of AllergyIntolerance resources defining the allergies and intolerances - see CH VACD AllergyIntolerance Profile</li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"allergyintolerances\",\n      \"title\" : \"Allergies\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"48765-2\",\n            \"display\" : \"Allergies and adverse reactions Document\"\n          }\n       ],\n     },\n     \"text\": {},\n     \"entry\" : [\n       {\n         \"reference\" : \"AllergyIntolerance/&lt;id&gt;\"\n       }\n     ]\n  }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/#other-relevant-observatons","title":"Other Relevant Observatons","text":"<ul> <li>title: 'Weiter relevante Beobachtungen' in german or 'Autres observations pertinentes' in french or 'Altre osservazioni rilevanti' in italian or 'Other Relevant Observations' in english or titles in other languages are also allowed</li> <li>reference: The Condition resource defining the gestational age - see CH VACD Other Relevant Observations</li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"otherrelevantobservations\",\n      \"title\" : \"Altre osservazioni rilevant\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"30954-2\",\n            \"display\" : \"Relevant diagnostic tests/laboratory data Narrative\"\n          }\n       ],\n     },\n     \"text\": {},\n     \"entry\" : [\n       {\n         \"reference\" : \"Condition/&lt;id&gt;\"\n       }\n     ]\n  }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/#laboratory-serology","title":"Laboratory-Serology","text":"<ul> <li>title: 'Laborbefund - Serologie' in german or 'R\u00e9sultats de laboratoire - S\u00e9rologie' in french or 'Risultati di laboratorio - Sierologia' in italian or 'Laboratory findings - Serology' in english or titles in other languages are also allowed</li> <li>reference: A list of Condition resources defining the lab results - see CH VACD Laboratory And Serology Profile</li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"laboratory-serology\",\n      \"title\" : \"R\u00e9sultats de laboratoire - S\u00e9rologie\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"18727-8\",\n            \"display\" : \"Serology studies (set)\"\n          }\n       ],\n     },\n     \"text\": {},\n     \"entry\" : [\n       {\n         \"reference\" : \"Observation/&lt;id&gt;\"\n       }\n     ]\n  }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/#pregnancy","title":"Pregnancy","text":"<ul> <li>title: 'Schwangerschaft' in german or 'Grossesse' in french or 'Gravidanza' in italian or 'Pregnancy' in english or titles in other languages are also allowed</li> <li>reference: the Condition resource for pregnancy - see CH VACD Pregnancy Profile</li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"pregnancy\",\n      \"title\" : \"Gravidanza\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"10162-6\",\n            \"display\" : \"Pregnancies Hx\"\n          }\n       ],\n     },\n     \"text\": {},\n     \"entry\" : [\n       {\n         \"reference\" : \"Condition/&lt;id&gt;\"\n       }\n     ]\n  }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/#annotation","title":"Annotation","text":"<ul> <li>title: 'Kommentar' in german or 'Commentaire' in french or 'Osservazione' in italian or 'Comment' in english or titles in other languages are also allowed</li> <li>text: The annotation comment can be added here as narrative.</li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"annotation\",\n      \"title\" : \"Commentaire\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"48767-8\",\n            \"display\" : \"Annotation comment Imp\"\n          }\n       ],\n     },\n     \"text\": {}\n  }\n</code></pre>"},{"location":"ImmunizationAdministrationSections/#original-representation","title":"Original representation","text":"<ul> <li>title: Original representation</li> <li>reference: Binary resource containing the original representation of the content as PDF.</li> </ul> <pre><code>  \"section\" : [\n    {\n      \"id\" : \"originalRepresentation\",\n      \"title\" : \"Original representation\",\n      \"code\" : {\n        \"coding\" : [\n          {\n            \"system\" : \"http://loinc.org\",\n            \"code\" : \"55108-5\",\n            \"display\" : \"Clinical presentation\"\n          }\n       ],\n     },\n     \"text\": {},\n     \"entry\" : [\n       {\n         \"reference\" : \"Binary/&lt;id&gt;\"\n       }\n     ]\n  }\n</code></pre>"},{"location":"MedicationCardDocument/","title":"Medication Card document","text":"<p>In a primary system, different medications are documented in a treatment context. Primary systems can use this Exchange Format to generate a Medication Card document with the help of the Content Creator.</p>"},{"location":"MedicationCardDocument/#bundle","title":"Bundle","text":"<p>Profile information</p> <p>In the resource \"Bundle\", all resources are collected in a container.</p> <ul> <li>id: Local id of the resource (line 3)</li> <li>meta: Shows the metadata of the document (line 4 to 9).</li> <li>identifier: Unique identifier for the bundle - fixed Value: \"urn:ietf:rfc:3986\" (line 10 to 13).</li> <li>type: Indicates the purpose of this bundle - fixed Value: \"document\"; binding: BundleType (line 14).</li> <li>timestamp: The date/time the bundle was composed (line 15).</li> <li>entry: The list to add all resources belonging to the document (line 16-18).</li> </ul> <pre><code>  {\n    \"resourceType\" : \"Bundle\",\n    \"id\" : \"2-7-MedicationCard\",\n    \"meta\" : {\n      \"lastUpdated\" : \"2020-02-21T12:31:59.738+00:00\",\n      \"profile\" : [\n        \"http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-document-medicationcard\"\n     ]\n   },\n  \"identifier\" : {\n    \"system\" : \"urn:ietf:rfc:3986\",\n    \"value\" : \"urn:uuid:6b6ed376-a7da-44cb-92d1-e75ce1ae73b0\"\n  },\n  \"type\" : \"document\",\n  \"timestamp\" : \"2012-02-04T14:05:00+01:00\",\n  \"entry\" : [\n    {\n      \"fullUrl\" : \"http://test.fhir.ch/r4/Composition/2-7-MedicationCard\",\n</code></pre>"},{"location":"MedicationCardDocument/#composition","title":"Composition","text":"<p>Profile information</p> <p>In the resource \"Composition\", general information about the document is specified.</p> <ul> <li>entry: An entry in a bundle resource - will either contain a resource or information about a resource (line 1)</li> <li>id: Local id of the resource (line 6).</li> <li>language: Specifies the language of the document - binding: CommonLanguages (line 7).</li> <li>text: Presents the narrative text of the resource (line 8 to 11).</li> <li>extension: Extension to Information Recipient (line 12 to 19).</li> <li>identifier: A version-independent identifier for the Composition (line 20 to 23).</li> <li>status: The status of the document - fixed Value: \"final\"; binding: CompositionStatus (line 24).</li> <li>type: Specifies the particular kind of composition - binding: DocumentEntry.typeCode(line 25 to 38).</li> </ul> <pre><code>  \"entry\" : [\n    {\n      \"fullUrl\" : \"http://test.fhir.ch/r4/Composition/2-7-MedicationCard\",  \n      \"resource\" : {\n        \"resourceType\" : \"Composition\",\n        \"id\" : \"2-7-MedicationCard\",\n        \"language\" : \"de-CH\",\n        \"text\" : {\n          \"status\" : \"extensions\",\n         \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\" xml:lang=\\\"de-CH\\\" lang=\\\"de-CH\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;div style=\\\"display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%\\\"&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Resource \\\"2-7-MedicationCard\\\"  (Language \\\"de-CH\\\") &lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;EPR Information Recipient&lt;/b&gt;: &lt;a href=\\\"#Patient_MonikaWegmuellerRecipient\\\"&gt;See above (Patient/MonikaWegmuellerRecipient)&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: id: urn:uuid:6b6ed376-a7da-44cb-92d1-e75ce1ae73b0&lt;/p&gt;&lt;p&gt;&lt;b&gt;status&lt;/b&gt;: final&lt;/p&gt;&lt;p&gt;&lt;b&gt;type&lt;/b&gt;: Medication summary &lt;span style=\\\"background: LightGoldenRodYellow; margin: 4px; border: 1px solid khaki\\\"&gt; (&lt;a href=\\\"https://loinc.org/\\\"&gt;LOINC&lt;/a&gt;#56445-0; &lt;a href=\\\"https://browser.ihtsdotools.org/\\\"&gt;SNOMED CT&lt;/a&gt;#721912009\\\"Medication summary document (record artifact)\\\")&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;date&lt;/b&gt;: 2012-02-04T14:05:00+01:00&lt;/p&gt;&lt;p&gt;&lt;b&gt;author&lt;/b&gt;: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=\\\"#Practitioner_FamilienHausarzt\\\"&gt;See above (Practitioner/FamilienHausarzt)&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\\\"#Organization_Hausarzt\\\"&gt;See above (Organization/Hausarzt)&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;title&lt;/b&gt;: Medikationsplan&lt;/p&gt;&lt;p&gt;&lt;b&gt;confidentiality&lt;/b&gt;: N&lt;/p&gt;&lt;p&gt;&lt;b&gt;custodian&lt;/b&gt;: &lt;a href=\\\"#Organization_Custodian\\\"&gt;See above (Organization/Custodian)&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;\"\n        },\n        \"extension\" : [\n          {\n            \"url\" : \"http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-informationrecipient\",\n            \"valueReference\" : {\n             \"reference\" : \"Patient/MonikaWegmuellerRecipient\"\n            }\n          }\n        ],\n        \"identifier\" : {\n          \"system\" : \"urn:ietf:rfc:3986\",\n          \"value\" : \"urn:uuid:6b6ed376-a7da-44cb-92d1-e75ce1ae73b0\"\n        },\n        \"status\" : \"final\",\n        \"type\" : {\n          \"coding\" : [\n            {\n              \"system\" : \"http://loinc.org\",\n              \"code\" : \"56445-0\",\n              \"display\" : \"Medication summary\"\n            },\n            {\n              \"system\" : \"http://snomed.info/sct\",\n              \"code\" : \"721912009\",\n              \"display\" : \"Medication summary document (record artifact)\"\n            }\n          ]\n        },\n</code></pre> <ul> <li>subject: Who the composition is about. Its a reference to the resource contained as entry in the bundle (line 39 to 44).</li> <li>date The date of the composition creation (line 42).</li> <li>author: Identifies who is responsible for the information in the composition (line 43 to 56).</li> <li>extension: Extension to EPR Time (line 45 to 50).</li> </ul> <pre><code>      \"subject\": {\n         \"reference\": \"Patient/MonikaWegmueller\"\n       },\n       \"date\": \"2012-02-04T14:05:00+01:00\",\n       \"author\": [\n         {\n           \"extension\": [\n             {\n               \"url\": \"http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-time\",\n               \"valueDateTime\": \"2012-02-04T13:55:00+01:00\"\n             }\n           ],\n           \"reference\": \"Practitioner/FamilienHausarzt\"\n         },\n         {\n           \"reference\": \"Organization/Hausarzt\"\n         }\n       ],\n</code></pre> <ul> <li>title: Human readable label for the composition.</li> </ul> <pre><code>       \"title\": \"Medikationsplan\",\n</code></pre> <ul> <li>confidentiality: Level of confidentiality of the Composition - binding: v3.ConfidentialityClassification (2014-03-26).</li> <li>extension EPR Confidentiality Code</li> </ul> <pre><code>       \"confidentiality\": \"N\",\n       \"_confidentiality\": {\n         \"extension\": [\n           {\n             \"url\": \"http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-confidentialitycode\",\n             \"valueCodeableConcept\": {\n               \"coding\": [\n                 {\n                   \"system\": \"http://snomed.info/sct\",\n                   \"code\": \"17621005\",\n                   \"display\": \"Normally accessible\"\n                 }\n               ]\n             }\n           }\n         ]\n       },\n</code></pre> <ul> <li>custodian: Organization who is responsible for the document and access.</li> </ul> <pre><code>       \"custodian\": {\n         \"reference\": \"Organization/Custodian\"\n       },\n</code></pre> <ul> <li>section: The root of the sections that make up the composition.</li> </ul> <pre><code>       \"section\": [\n         {\n           \"title\": \"Medikamentenliste\",\n           \"code\": {\n             \"coding\": [\n               {\n                 \"system\": \"http://loinc.org\",\n                 \"code\": \"10160-0\",\n                \"display\": \"History of medication use\"\n               }\n             ]\n           },\n           \"entry\": [\n             {\n               \"reference\": \"MedicationStatement/2-7-MedStatBeloczok\"\n             },\n             {\n               \"reference\": \"MedicationStatement/2-7-MedStatNorvasc\"\n             }\n           ]\n         },\n         {\n           \"title\": \"Kommentar\",\n           \"code\": {\n             \"coding\": [\n               {\n                 \"system\": \"http://loinc.org\",\n                 \"code\": \"48767-8\",\n                 \"display\": \"Annotation comment\"\n               }\n             ]\n           },\n           \"text\": {\n             \"status\": \"generated\",\n             \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;\\n              &lt;span id=\\\"co1\\\"&gt;\\n                  Kommentar zu Medication Treatment\\n              &lt;/span&gt;\\n            &lt;/div&gt;\"\n           }\n         },\n         {\n           \"title\": \"Original Darstellung\",\n           \"code\": {\n             \"coding\": [\n               {\n                 \"system\": \"http://loinc.org\",\n                 \"code\": \"55108-5\",\n                 \"display\": \"Clinical presentation\"\n               }\n             ]\n           },\n           \"text\": {\n             \"status\": \"generated\",\n             \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;\\n              &lt;a href=\\\"Binary/2-7-pdf\\\"&gt;Representation of the original view&lt;/a&gt;\\n            &lt;/div&gt;\"\n           },\n           \"entry\": [\n             {\n               \"reference\": \"Binary/2-7-pdf\"\n             }\n           ]\n         }\n       ]\n     }\n   },\n</code></pre>"},{"location":"MedicationCardDocument/#information-about-the-patient","title":"Information about the patient","text":"<p>In the \"Patient\" resource, the demographic and administrative data of a patient are specified.</p> <p>Profile information</p> <pre><code>  \"resource\": {\n      \"resourceType\": \"Patient\",\n      \"id\": \"MonikaWegmueller\",\n      \"text\": {\n        \"status\": \"generated\",\n        \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: Medical record number: 11111111&lt;/p&gt;&lt;p&gt;&lt;b&gt;name&lt;/b&gt;: Monika Wegm\u00fcller &lt;/p&gt;&lt;p&gt;&lt;b&gt;gender&lt;/b&gt;: female&lt;/p&gt;&lt;p&gt;&lt;b&gt;birthDate&lt;/b&gt;: 1943-05-15&lt;/p&gt;&lt;p&gt;&lt;b&gt;address&lt;/b&gt;: Wiesenstr. 12 Z\u00fcrich 8003 CH &lt;/p&gt;&lt;/div&gt;\"\n      },\n     \"identifier\": [\n        {\n          \"type\": {\n            \"coding\": [\n              {\n                \"system\": \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                \"code\": \"MR\"\n              }\n            ]\n          },\n          \"system\": \"urn:oid:2.999\",\n          \"value\": \"11111111\"\n        }\n      ],\n      \"name\": [\n        {\n          \"family\": \"Wegm\u00fcller\",\n          \"given\": [\n            \"Monika\"\n          ]\n        }\n      ],\n      \"gender\": \"female\",\n      \"birthDate\": \"1943-05-15\",\n      \"address\": [\n        {\n          \"line\": [\n            \"Wiesenstr. 12\"\n          ],\n          \"city\": \"Z\u00fcrich\",\n          \"postalCode\": \"8003\",\n          \"country\": \"CH\"\n        }\n      ]\n    }\n  },\n</code></pre>"},{"location":"MedicationCardDocument/#information-about-the-practitioner","title":"Information about the practitioner","text":"<p>The resource Practitioner indicates which practitioner has prescribed a medication.</p> <p>Profile information</p> <pre><code> \"resource\" : {\n      \"resourceType\" : \"Practitioner\",\n      \"id\" : \"FamilienHausarzt\",\n      \"text\" : {\n        \"status\" : \"generated\",\n        \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;div style=\\\"display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%\\\"&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Resource \\\"FamilienHausarzt\\\" &lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: id: 7601000234438&lt;/p&gt;&lt;p&gt;&lt;b&gt;name&lt;/b&gt;: Familien Hausarzt &lt;/p&gt;&lt;p&gt;&lt;b&gt;address&lt;/b&gt;: Krankenstrasse 2 Z\u00fcrich 8005 CH &lt;/p&gt;&lt;/div&gt;\"\n      },\n      \"identifier\" : [\n        {\n          \"system\" : \"urn:oid:2.51.1.3\",\n          \"value\" : \"7601000234438\"\n        }\n      ],\n      \"name\" : [\n        {\n          \"family\" : \"Hausarzt\",\n          \"given\" : [\n            \"Familien\"\n          ]\n        }\n      ],\n      \"address\" : [\n        {\n          \"line\" : [\n            \"Krankenstrasse 2\"\n          ],\n          \"city\" : \"Z\u00fcrich\",\n          \"postalCode\" : \"8005\",\n          \"country\" : \"CH\"\n        }\n      ]\n    }\n</code></pre>"},{"location":"MedicationCardDocument/#information-about-the-organization","title":"Information about the organization","text":"<p>The resource stores the information about the organization that create the Medication Card document.</p> <p>Profile information</p> <pre><code> \"resource\" : {\n      \"resourceType\" : \"Organization\",\n      \"id\" : \"Hausarzt\",\n      \"text\" : {\n        \"status\" : \"generated\",\n        \"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;div style=\\\"display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%\\\"&gt;&lt;p style=\\\"margin-bottom: 0px\\\"&gt;Resource \\\"Hausarzt\\\" &lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: id: 7601000234438&lt;/p&gt;&lt;p&gt;&lt;b&gt;name&lt;/b&gt;: Hausarzt&lt;/p&gt;&lt;p&gt;&lt;b&gt;address&lt;/b&gt;: Krankenstrasse 2 Z\u00fcrich 8005 CH &lt;/p&gt;&lt;/div&gt;\"\n      },\n      \"identifier\" : [\n        {\n          \"system\" : \"urn:oid:2.51.1.3\",\n          \"value\" : \"7601000234438\"\n        }\n      ],\n      \"name\" : \"Hausarzt\",\n      \"address\" : [\n        {\n          \"line\" : [\n            \"Krankenstrasse 2\"\n          ],\n          \"city\" : \"Z\u00fcrich\",\n          \"postalCode\" : \"8005\",\n          \"country\" : \"CH\"\n        }\n      ]\n    }\n</code></pre>"},{"location":"MedicationCardDocument/#medication","title":"Medication","text":"<p>In the resource \"MedicationStatement\" the data of the patient's medication are specified.</p> <p>Profile information</p>"},{"location":"MedicationCardDocument/#medication-information","title":"Medication information","text":"<ul> <li>id: Local id of the resource (line 2).</li> <li>text: Presents the narrative text of the resource (line 3, 19, 54).</li> <li>contained: The resource cannot be identified independently and therefore cannot exist independently apart from the resource it contains (line 7 to 73).</li> <li>code: A code (or set of codes) that specify this medication, or a textual description if no code is available. (line 11, 25, 35, 41, 50, 67).</li> <li>coding A reference to a code defined by a terminology system. (line 12,22, 47).</li> <li>form Describes the form of the medication. Powder; tablets; capsule. (line 21 to 29).</li> <li>amount: A relationship of two Quantity values - expressed as a numerator and a denominator. (line 30 to 36).</li> <li>ingredient:  Particular ingredient of a medication (line 44 to 71).</li> <li>strength: A relationship of two Quantity values - expressed as a numerator and a denominator (line 56 to 69).</li> </ul> <pre><code> \"resourceType\": \"MedicationStatement\",\n        \"id\": \"2-7-MedStatBeloczok\",\n        \"text\": {\n          \"status\": \"extensions\",\n          \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative&lt;/b&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;b&gt;CH EMED Extension Treatment Plan&lt;/b&gt;&lt;/p&gt;&lt;h3&gt;Urls&lt;/h3&gt;&lt;table class=\\\"grid\\\"&gt;&lt;tr&gt;&lt;td&gt;-&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;*&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;&lt;b&gt;value&lt;/b&gt;: id: urn:uuid:5712fffe-20c6-11e6-b67b-9e71128cae77&lt;/p&gt;&lt;h3&gt;Urls&lt;/h3&gt;&lt;table class=\\\"grid\\\"&gt;&lt;tr&gt;&lt;td&gt;-&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;*&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;&lt;b&gt;value&lt;/b&gt;: id: urn:uuid:5712fffe-20c6-11e6-b67b-9e71128cae77&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: id: urn:uuid:d0f885ca-afa6-4e7e-905d-f7698f9607aa&lt;/p&gt;&lt;p&gt;&lt;b&gt;status&lt;/b&gt;: completed&lt;/p&gt;&lt;p&gt;&lt;b&gt;medication&lt;/b&gt;: &lt;a name=\\\"med\\\"&gt; &lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;b&gt;code&lt;/b&gt;: &lt;span title=\\\"Codes: {urn:oid:2.51.1.1 7680521101306}\\\"&gt;BELOC ZOK Ret Tabl 50 mg&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;form&lt;/b&gt;: &lt;span title=\\\"Codes: {urn:oid:0.4.0.127.0.16.1.1.2.1 10219000}\\\"&gt;Tablet&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;amount&lt;/b&gt;: 30 Tablet (unit of presentation)/1 Package&lt;/p&gt;&lt;h3&gt;Ingredients&lt;/h3&gt;&lt;table class=\\\"grid\\\"&gt;&lt;tr&gt;&lt;td&gt;-&lt;/td&gt;&lt;td&gt;&lt;b&gt;Item[x]&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Strength&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;*&lt;/td&gt;&lt;td&gt;&lt;span title=\\\"Codes: {http://snomed.info/sct 372826007}\\\"&gt;Metoprolol&lt;/span&gt;&lt;/td&gt;&lt;td&gt;50 milligram/1 Tablet (unit of presentation)&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;b&gt;subject&lt;/b&gt;: &lt;a href=\\\"#Patient_MonikaWegmueller\\\"&gt;See above (Patient/MonikaWegmueller)&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;reasonCode&lt;/b&gt;: &lt;span title=\\\"Codes: \\\"&gt;Bluthochdruck&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;note&lt;/b&gt;: -&lt;/p&gt;&lt;h3&gt;Dosages&lt;/h3&gt;&lt;table class=\\\"grid\\\"&gt;&lt;tr&gt;&lt;td&gt;-&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;*&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;*&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;*&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;\"\n        },\n        \"contained\": [\n          {\n            \"resourceType\": \"Medication\",\n           \"id\": \"med\",\n           \"code\": {\n             \"coding\": [\n               {\n                 \"system\": \"urn:oid:2.51.1.1\",\n                 \"code\": \"7680521101306\",\n               \"display\": \"BELOC ZOK Ret Tabl 50 mg 30 Stk\"\n             }\n           ],\n           \"text\": \"BELOC ZOK Ret Tabl 50 mg\"\n         },\n         \"form\": {\n           \"coding\": [\n             {\n               \"system\": \"urn:oid:0.4.0.127.0.16.1.1.2.1\",\n               \"code\": \"10219000\",\n               \"display\": \"Tablet\"\n             }\n           ]\n         },\n         \"amount\": {\n           \"numerator\": {\n             \"value\": 30,\n             \"unit\": \"Tablet (unit of presentation)\",\n             \"system\": \"http://snomed.info/sct\",\n             \"code\": \"732936001\"\n           },\n           \"denominator\": {\n             \"value\": 1,\n             \"unit\": \"Package\",\n             \"system\": \"http://unitsofmeasure.org\",\n             \"code\": \"{Package}\"\n             }\n           },\n           \"ingredient\": [\n             {\n               \"itemCodeableConcept\": {\n                 \"coding\": [\n                   {\n                     \"system\": \"http://snomed.info/sct\",\n                     \"code\": \"372826007\",\n                     \"display\": \"Metoprolol (substance)\"\n                   }\n                 ],\n                 \"text\": \"Metoprolol\"\n               },\n               \"strength\": {\n                 \"numerator\": {\n                   \"value\": 50,\n                   \"unit\": \"milligram\",\n                   \"system\": \"http://unitsofmeasure.org\",\n                   \"code\": \"mg\"\n                 },\n                 \"denominator\": {\n                   \"value\": 1,\n                   \"unit\": \"Tablet (unit of presentation)\",\n                   \"system\": \"http://snomed.info/sct\",\n                   \"code\": \"732936001\"\n                 }\n               }\n             }\n           ]\n         }\n       ],\n</code></pre> <ul> <li>indentifier: Identifiers associated with this Medication Statement that are defined by business processes and/or used to refer to it when a direct URL reference to the resource itself is not appropriate -fixed Value \"urn:ietf:rfc:3986\".</li> </ul> <pre><code> \"identifier\": [\n        {\n          \"system\": \"urn:ietf:rfc:3986\",\n          \"value\": \"urn:uuid:d0f885ca-afa6-4e7e-905d-f7698f9607aa\"\n        }\n      ],\n</code></pre> <ul> <li>status: A code representing the status of the use of the medication - fixed Value: \"completed\"; binding: Medication Status Codes.</li> </ul> <pre><code> \"status\": \"completed\",\n</code></pre> <ul> <li>subject: The person who is taking the medication.</li> </ul> <pre><code> \"subject\": {\n                    \"reference\": \"Patient/69d661eb-e3ed-4e86-b34c-b5e747c13021\"\n                },\n</code></pre> <ul> <li>reasonCode: A reason for why the medication is taken - binding: Condition/Problem/DiagnosisCodes .</li> </ul> <pre><code> \"reasonCode\": [{\n                        \"text\": \"Bluthochdruck/Herz\"\n                    }\n</code></pre> <ul> <li>note: Provides extra information about the medication statement that is not conveyed by the other attributes.</li> </ul> <pre><code> \"note\": [\n         {\n           \"text\": \"-\"\n         }\n       ],\n</code></pre>"},{"location":"MedicationCardDocument/#dosage","title":"Dosage","text":"<ul> <li>text: Non-structured dosage element (line 3).</li> <li>timing: when the medication should be taken (line 6 to 16).</li> <li>route: Indicates the route of administration - binding: SNOMEDCTRouteCodes; EDQM - RouteOfAdministration (line 17 to 25).</li> <li>doseAndRate: The amount of medication administered (line 26 to 36).</li> </ul> <p>Example normal Dosing (incl. Dosage Non-Structured):</p> <p>Profile information (normal Dosing)</p> <p>Profile information (Dosage Non-Structured)</p> <pre><code> \"dosage\" : [\n    {\n      \"text\" : \"Morgens und abends je 1 Tablette einnehmen\"\n    },\n    {\n      \"timing\" : {\n          \"repeat\" : {\n          \"boundsPeriod\" : {\n              \"start\" : \"2012-02-04\"\n          },\n          \"when\" : [\n              \"MORN\",\n              \"EVE\"\n          ]\n        }\n      },\n      \"route\" : {\n          \"coding\" : [\n          {\n              \"system\" : \"urn:oid:0.4.0.127.0.16.1.1.2.1\",\n              \"code\" : \"20053000\",\n              \"display\" : \"Oral use\"\n          }\n        ]\n      },\n      \"doseAndRate\" : [\n          {\n          \"doseQuantity\" : {\n              \"value\" : 1,\n              \"unit\" : \"Tablet (unit of presentation)\",\n              \"system\" : \"http://snomed.info/sct\",\n              \"code\" : \"732936001\"\n          }\n        }\n      ]\n    }\n  ]\n</code></pre> <ul> <li>text: Non-structured dosage element (line 3).</li> <li>timing: when the medication should be taken (line 7 to 16).</li> <li>route: Indicates the route of administration - binding: SNOMEDCTRouteCodes; EDQM - RouteOfAdministration (line 17 to 25).</li> <li>doseAndRate: The amount of medication administered (line 26 to 36).</li> </ul> <p>Example split Dosing (incl. Dosage Non-Structured):</p> <p>Profile information (split Dosing)</p> <p>Profile information (Dosage Non-Structured) <pre><code> \"dosage\": [\n          {\n            \"text\": \"Morgens 1 und abends 1/2 Tablette nehmen\"\n          },\n          {\n            \"sequence\": 1,\n            \"timing\": {\n              \"repeat\": {\n                \"boundsPeriod\": {\n                 \"start\": \"2012-02-04\"\n               },\n               \"when\": [\n                 \"MORN\"\n               ]\n             }\n           },\n           \"route\": {\n             \"coding\": [\n               {\n                 \"system\": \"urn:oid:0.4.0.127.0.16.1.1.2.1\",\n                 \"code\": \"20053000\",\n                 \"display\": \"Oral use\"\n               }\n             ]\n           },\n           \"doseAndRate\": [\n             {\n               \"doseQuantity\": {\n                 \"value\": 1,\n                 \"unit\": \"Tablet (unit of presentation)\",\n                 \"system\": \"http://snomed.info/sct\",\n                 \"code\": \"732936001\"\n               }\n             }\n           ]\n         },\n         {\n           \"sequence\": 2,\n           \"timing\": {\n             \"repeat\": {\n               \"boundsPeriod\": {\n                 \"start\": \"2012-02-04\"\n               },\n               \"when\": [\n                 \"EVE\"\n               ]\n             }\n           },\n           \"route\": {\n             \"coding\": [\n               {\n                 \"system\": \"urn:oid:0.4.0.127.0.16.1.1.2.1\",\n                 \"code\": \"20053000\",\n                 \"display\": \"Oral use\"\n               }\n             ]\n           },\n           \"doseAndRate\": [\n             {\n               \"doseQuantity\": {\n                 \"value\": 0.5,\n                 \"unit\": \"Tablet (unit of presentation)\",\n                 \"system\": \"http://snomed.info/sct\",\n                 \"code\": \"732936001\"\n               }\n             }\n           ]\n         }\n       ]\n     }\n   },\n</code></pre></p> <p>The resource \"Binary\" represents the original representation of the Medication Card document.</p> <pre><code> \"resource\": {\n                \"resourceType\": \"Binary\",\n                \"id\": \"2-7-pdf\",\n                \"language\": \"de-CH\",\n                \"contentType\": \"application/pdf\",\n                \"data\": \"JVBERi0xLjQKMSAwIG9iago8PAovVGl0bGU...\"\n            }\n</code></pre>"},{"location":"PDQ/","title":"Patient Demographics Query","text":"<p>Transaction to search for patient identities and data from a community using the patient demographic data as search criteria. Primary systems may use this transaction to verify if a patient uses a Swiss EPR and is already registered in the community.  </p>"},{"location":"PDQ/#overview","title":"Overview","text":"<p>Primary systems may use this transaction to search for patients which are already registered in the community, either because the patient opened the Swiss EPR in the community or because the patient opened the Swiss EPR in a remote community and was already registered by another primary system to store documents. In the Swiss EPR the IHE PDQV3 profile and transactions shall be used to search for patients by demographic data.</p> <p>To search for patients the primary system shall perform a Patient Demographic Query [ITI-47]. Within the query request the primary system shall provide the demographic data as search criteria. In the Swiss EPR each community must support the name, birthdate, gender and nationality. Individual communities may support other demographic data (e.g., address and other contact data).  </p> <p>The community sends a response with all patient data sets matching the search criteria. Each patient data set contains the known demographic data, the EPR-SPID and the assigned ID. The response contains the master data set as well as all known patient data sets, as registered by other primary systems.    </p>"},{"location":"PDQ/#transaction","title":"Transaction","text":""},{"location":"PDQ/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in the HL7 V3 standard with restrictions defined in the IHE PDQ V3 profile and the ordinances to the Swiss EPR.</p>"},{"location":"PDQ/#request-message","title":"Request Message","text":"<p>Since the HL7 V3 standard is very generic, the request message is quite lengthy and needs some background information to interpret. The raw version of a request message may be found here. For a step by step interpretation of the request message, see section below.</p>"},{"location":"PDQ/#message-interpretation","title":"Message Interpretation","text":"<p>The request message is not very complex, but lengthy due to the genericity of the HL7 V3 standard. Therefore the following step by step interpretation may be of help to interpret the response.</p> <p>The SOAP Header element conveys the following information:</p> <ul> <li>To element: The URL of the provide an register document set service.</li> <li>MessageID element: a UUID of the message.</li> <li>Action element: The SOAP action identifier of the request as defined in the IHE ITI Technical Framework.</li> </ul> SOAP header<pre><code> &lt;soap:Header&gt;\n  &lt;Action soap:mustUnderstand=\"true\"\n   xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:hl7-org:v3:PRPA_IN201305UV02&lt;/Action&gt;\n  &lt;MessageID xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:9fe7246b-8fab-4dd7-976e-c81bc1955575&lt;/MessageID&gt;\n  &lt;To xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;https://epd-test.ith-icoserve.com:7443/PIXPDQ/services/PIXPDQV3ManagerService&lt;/To&gt;\n  &lt;ReplyTo xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;\n   &lt;Address&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/Address&gt;\n  &lt;/ReplyTo&gt;\n &lt;/soap:Header&gt;\n</code></pre> <p>For the patient demographic query no Security header element is required, since in the Swiss EPR the access to the patient data is authorized for all applications, which are registered and authenticate with a client certificate (see section Security Requirements).</p> <p>The SOAP Body element conveys the administrative information required for a PRPA_IN201305UV02 message in HL7 V3 syntax in which primary systems must set the following values:</p> <ul> <li>creationTime: A timestamp in unix time format.</li> <li>sender : The OID of the sender application initiating the request.</li> <li>receiver: The OID of the receiver application which shall respond to the request.</li> </ul> PRPA_IN201305UV02 message<pre><code>   &lt;id root=\"1.2.3.4\"/&gt;\n   &lt;creationTime value=\"20230911143411\"/&gt;\n   &lt;interactionId extension=\"PRPA_IN201305UV02\" root=\"2.16.840.1.113883.1.6\"/&gt;\n   &lt;processingCode code=\"P\"/&gt;\n   &lt;processingModeCode code=\"T\"/&gt;\n   &lt;acceptAckCode code=\"AL\"/&gt;\n   &lt;receiver typeCode=\"RCV\"&gt;\n    &lt;device classCode=\"DEV\" determinerCode=\"INSTANCE\"&gt;\n     &lt;id root=\"1.3.6.1.4.1.21367.2017.2.5.97\"/&gt;\n     &lt;asAgent classCode=\"AGNT\"&gt;\n      &lt;representedOrganization classCode=\"ORG\" determinerCode=\"INSTANCE\"&gt;\n       &lt;id root=\"1.3.6.1.4.1.21367.2017.2.7.127\"/&gt;\n      &lt;/representedOrganization&gt;\n     &lt;/asAgent&gt;\n    &lt;/device&gt;\n   &lt;/receiver&gt;\n   &lt;sender typeCode=\"SND\"&gt;\n    &lt;device classCode=\"DEV\" determinerCode=\"INSTANCE\"&gt;\n     &lt;id root=\"1.2.3.4\"/&gt;\n    &lt;/device&gt;\n   &lt;/sender&gt;\n</code></pre> <p>The query is encoded in a HL7 V3 controlAct object as follows:</p> PRPA_IN201305UV02 message<pre><code>   &lt;controlActProcess classCode=\"CACT\" moodCode=\"EVN\"&gt;\n    &lt;code code=\"PRPA_TE201305UV02\" codeSystem=\"2.16.840.1.113883.1.6\"/&gt;\n    &lt;queryByParameter&gt;\n     &lt;queryId extension=\"16944356511831\" root=\"1.2.840.114350.1.13.28.1.18.5.999\"/&gt;\n     &lt;statusCode code=\"new\"/&gt;\n     &lt;responseModalityCode code=\"R\"/&gt;\n     &lt;responsePriorityCode code=\"I\"/&gt;\n     &lt;parameterList&gt;\n      &lt;livingSubjectId&gt;\n       &lt;value extension=\"08242eb8-dd47-4298-8d2f-25d60114f137\" root=\"1.1.1.2.2\"/&gt;\n       &lt;semanticsText&gt;LivingSubject.id&lt;/semanticsText&gt;\n      &lt;/livingSubjectId&gt;\n      &lt;otherIDsScopingOrganization&gt;\n       &lt;value root=\"1.3.6.1.4.1.21367.2017.2.5.93\"/&gt;\n       &lt;semanticsText&gt;OtherIDs.scopingOrganization.id&lt;/semanticsText&gt;\n      &lt;/otherIDsScopingOrganization&gt;\n      &lt;otherIDsScopingOrganization&gt;\n       &lt;value root=\"2.16.756.5.30.1.127.3.10.3\"/&gt;\n       &lt;semanticsText&gt;OtherIDs.scopingOrganization.id&lt;/semanticsText&gt;\n      &lt;/otherIDsScopingOrganization&gt;\n     &lt;/parameterList&gt;\n    &lt;/queryByParameter&gt;\n   &lt;/controlActProcess&gt;\n</code></pre> <p>The HL7 controlAct object conveys the query search parameter in a HL7 V3 parameterList element.</p> <p>In the above example these are </p> <ul> <li>the livingSubjectId conveying the local ID in the primary system of the patient data to search for,</li> <li>the otherIDsScopingOrganization to match with the registered patient data,  </li> </ul> parameterList element<pre><code>     &lt;parameterList&gt;\n      &lt;livingSubjectId&gt;\n       &lt;value extension=\"08242eb8-dd47-4298-8d2f-25d60114f137\" root=\"1.1.1.2.2\"/&gt;\n       &lt;semanticsText&gt;LivingSubject.id&lt;/semanticsText&gt;\n      &lt;/livingSubjectId&gt;\n      &lt;otherIDsScopingOrganization&gt;\n       &lt;value root=\"1.3.6.1.4.1.21367.2017.2.5.93\"/&gt;\n       &lt;semanticsText&gt;OtherIDs.scopingOrganization.id&lt;/semanticsText&gt;\n      &lt;/otherIDsScopingOrganization&gt;\n      &lt;otherIDsScopingOrganization&gt;\n       &lt;value root=\"2.16.756.5.30.1.127.3.10.3\"/&gt;\n       &lt;semanticsText&gt;OtherIDs.scopingOrganization.id&lt;/semanticsText&gt;\n      &lt;/otherIDsScopingOrganization&gt;\n     &lt;/parameterList&gt;\n</code></pre> <p>The query supports many more search options and filter parameter. For a documentation of the options see IHE PDQ V3.</p>"},{"location":"PDQ/#response-message","title":"Response Message","text":"<p>Since the HL7 V3 standard is very generic, the response message is quite lengthy and needs some background information to interpret. The raw version of a response message may be found here. For a step by step interpretation of the message, see section below.</p>"},{"location":"PDQ/#message-interpretation_1","title":"Message Interpretation","text":"<p>The PDQV3 service responds with a list of patient data which match the search parameter in a HL7 V3 subject child element of the controlAct object. The subject child element conveys the following information:</p> <ul> <li>id: the XAD PID, which identifies the patient in the community (line 50)  and the EPR-SPID (line 51).</li> <li>name: conveying the given and the family names of the matching patient data (line 54).</li> <li>administrativeGenderCode: conveying the coded value of patient gender (line 58), taken from the value sets defined in Annex 3.  </li> <li>birthTime: the data of birth of the matching patient data (line 59).</li> <li>addr: The address data of the patient (line 60).     </li> </ul> patient element<pre><code>       &lt;ns1:patient classCode=\"PAT\"&gt;\n        &lt;ns1:id xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:II\" root=\"1.3.6.1.4.1.21367.2017.2.5.93\" extension=\"25f98b34-0e01-48b7-a06c-f706eb4c485f\" assigningAuthorityName=\"XDS Affinity Domain\"/&gt;\n        &lt;ns1:id xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:II\" root=\"2.16.756.5.30.1.127.3.10.3\" extension=\"761337610411353650\" assigningAuthorityName=\"SPID\"/&gt;\n        &lt;ns1:statusCode code=\"active\"/&gt;\n        &lt;ns1:patientPerson classCode=\"PSN\" determinerCode=\"INSTANCE\"&gt;\n         &lt;ns1:name xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:PN\"&gt;\n          &lt;ns1:given&gt;Dylan Jose&lt;/ns1:given&gt;\n          &lt;ns1:family&gt;Dell&lt;/ns1:family&gt;\n         &lt;/ns1:name&gt;\n         &lt;ns1:administrativeGenderCode code=\"F\"/&gt;\n         &lt;ns1:birthTime xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:TS\" value=\"19890622\"/&gt;\n         &lt;ns1:addr xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:AD\" use=\"HP\"&gt;\n          &lt;ns1:city&gt;Pontarlier&lt;/ns1:city&gt;\n          &lt;ns1:postalCode&gt;25300&lt;/ns1:postalCode&gt;\n          &lt;ns1:streetName&gt;Ruelle de la Tour&lt;/ns1:streetName&gt;\n         &lt;/ns1:addr&gt;\n        &lt;/ns1:patientPerson&gt;\n        &lt;ns1:providerOrganization classCode=\"ORG\" determinerCode=\"INSTANCE\"&gt;\n         &lt;ns1:id xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:II\" root=\"1.3.6.1.4.1.21367.13.20.2000\"/&gt;\n         &lt;ns1:contactParty classCode=\"CON\"/&gt;\n        &lt;/ns1:providerOrganization&gt;\n        &lt;ns1:subjectOf1&gt;\n         &lt;ns1:queryMatchObservation classCode=\"COND\" moodCode=\"EVN\"&gt;\n          &lt;ns1:code xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:CD\" code=\"IHE_PDQ\"/&gt;\n          &lt;ns1:value xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:INT\" value=\"100\"/&gt;\n         &lt;/ns1:queryMatchObservation&gt;\n        &lt;/ns1:subjectOf1&gt;\n       &lt;/ns1:patient&gt;\n</code></pre>"},{"location":"PDQ/#transport-protocol","title":"Transport Protocol","text":"<p>The primary system shall send the request messages to the registry of the community using the http POST binding as defined in the W3C SOAP specification. It may look like:  </p> <pre><code>POST /PDQV3Service HTTP/1.1\nHost: company.example.org\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nContent-Type: application/soap+xml; charset=\"utf-8\"\nContent-Length: nnnn  \n</code></pre>"},{"location":"PDQ/#audit-log","title":"Audit Log","text":"<p>Primary systems shall store syslog messages to the audit record repository of the community using TLS transport protocol. The audit message uses XML formatting as specified in RFC 3881 with restrictions specified in the IHE ITI TF and the Extension 1 to Annex5 in the ordinances of the Swiss electronic patient record (see Section 1.5 \"Requirements on ATNA\").</p> iti-47-log.xml<pre><code>&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;AuditMessage&gt;\n &lt;EventIdentification EventActionCode=\"E\" EventDateTime=\"2020-09-30T19:27:29.386Z\" EventOutcomeIndicator=\"0\"&gt;\n  &lt;EventID csd-code=\"110112\" codeSystemName=\"DCM\" originalText=\"Query\"&gt;&lt;/EventID&gt;\n  &lt;EventTypeCode csd-code=\"ITI-47\" codeSystemName=\"IHE Transactions\" originalText=\"Patient Demographics Query\"&gt;&lt;/EventTypeCode&gt;\n &lt;/EventIdentification&gt;\n &lt;ActiveParticipant UserID=\"https://my_primary_system.com/PDQConsumer\" AlternativeUserID=\"201809\" UserIsRequestor=\"true\" NetworkAccessPointID=\"0045e6d09dd0\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"110153\" codeSystemName=\"DCM\" originalText=\"Source Role ID\"&gt;&lt;/RoleIDCode&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant UserID=\"_SYSTEM\" UserIsRequestor=\"true\" NetworkAccessPointID=\"0045e6d09dd0\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"%All\" codeSystemName=\"HealthShare\" originalText=\"%All\"&gt;&lt;/RoleIDCode&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant UserID=\"https://ehealthsuisse.ihe-europe.net/PDQService\" UserIsRequestor=\"false\" NetworkAccessPointID=\"ehealthsuisse.ihe-europe.net\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"110152\" codeSystemName=\"DCM\" originalText=\"Destination Role ID\"&gt;&lt;/RoleIDCode&gt;\n &lt;/ActiveParticipant&gt;\n &lt;AuditSourceIdentification AuditEnterpriseSiteID=\"2.16.756.5.30.1.109.6.1.3.1.1\" AuditSourceID=\"my.primary.system.ID\"&gt;\n  &lt;AuditSourceTypeCode csd-code=\"4\"&gt;&lt;/AuditSourceTypeCode&gt;\n &lt;/AuditSourceIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"CHPAM34^^^&amp;amp;1.3.6.1.4.1.12559.11.20.1&amp;amp;ISO\" ParticipantObjectTypeCode=\"1\" ParticipantObjectTypeCodeRole=\"1\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"2\" codeSystemName=\"RFC-3881\" originalText=\"Patient Number\"&gt;&lt;/ParticipantObjectIDTypeCode&gt;\n  &lt;ParticipantObjectName&gt;^Neil^Mellisa&lt;/ParticipantObjectName&gt;\n  &lt;ParticipantObjectDetail type=\"II\" value=\"RjlENjJBNjgtMDM1Mi0xMUVCLUE2RTgtMDI0MkFDMTQwMDAy\"&gt;&lt;/ParticipantObjectDetail&gt;\n &lt;/ParticipantObjectIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"1^^^&amp;amp;F9D62A4A-0352-11EB-A6E8-0242AC140002&amp;amp;ISO\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"24\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"ITI-47\" codeSystemName=\"IHE Transactions\" originalText=\"Patient Demographics Query\"&gt;&lt;/ParticipantObjectIDTypeCode&gt;\n  &lt;ParticipantObjectQuery&gt; &lt;!-- BASE-64 encoded copy of the query message --&gt; &lt;/ParticipantObjectQuery&gt;\n  &lt;ParticipantObjectDetail type=\"MSH-10\" value=\"MV5eXiZGOUQ2MkE2OC0wMzUyLTExRUItQTZFOC0wMjQyQUMxNDAwMDImSVNP\"&gt;&lt;/ParticipantObjectDetail&gt;\n &lt;/ParticipantObjectIdentification&gt;\n&lt;/AuditMessage&gt;\n</code></pre> <p>The message is made of the following blocks:</p> <ul> <li>EventIdentification: Event related information including the timestamp (line 3 .. 6).</li> <li>ActiveParticipant: Information related to the primary system performing the query (line 7 .. 9).</li> <li>ActiveParticipant: Information on the user initiating the transaction (line 10 .. 12).</li> <li>ActiveParticipant: Information on the responding service endpoint (line 13 .. 15).</li> <li>AuditSourceIdentification: Information related to the primary system performing the query (line 16 .. 18)</li> <li>ParticipantObjectIdentification: Information on the patients EPR accessed (line 19 .. 23)</li> <li>ParticipantObjectIdentification: Request message related information including a UBASE-64 encoded copy of the query (line 24 .. 28).</li> </ul>"},{"location":"PDQ/#security-requirements","title":"Security Requirements","text":"<p>To ensure privacy the transaction must be secured using https with mutual authentication, with X.509 certificates (extended validation required) and client and server side certificate validation.</p> <p>Note</p> <ul> <li>Some test environments dropped the mutual authentication or TLS for testing purposes. Please contact your test system provider on the details.</li> </ul>"},{"location":"PDQ/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment, test systems of the EPR communities or the EPR Playground.</p>"},{"location":"PIXFeed/","title":"PIX Feed","text":"<p>Transaction to register a patient in a community. Primary systems shall use this transaction to register patient data to be able to provide and retrieve documents to the patients EPR.</p>"},{"location":"PIXFeed/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction to register patient data with the local ID, the patient is registered in the primary system. In the Swiss EPR the IHE PIX V3 profile and transactions shall be used to register the patient data.  </p> <p>To register the patient data the primary system shall perform a Patient Identity Feed HL7 V3 [ITI-44] transaction. In the feed request the primary system must provide the demographic data as provided by the ZAS central service, which includes the name, birthdate, gender, nationality and the EPR-SPID. Primary systems may provide other demographic data (e.g., address and other contact data).</p> <p>The community response includes a success confirmation, or a error code in the case an error occurred in the community during registration. In case of success the community stores the patient data provided by the primary system, matches the data set to other patient data set registered by other primary systems and assigns the patient data set to a master patient record and the master patient ID (XAD-PID).</p> <p>To perform the PIX V3 feed fo the EPR, primary systems must retrieve the demographic data and the EPR-SPID from the ZAS central service. While the interface to be used by the communities is specified in the ordinances to the Swiss electronic patient dossier, the interface for primary systems is not, since communities provide simplified interfaces for primary systems to retrieve the data or included the interface in the registration workflow. Please contact the community you want to connect to on implementation details.   </p>"},{"location":"PIXFeed/#transaction","title":"Transaction","text":""},{"location":"PIXFeed/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in the HL7 V3 standard with restrictions defined in the IHE Patient Identity Feed HL7 V3 profile and the ordinances to the Swiss EPR.</p>"},{"location":"PIXFeed/#request-message","title":"Request Message","text":"<p>Due to the genericity of the underlying HL7 V3 standard, the request message is quite lengthy. A raw version of a request message may be found here.</p> <p>For a step by step interpretation of the request message, see section below.</p>"},{"location":"PIXFeed/#message-interpretation","title":"Message Interpretation","text":"<p>The request message is not very complex, but lengthy due to the genericity of the HL7 V3 standard.</p> <p>The SOAP Header element shall convey the following information:</p> <ul> <li>To element: The URL of the provide and register document set service.</li> <li>MessageID element: a UUID of the message.</li> <li>Action element: The SOAP action identifier of the request as defined in the IHE ITI Technical Framework.</li> </ul> <p>Optional elements may be included according to the specification in the W3C SOAP specification.</p> SOAP header<pre><code>&lt;env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n  &lt;env:Header&gt;\n    &lt;wsa:To xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n   https://epd-test.ith-icoserve.com:7443/PIXPDQ/services/PIXPDQV3ManagerService\n    &lt;/wsa:To&gt;\n    &lt;wsa:MessageID xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:c12e1f14-c2c9-4a94-ba27-6511e8c90b78&lt;/wsa:MessageID&gt;\n    &lt;wsa:ReplyTo xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n      &lt;wsa:Address&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/wsa:Address&gt;\n    &lt;/wsa:ReplyTo&gt;\n    &lt;wsa:Action xmlns:wsa=\"http://www.w3.org/2005/08/addressing\" env:mustUnderstand=\"1\"&gt;urn:hl7-org:v3:PRPA_IN201301UV02&lt;/wsa:Action&gt;\n  &lt;/env:Header&gt;\n</code></pre> <p>For the patient identity feed no Security header element is required, since in the Swiss EPR the access to the patient data is authorized for all applications, which are registered in the community and authenticate with a client certificate (see section Security Requirements).</p> <p>The SOAP Body element conveys the administrative information required for a PRPA_IN201305UV02 message in HL7 V3 syntax.</p> <p>Primary systems shall set the following values:</p> <ul> <li>creationTime: A timestamp in unix time format.</li> <li>sender : The OID of the sender application initiating the request.</li> <li>receiver: The OID of the receiver application which shall respond to the request.</li> </ul> PRPA_IN201301UV02 message<pre><code>    &lt;PRPA_IN201301UV02 xmlns=\"urn:hl7-org:v3\" ITSVersion=\"XML_1.0\"&gt;\n      &lt;id extension=\"1694431245655\" root=\"1.3.6.1.4.1.21367.2017.2.7.141\"/&gt;\n      &lt;creationTime value=\"20230911115902\"/&gt;\n      &lt;interactionId extension=\"PRPA_IN201301UV02\" root=\"2.16.840.1.113883.1.6\"/&gt;\n      &lt;processingCode code=\"T\"/&gt;\n      &lt;processingModeCode code=\"T\"/&gt;\n      &lt;acceptAckCode code=\"AL\"/&gt;\n      &lt;receiver typeCode=\"RCV\"&gt;\n        &lt;device classCode=\"DEV\" determinerCode=\"INSTANCE\"&gt;\n          &lt;id root=\"1.3.6.1.4.1.21367.2017.2.4.136\"/&gt;\n        &lt;/device&gt;\n      &lt;/receiver&gt;\n      &lt;sender typeCode=\"SND\"&gt;\n        &lt;device classCode=\"DEV\" determinerCode=\"INSTANCE\"&gt;\n          &lt;id root=\"1.3.6.1.4.1.21367.2017.2.2.140\"/&gt;\n        &lt;/device&gt;\n      &lt;/sender&gt;\n</code></pre> <p>The patient data are encoded in a HL7 V3 controlActProcess object as follows:</p> controlActProcess element<pre><code>      &lt;controlActProcess classCode=\"CACT\" moodCode=\"EVN\"&gt;\n        &lt;code code=\"PRPA_TE201301UV02\" codeSystem=\"2.16.840.1.113883.1.6\"/&gt;\n        &lt;subject contextConductionInd=\"false\" typeCode=\"SUBJ\"&gt;\n          &lt;registrationEvent classCode=\"REG\" moodCode=\"EVN\"&gt;\n            &lt;statusCode code=\"active\"/&gt;\n            &lt;subject1 typeCode=\"SBJ\"&gt;\n              &lt;patient classCode=\"PAT\"&gt;\n                &lt;id assigningAuthorityName=\"MyPrimarySystem\" extension=\"TestSystemId\" root=\"1.3.6.1.4.1.21367.2017.2.5.89\"/&gt;\n                &lt;id assigningAuthorityName=\"ZAS\" extension=\"761337610435201235\" root=\"2.16.756.5.30.1.127.3.10.3\"/&gt;\n                &lt;statusCode code=\"active\"/&gt;\n                &lt;patientPerson classCode=\"PSN\" determinerCode=\"INSTANCE\"&gt;\n                  &lt;name&gt;\n                    &lt;family&gt;Muster&lt;/family&gt;\n                    &lt;given&gt;Maja&lt;/given&gt;\n                  &lt;/name&gt;\n                  &lt;name&gt;\n                    &lt;family qualifier=\"BR\"&gt;Tauxe&lt;/family&gt;\n                    &lt;given&gt;Maja&lt;/given&gt;\n                  &lt;/name&gt;\n                  &lt;administrativeGenderCode code=\"F\" codeSystem=\"2.16.840.1.113883.12.1\" displayName=\"Female\"/&gt;\n                  &lt;birthTime value=\"19600618\"/&gt;\n                  &lt;addr&gt;\n                    &lt;city&gt;Wettingen&lt;/city&gt;\n                    &lt;country&gt;CH&lt;/country&gt;\n                    &lt;postalCode&gt;5430&lt;/postalCode&gt;\n                    &lt;streetAddressLine&gt;Imfeldstrasse 24b&lt;/streetAddressLine&gt;\n                  &lt;/addr&gt;\n                &lt;/patientPerson&gt;\n                &lt;providerOrganization classCode=\"ORG\" determinerCode=\"INSTANCE\"&gt;\n                  &lt;id root=\"1.3.6.1.4.1.21367.2017.2.5.89\"/&gt;\n                  &lt;id root=\"2.16.756.5.30.1.127.3.10.3\"/&gt;\n                  &lt;name&gt;MyCompany&lt;/name&gt;\n                  &lt;contactParty classCode=\"CON\"&gt;\n                    &lt;contactPerson classCode=\"PSN\" determinerCode=\"INSTANCE\"&gt;\n                      &lt;name xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"PN\"&gt;\n                        &lt;family&gt;Administrator&lt;/family&gt;\n                        &lt;given&gt;Max&lt;/given&gt;\n                      &lt;/name&gt;\n                    &lt;/contactPerson&gt;\n                  &lt;/contactParty&gt;\n                &lt;/providerOrganization&gt;\n              &lt;/patient&gt;\n            &lt;/subject1&gt;\n</code></pre> <p>The subject child element conveys the following information in its child elements.</p> <p>The patient child element conveys the patients identifiers and patient demographics: </p> <ul> <li>id: the local ID of the patient in the primary system (line 25) with the OID of the primary system in the root attribute. </li> <li>id: the EPR-SPID of the patient provided by the ZAS (line 26) with the OID of the ZAS in the root attribute.  </li> </ul> <p>The patients demographic data are conveyed in the patientPerson child element:</p> <ul> <li>name: conveying the given and the family name of the patient.</li> <li>administrativeGenderCode: conveying the coded value of patient gender, taken from the value sets defined in Annex 3.  </li> <li>birthTime: the data of birth of the matching patient data.</li> <li>addr : The address data of the patient.</li> <li>custodian: Information on the provider organization.</li> </ul> <p>The custodian element shall convey the OID of the provider organization in the id child element:</p> custodian element<pre><code>            &lt;custodian typeCode=\"CST\"&gt;\n              &lt;assignedEntity classCode=\"ASSIGNED\"&gt;\n                &lt;id root=\"1.3.6.1.4.1.21367.2017.2.5.108\"/&gt;\n                &lt;assignedOrganization classCode=\"ORG\" determinerCode=\"INSTANCE\"&gt;\n                  &lt;name xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ON\"&gt;MyCompany&lt;/name&gt;\n                &lt;/assignedOrganization&gt;\n              &lt;/assignedEntity&gt;\n            &lt;/custodian&gt;\n          &lt;/registrationEvent&gt;\n        &lt;/subject&gt;\n      &lt;/controlActProcess&gt;\n    &lt;/PRPA_IN201301UV02&gt;\n</code></pre>"},{"location":"PIXFeed/#response-message","title":"Response Message","text":"<p>The PIX V3 Feed service responds with a message indicating the success of the transaction. A raw version of a response message may be found here.</p>"},{"location":"PIXFeed/#transport-protocol","title":"Transport Protocol","text":"<p>The primary system shall send the request messages to the registry of the community using the http POST binding as defined in the W3C SOAP specification. It may look like:  </p> <pre><code>POST /PIXV3FeedService HTTP/1.1\nHost: company.example.org\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nContent-Type: application/soap+xml; charset=\"utf-8\"\nContent-Length: nnn  \n</code></pre>"},{"location":"PIXFeed/#audit-log","title":"Audit Log","text":"<p>Primary systems shall store syslog messages to the audit record repository of the community using TLS transport protocol. The audit message uses XML formatting as specified in RFC 3881 with restrictions specified in the IHE ITI TF and the Extension 1 to Annex5 in the ordinances of the Swiss electronic patient record (see Section 1.5 \"Requirements on ATNA\").  </p> <p>The following snippet shows a example audit message to be written by the primary system:</p> iti-44-log.xml<pre><code>&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;AuditMessage&gt;\n &lt;EventIdentification EventDateTime=\"2020-09-21T15:25:53.616+02:00\" EventOutcomeIndicator=\"0\" EventActionCode=\"C\"&gt;\n  &lt;EventID csd-code=\"110110\" codeSystemName=\"DCM\" originalText=\"Patient Record\"/&gt;\n  &lt;EventTypeCode csd-code=\"ITI-44\" codeSystemName=\"IHE Transactions\" originalText=\"Patient Identity Feed\"/&gt;\n  &lt;EventOutcomeDescription/&gt;\n &lt;/EventIdentification&gt;\n &lt;ActiveParticipant AlternativeUserID=\"primary.system.alt.ID\" UserID=\"primary.system.ID\" UserIsRequestor=\"true\" NetworkAccessPointID=\"https://my_primary_system.com/\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"110153\" codeSystemName=\"DCM\" originalText=\"Source\"/&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant AlternativeUserID=\"plattform.mpi.alt.ID\" UserID=\"plattform.mpi.ID\" UserIsRequestor=\"false\" NetworkAccessPointID=\"https://platform.com/mock/patientRegister\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"110152\" codeSystemName=\"DCM\" originalText=\"Destination\"/&gt;\n &lt;/ActiveParticipant&gt;\n &lt;AuditSourceIdentification AuditSourceID=\"primary.system.alt.ID\" AuditEnterpriseSiteID=\"2.16.756.5.30.1.174.1.5.1\"&gt;\n  &lt;AuditSourceTypeCode csd-code=\"4\" codeSystemName=\"DCM\" originalText=\"Client Process\"/&gt;\n &lt;/AuditSourceIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"11234^^^&amp;amp;2.16.756.5.30.1.174.1.9999.1&amp;amp;ISO\" ParticipantObjectTypeCode=\"1\" ParticipantObjectTypeCodeRole=\"1\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"2\" codeSystemName=\"RFC-3881\" originalText=\"Patient Number\"/&gt;\n  &lt;ParticipantObjectDetail type=\"II\" value=\"ZGVmYXVsdA==\"/&gt;\n &lt;/ParticipantObjectIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"urn:uuid:4d42d62d-30b7-4ad4-a9e2-c3f0dd1d50f9\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"24\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"ITI-44\" codeSystemName=\"IHE Transactions\" originalText=\"Patient Identity Feed\"/&gt;\n  &lt;ParticipantObjectQuery&gt;\n   &lt;!-- omitted for brevity --&gt;\n  &lt;/ParticipantObjectQuery&gt;\n  &lt;ParticipantObjectDetail type=\"II\" value=\"ZGVmYXVsdA==\"/&gt;\n &lt;/ParticipantObjectIdentification&gt;\n&lt;/AuditMessage&gt;\n</code></pre> <p>The message is made of the following blocks:</p> <ul> <li>EventIdentification: Event related information including the timestamp (line 3 .. 7).</li> <li>ActiveParticipant: Information related to the primary system performing the query (line 8 .. 10).</li> <li>ActiveParticipant: Information on the responding service endpoint (line 11 .. 13).</li> <li>AuditSourceIdentification: Information related to the primary system performing the query (line 14 .. 16)</li> <li>ParticipantObjectIdentification: Information on the patients EPR accessed (line 17 .. 20)</li> <li>ParticipantObjectIdentification: Request message related information including a BASE-64 encoded copy of the query (line 21 .. 27).</li> </ul>"},{"location":"PIXFeed/#security-requirements","title":"Security Requirements","text":"<p>To ensure privacy the transaction must be secured using https with mutual authentication, with X.509 certificates (extended validation required) and client and server side certificate validation.</p> <p>Note</p> <ul> <li>Some test environments dropped the mutual authentication or TLS for testing purposes. Please contact your test system provider on the details.</li> </ul>"},{"location":"PIXFeed/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment, test systems of the EPR communities or the **EPR Playground.</p>"},{"location":"PIXQuery/","title":"PIX Query","text":"<p>Transaction to get the master patient ID of a patient in a community using the local ID.</p>"},{"location":"PIXQuery/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction to retrieve the master patient ID (XAD-SPID) for patients the primary systems wants to retrieve or provide documents for. In the Swiss EPR the IHE PIX V3 profile and transactions shall be used to retrieve the master patient ID.  </p> <p>To retrieve the master patient ID for the patient to access the patients EPR, the the primary system shall perform a Patient V3 Query [ITI-45]. Within the query request the primary system shall provide the local ID of the patient in the primary system, as well as the data source parameter of the assigning authority of the community and the the assigning authority EPR-SPID. The local ID must match the local ID the primary system registered the patient with (see PIX Feed).  </p> <p>If the patient is registered in the community, the community sends a response with the master patient ID (XAD-PID) and the EPR-SPID.</p>"},{"location":"PIXQuery/#transaction","title":"Transaction","text":""},{"location":"PIXQuery/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in the HL7 V3 standard with restrictions defined in the IHE PIX V3 Query profile and the ordinances to the Swiss EPR.</p>"},{"location":"PIXQuery/#request-message","title":"Request Message","text":"<p>Due to the genericity of the underlying HL7 V3 standard, the request message is quite lengthy. A raw version of a request message may be found here.</p> <p>For a step by step interpretation of the request message, see section below.</p>"},{"location":"PIXQuery/#message-interpretation","title":"Message Interpretation","text":"<p>The request message is not complex in nature, but quite lengthy due to the genericity of the HL7 V3 standard.</p> <p>The SOAP Header element shall convey the following information:</p> <ul> <li>To element: The URL of the provide and register document set service.</li> <li>MessageID element: a UUID of the message.</li> <li>Action element: The SOAP action identifier of the request as defined in the IHE ITI Technical Framework.</li> </ul> <p>Optional elements may be included according to the specification in the W3C SOAP specification.</p> SOAP header<pre><code>&lt;env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n &lt;env:Header&gt;\n  &lt;wsa:To xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n   https://epd-test.ith-icoserve.com:7443/PIXPDQ/services/PIXPDQV3ManagerService\n  &lt;/wsa:To&gt;\n  &lt;wsa:MessageID xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:c12e1f14-c2c9-4a94-ba27-6411e8c90b75&lt;/wsa:MessageID&gt;\n  &lt;wsa:ReplyTo xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n   &lt;wsa:Address&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/wsa:Address&gt;\n  &lt;/wsa:ReplyTo&gt;\n  &lt;wsa:Action xmlns:wsa=\"http://www.w3.org/2005/08/addressing\" env:mustUnderstand=\"1\"&gt;urn:hl7-org:v3:PRPA_IN201309UV02&lt;/wsa:Action&gt;\n &lt;/env:Header&gt;\n</code></pre> <p>For the PIX query no Security header element is required, since in the Swiss EPR the access to the patient data is authorized for all applications, which are registered in the community and authenticate with a client certificate (see section Security Requirements).</p> <p>The SOAP Body element conveys the administrative information required for a HL7 V3 PRPA_IN201310UV02 message in HL7 V3 syntax.</p> <p>Primary systems shall set the following values:</p> <ul> <li>creationTime: A timestamp in unix time format.</li> <li>sender : The OID of the sender application initiating the request.</li> <li>receiver: The OID of the receiver application which shall respond to the request.</li> </ul> PRPA_IN201309UV02 message<pre><code>  &lt;PRPA_IN201309UV02 xmlns=\"urn:hl7-org:v3\" ITSVersion=\"XML_1.0\"&gt;\n   &lt;id extension=\"1694523036420\" root=\"1.3.6.1.4.1.21367.2017.2.7.141\"/&gt;\n   &lt;creationTime value=\"20230912131951\"/&gt;\n   &lt;interactionId extension=\"PRPA_IN201309UV02\" root=\"2.16.840.1.113883.1.6\"/&gt;\n   &lt;processingCode code=\"T\"/&gt;\n   &lt;processingModeCode code=\"T\"/&gt;\n   &lt;acceptAckCode code=\"AL\"/&gt;\n   &lt;receiver typeCode=\"RCV\"&gt;\n    &lt;device classCode=\"DEV\" determinerCode=\"INSTANCE\"&gt;\n     &lt;id root=\"1.3.6.1.4.1.21367.2017.2.4.136\"/&gt;\n    &lt;/device&gt;\n   &lt;/receiver&gt;\n   &lt;sender typeCode=\"SND\"&gt;\n    &lt;device classCode=\"DEV\" determinerCode=\"INSTANCE\"&gt;\n     &lt;id root=\"1.3.6.1.4.1.21367.2017.2.2.140\"/&gt;\n    &lt;/device&gt;\n   &lt;/sender&gt;\n</code></pre> <p>The query parameter are encoded in a HL7 V3 controlActProcess element of the message. Primary systems shall set the following query attributes:</p> <ul> <li>authorOrPerformer: The OID of the primary system in the id element.</li> </ul> controlActProcess element<pre><code>   &lt;controlActProcess classCode=\"CACT\" moodCode=\"EVN\"&gt;\n    &lt;code code=\"PRPA_TE201309UV02\" displayName=\"2.16.840.1.113883.1.6\"/&gt;\n    &lt;authorOrPerformer typeCode=\"AUT\"&gt;\n     &lt;assignedPerson classCode=\"ASSIGNED\"&gt;\n      &lt;id root=\"1.3.6.1.4.1.21367.2017.2.5.108\"/&gt;\n     &lt;/assignedPerson&gt;\n    &lt;/authorOrPerformer&gt;\n</code></pre> <p>The query parameter are conveyed in the queryByParameter child element:</p> <ul> <li>queryId: A unique ID of the query.</li> <li>dataSource: The OID of the assigning authority of the community (line 43). </li> <li>dataSource: The OID of the assigning authority of the EPR-SPID (line 46).</li> <li>patientIdentifier: The ID of the patient data in the primary system, with the OID of the primary system in the root element and the local ID in the extension element.</li> </ul> controlActProcess element<pre><code>    &lt;queryByParameter&gt;\n     &lt;queryId extension=\"1694523036421\" root=\"1.3.6.1.4.1.21367.2017.2.7.141\"/&gt;\n     &lt;statusCode code=\"new\"/&gt;\n     &lt;responsePriorityCode code=\"I\"/&gt;\n     &lt;parameterList&gt;\n      &lt;dataSource&gt;\n       &lt;value root=\"1.3.6.1.4.1.21367.2017.2.5.93\"/&gt;\n       &lt;semanticsText&gt;DataSource.id&lt;/semanticsText&gt;\n      &lt;/dataSource&gt;\n      &lt;dataSource&gt;\n       &lt;value root=\"2.16.756.5.30.1.127.3.10.3\"/&gt;\n       &lt;semanticsText&gt;DataSource.id&lt;/semanticsText&gt;\n      &lt;/dataSource&gt;\n      &lt;patientIdentifier&gt;\n       &lt;value extension=\"900010\" root=\"1.3.6.1.4.1.21367.2017.2.5.103\"/&gt;\n       &lt;semanticsText&gt;Patient.id&lt;/semanticsText&gt;\n      &lt;/patientIdentifier&gt;\n     &lt;/parameterList&gt;\n    &lt;/queryByParameter&gt;\n</code></pre>"},{"location":"PIXQuery/#response-message","title":"Response Message","text":"<p>The PIX V3 Feed service responds with the master patient ID (XAD-PID) and the EPR-SPID, the patient is registered with in the community.</p> <p>The request message is not very complex, but quite lengthy due to the genericity of the HL7 V3 standard. A raw version of a response message may be found here.</p>"},{"location":"PIXQuery/#message-interpretation_1","title":"Message Interpretation","text":"<p>The SOAP Header element shall conveys the following information:</p> <ul> <li>Action element: The SOAP action identifier of the request as defined in the IHE ITI Technical Framework.</li> <li>RelatesTo element: A copy of the unique ID of the query request.</li> </ul> SOAP header<pre><code>&lt;soapenv:Envelope xmlns:soapenv=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n  &lt;soapenv:Header xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n    &lt;wsa:Action xmlns:mustUnderstand=\"http://www.w3.org/2003/05/soap-envelope\" mustUnderstand:mustUnderstand=\"1\"&gt;urn:hl7-org:v3:PRPA_IN201310UV02&lt;/wsa:Action&gt;\n    &lt;wsa:RelatesTo&gt;urn:uuid:c12e1f14-c2c9-4a94-ba27-6411e8c90b75&lt;/wsa:RelatesTo&gt;\n  &lt;/soapenv:Header&gt;\n</code></pre> <p>The SOAP Body element conveys the administrative information required for a PRPA_IN201310UV02 message in HL7 V3 syntax and the query result encoded in the controlActProcess element.</p> <p>The controlActProcess element conveys the following information for the primary system in the subject child element:</p> <p>The patient child element conveys the master patient ID (XAD-SPID) and the EPR-SPID as follows:</p> <ul> <li>id : The master patient ID (XAD-SPID), with the community OID as the assigning authority in the root and the ID in the extension attribute (line 49).</li> <li>id : The EPR-SPID, with the OID of the ZAS as assigning authority in the root and the ID in the extension attribute (line 50).</li> </ul> registrationEvent element<pre><code>          &lt;ns1:registrationEvent classCode=\"REG\" moodCode=\"EVN\"&gt;\n            &lt;ns1:id xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" nullFlavor=\"NA\" xsi:type=\"ns1:II\"/&gt;\n            &lt;ns1:statusCode code=\"active\"/&gt;\n            &lt;ns1:subject1 typeCode=\"SBJ\"&gt;\n              &lt;ns1:patient classCode=\"PAT\"&gt;\n                &lt;ns1:id xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" assigningAuthorityName=\"XDS Affinity Domain\" extension=\"7f2e05e6-673e-44b6-8b76-e17ac58ea80f\" root=\"1.3.6.1.4.1.21367.2017.2.5.93\" xsi:type=\"ns1:II\"/&gt;\n                &lt;ns1:id xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" assigningAuthorityName=\"SPID\" extension=\"761337610435209810\" root=\"2.16.756.5.30.1.127.3.10.3\" xsi:type=\"ns1:II\"/&gt;\n                &lt;ns1:statusCode code=\"active\"/&gt;\n                &lt;ns1:patientPerson classCode=\"PSN\" determinerCode=\"INSTANCE\"&gt;\n                  &lt;ns1:name xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" nullFlavor=\"NA\" xsi:type=\"ns1:PN\"/&gt;\n                &lt;/ns1:patientPerson&gt;\n              &lt;/ns1:patient&gt;\n            &lt;/ns1:subject1&gt;\n</code></pre> <p>The custodian child element conveys information on the responding system with the the OID of the provider organization in the id child element as follows:</p> custodian element<pre><code>            &lt;ns1:custodian typeCode=\"CST\"&gt;\n              &lt;ns1:assignedEntity classCode=\"ASSIGNED\"&gt;\n                &lt;ns1:id xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" extension=\"MyOrgID\" root=\"1.3.6.1.4.1.21367.2010.1.2.600\" xsi:type=\"ns1:II\"/&gt;\n                &lt;ns1:assignedOrganization classCode=\"ORG\" determinerCode=\"INSTANCE\"&gt;\n                  &lt;ns1:name xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"ns1:EN\"&gt;\n                    &lt;ns1:given&gt;MyOrganisation&lt;/ns1:given&gt;\n                  &lt;/ns1:name&gt;\n                &lt;/ns1:assignedOrganization&gt;\n              &lt;/ns1:assignedEntity&gt;\n            &lt;/ns1:custodian&gt;\n</code></pre>"},{"location":"PIXQuery/#transport-protocol","title":"Transport Protocol","text":"<p>The primary system shall send the request messages to the registry of the community using the http POST binding as defined in the W3C SOAP specification. It may look like:</p> <pre><code>POST /PIXV3QueryService HTTP/1.1\nHost: company.example.org\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nContent-Type: application/soap+xml; charset=\"utf-8\"\nContent-Length: nnnn    \n</code></pre>"},{"location":"PIXQuery/#audit-log","title":"Audit Log","text":"<p>Primary systems shall store syslog messages to the audit record repository of the community using TLS transport protocol. The audit message uses XML formatting as specified in RFC 3881 with restrictions specified in the IHE ITI TF and the Extension 1 to Annex5 in the ordinances of the Swiss electronic patient record (see Section 1.5 \"Requirements on ATNA\").  </p> <p>The following snippet shows a example audit message to be written by the primary system:</p> iti-45-log.xml<pre><code>&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;AuditMessage&gt;\n &lt;EventIdentification EventActionCode=\"E\" EventDateTime=\"2020-09-30T19:32:55.368Z\" EventOutcomeIndicator=\"0\"&gt;\n  &lt;EventID csd-code=\"110112\" codeSystemName=\"DCM\" originalText=\"Query\"&gt;&lt;/EventID&gt;\n  &lt;EventTypeCode csd-code=\"ITI-45\" codeSystemName=\"IHE Transactions\" originalText=\"PIX Query\"&gt;&lt;/EventTypeCode&gt;\n &lt;/EventIdentification&gt;\n &lt;ActiveParticipant UserID=\"https://my_primary_system.com/PIXConsumer\" AlternativeUserID=\"201818\" UserIsRequestor=\"true\" NetworkAccessPointID=\"0045e6d09dd0\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"110153\" codeSystemName=\"DCM\" originalText=\"Source Role ID\"&gt;&lt;/RoleIDCode&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant UserID=\"_SYSTEM\" UserIsRequestor=\"true\" NetworkAccessPointID=\"0045e6d09dd0\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"%All\" codeSystemName=\"HealthShare\" originalText=\"%All\"&gt;&lt;/RoleIDCode&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant UserID=\"https://ehealthsuisse.ihe-europe.net/PIXManagerService\" UserIsRequestor=\"false\" NetworkAccessPointID=\"ehealthsuisse.ihe-europe.net\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"110152\" codeSystemName=\"DCM\" originalText=\"Destination Role ID\"&gt;&lt;/RoleIDCode&gt;\n &lt;/ActiveParticipant&gt;\n &lt;AuditSourceIdentification AuditEnterpriseSiteID=\"2.16.756.5.30.1.109.6.1.3.1.1\" AuditSourceID=\"my.primary.system.ID\"&gt;\n  &lt;AuditSourceTypeCode csd-code=\"4\"&gt;&lt;/AuditSourceTypeCode&gt;\n &lt;/AuditSourceIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"CHFACILITY22332^^^&amp;amp;1.3.6.1.4.1.12559.11.25.1.19&amp;amp;ISO\" ParticipantObjectTypeCode=\"1\" ParticipantObjectTypeCodeRole=\"1\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"2\" codeSystemName=\"RFC-3881\" originalText=\"Patient Number\"&gt;&lt;/ParticipantObjectIDTypeCode&gt;\n  &lt;ParticipantObjectDetail type=\"II\" value=\"QkMzMjJDQjAtMDM1My0xMUVCLTk5OTQtMDI0MkFDMTQwMDAy\"&gt;&lt;/ParticipantObjectDetail&gt;\n &lt;/ParticipantObjectIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"1^^^&amp;amp;BC322C7E-0353-11EB-9994-0242AC140002&amp;amp;ISO\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"24\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"ITI-45\" codeSystemName=\"IHE Transactions\" originalText=\"PIX Query\"&gt;&lt;/ParticipantObjectIDTypeCode&gt;\n  &lt;ParticipantObjectQuery&gt; &lt;!-- omitted for brevity --&gt; &lt;/ParticipantObjectQuery&gt;\n  &lt;ParticipantObjectDetail type=\"MSH-10\" value=\"Xl5eJkJDMzIyQ0IwLTAzNTMtMTFFQi05OTk0LTAyNDJBQzE0MDAwMiZJU08=\"&gt;&lt;/ParticipantObjectDetail&gt;\n &lt;/ParticipantObjectIdentification&gt;\n&lt;/AuditMessage&gt;\n</code></pre> <p>The message is made of the following blocks:</p> <ul> <li>EventIdentification: Event related information including the timestamp (line 3 .. 6).</li> <li>ActiveParticipant: Information related to the primary system performing the query (line 7 .. 9).</li> <li>ActiveParticipant: Information on the user initiating the transaction (line 10 .. 12).</li> <li>ActiveParticipant: Information on the responding service endpoint (line 13 .. 15).</li> <li>AuditSourceIdentification: Information related to the primary system performing the query (line 16 .. 18)</li> <li>ParticipantObjectIdentification: Information on the patients EPR accessed (line 19 .. 22)</li> <li>ParticipantObjectIdentification: Request message related information including a BASE-64 encoded copy of the query (line 23 .. 27).</li> </ul>"},{"location":"PIXQuery/#security-requirements","title":"Security Requirements","text":"<p>To ensure privacy the transaction must be secured using https with mutual authentication, with X.509 certificates (extended validation required) and client and server side certificate validation.</p> <p>Note</p> <ul> <li>Some test environments dropped the mutual authentication or TLS for testing purposes. Please contact your test system provider on the details.</li> </ul>"},{"location":"PIXQuery/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment, test systems of the EPR communities or the EPR Playground.</p>"},{"location":"ProvideAndRegister/","title":"Provide and Register Document Set","text":"<p>Transaction to store one or more documents to a community. Primary systems shall use this transaction to export documents and the to a community repository to add it to a patients EPR.  </p>"},{"location":"ProvideAndRegister/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction to provide documents and the related document metadata to a patient EPR. In the Swiss EPR the IHE XDS.b profile and transactions shall be used.</p> <p>To store the document metadata of the document, the primary system shall perform a Provide And Register Document Set [ITI-41] transaction. Within the request, the primary systems shall provide the master patient ID as retrieved from the PIX Query, the document metadata as defined in the ordinances of the Swiss EPR and the binary data of the document.  </p> <p>The community responds with a code indicating the successful registration of the document.</p>"},{"location":"ProvideAndRegister/#transaction","title":"Transaction","text":""},{"location":"ProvideAndRegister/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in the ebXML standard with restrictions defined in the IHE profile and the ordinances to the Swiss EPR.</p>"},{"location":"ProvideAndRegister/#request-message","title":"Request Message","text":"<p>Since the ebXML standard is very generic, the request message is quite lengthy and needs some background information to interpret.</p> <p>The structure of the result set is as follows (see example below):</p> <ul> <li>The metadata of the individual documents are bundled in a ExtrinsicObject element.</li> <li>The metadata attributes are encoded as Slot, as Classification or as ExternalIdentifier elements.</li> <li>Metadata attributes encoded as Slots can be identified and interpreted by the slot's name attribute.</li> <li>Metadata attributes encoded as Classification can be identified and interpreted by the classification's classificationScheme attribute.</li> <li>The unique ID of the document is encoded as ExternalIdentifier, which has an identificationScheme attribute with a fixed value.</li> </ul> <p>The table of the identifier used to indicate the metadata attributes is defined by the metadata model used by IHE XDS.b in IHE ITI Technical Framework Vol. 3, Section 4.2.5.1 and IHE ITI Technical Framework Vol. 3, Section 4.2.5.2 .</p> <p>The corresponding interpretation of the metadata attributes in the Swiss EPR and the supported value sets may be found in Annex 3 of the ordinances of the Swiss electronic patient dossier.</p> <p>A request message is quite lengthy. A listing with abrevations used in the step by step interpretation below is found here. The raw version of the request message may be found here.</p>"},{"location":"ProvideAndRegister/#message-interpretation","title":"Message Interpretation","text":"<p>The request message is not very complex, but lengthy due to the genericity of the ebXML standard. Therefore the following step by step interpretation may be of help to interpret the response.</p> <p>The SOAP Header element conveys the following information:</p> <ul> <li>To element: The URL of the provide and register document set service.</li> <li>MessageID element: a UUID of the message.</li> <li>Action element: The SOAP action identifier of the request as defined in the IHE ITI Technical Framework.</li> <li>Security element: The Web Service Security header as defined in the WS Security specification. This element conveys the XUA Assertion used for authorization (see Provide X-User Assertion).  </li> </ul> SOAP header<pre><code>    &lt;soap:Header&gt;\n      &lt;Action soap:mustUnderstand=\"true\"\n        xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:ihe:iti:2007:ProvideAndRegisterDocumentSet-b&lt;/Action&gt;\n      &lt;MessageID xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:073be420-d838-47c9-b35f-c59af5b147a2&lt;/MessageID&gt;\n      &lt;To xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;http://ehealthsuisse.ihe-europe.net:8280/xdstools7/sim/epr-testing__for_init_gw_testing/rep/prb&lt;/To&gt;\n      &lt;ReplyTo xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;\n        &lt;Address&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/Address&gt;\n      &lt;/ReplyTo&gt;\n          &lt;wsse:Security&gt;\n</code></pre> <p>The SOAP Body element conveys the following objects in ebXML syntax:</p> <ul> <li>RegistryPackage defining the submission set and its metadata.</li> <li>ExtrinsicObject defining the document metadata (matches the document metadata interpretation in Registry Stored Query).</li> <li>Association linking the document metadata to the submission set.  </li> </ul> <p>We will explain the RegistryPackage object defining the submission set first. For the other elements, see below.  </p>"},{"location":"ProvideAndRegister/#submission-set","title":"Submission Set","text":"<p>The structure of the RegistryPackage object defining the submission set is as follows (see example below):</p> <ul> <li>The metadata attributes are encoded as Slot, as Classification or as ExternalIdentifier elements.</li> <li>Metadata attributes encoded as Slots can be identified and interpreted by the slot's name attribute.</li> <li>Metadata attributes encoded as Classification can be identified and interpreted by the classification's classificationScheme attribute.</li> <li>The unique ID of the document is encoded as ExternalIdentifier, which has an identificationScheme attribute with a fixed value.</li> </ul> <p>The RegistryPackage object defining the submission set has one Slot child elements with name submissionTime which conveys the request timestamp, and a Name element to convey the display name of the submission set (see lines 17 to     25 below).</p> RegistryPackage element<pre><code>            &lt;RegistryPackage id=\"urn:uuid:a459a58b-1c47-4b43-b7db-82eb1b340168\"&gt;\n              &lt;Slot name=\"submissionTime\"&gt;\n                &lt;ValueList&gt;\n                  &lt;Value&gt;20231219102116&lt;/Value&gt;\n                &lt;/ValueList&gt;\n              &lt;/Slot&gt;\n</code></pre> <p>The RegistryPackage object defining the submission set has three Classification child elements conveying the submission set metadata:</p> <ul> <li>Content Type Code: The submission set content type code attribute, indicated by the value of the classificationScheme equal to urn:uuid:aa543740-bdda-424e-8c96-df4873be8500. The value conveyed with the nodeRepresentation attribute and the codingScheme value must match one of the supported values in the Swiss EPR as defined in Annex 3.</li> <li>submission author: The submission set author element, indicated by the value of the classificationScheme equal to urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d. The author element is optional in the EPR. If present, it shall convey the information on the person, which initiated the request.</li> <li>submission set identifier: An element with classification scheme urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd required to identify the RegistryPackage object as a XDS.b submission set.</li> </ul> RegistryPackage element<pre><code>              &lt;Classification classificationScheme=\"urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d\" classifiedObject=\"urn:uuid:a459a58b-1c47-4b43-b7db-82eb1b340168\" nodeRepresentation=\"\" id=\"urn:uuid:6c2e8937-3650-4f7b-a98d-b1739c0798e1\"&gt;\n                &lt;Slot name=\"authorPerson\"&gt;\n                  &lt;ValueList&gt;\n                    &lt;Value&gt;^Max^Mustermann^^^Dr.Med&lt;/Value&gt;\n                  &lt;/ValueList&gt;\n                &lt;/Slot&gt;\n                &lt;Slot name=\"authorRole\"&gt;\n                  &lt;ValueList&gt;\n                    &lt;Value&gt;HCP^^^&amp;amp;2.16.756.5.30.1.127.3.10.6&amp;amp;ISO&lt;/Value&gt;\n                  &lt;/ValueList&gt;\n                &lt;/Slot&gt;\n                &lt;Slot name=\"authorSpecialty\"&gt;\n                  &lt;ValueList&gt;\n                    &lt;Value&gt;1050^^^&amp;amp;2.16.756.5.30.1.127.3.5&amp;amp;ISO&lt;/Value&gt;\n                  &lt;/ValueList&gt;\n                &lt;/Slot&gt;\n              &lt;/Classification&gt;\n              &lt;Classification classificationScheme=\"urn:uuid:aa543740-bdda-424e-8c96-df4873be8500\" classifiedObject=\"urn:uuid:a459a58b-1c47-4b43-b7db-82eb1b340168\" nodeRepresentation=\"71388002\" id=\"urn:uuid:3e3b7544-d7d8-498b-9bc1-6f16cce2ad38\"&gt;\n                &lt;Slot name=\"codingScheme\"&gt;\n                  &lt;ValueList&gt;\n                    &lt;Value&gt;2.16.840.1.113883.6.96&lt;/Value&gt;\n                  &lt;/ValueList&gt;\n                &lt;/Slot&gt;\n                &lt;Name&gt;\n                  &lt;LocalizedString xml:lang=\"en-US\" charset=\"UTF-8\" value=\"Procedure (procedure)\"/&gt;\n                &lt;/Name&gt;\n              &lt;/Classification&gt;\n</code></pre> <p>The RegistryPackage object defining the submission set has three ExternalIdentifier child elements:</p> <ul> <li>XDSSubmissionSet.sourceId: Conveys the OID of the primary system performing the request.</li> <li>XDSSubmissionSet.uniqueId: Conveys a UUID of the submission set.</li> <li>XDSSubmissionSet.patientId: The master patient ID (XAD-PID) of the patient in CX format (see PIX Feed).</li> </ul> RegistryPackage element<pre><code>              &lt;ExternalIdentifier registryObject=\"urn:uuid:a459a58b-1c47-4b43-b7db-82eb1b340168\" identificationScheme=\"urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446\" value=\"CHPAM3946^^^&amp;amp;1.3.6.1.4.1.12559.11.20.1&amp;amp;ISO\" id=\"urn:uuid:b155cad3-b415-47a7-854f-0d8a0a29cfd2\"&gt;\n                &lt;Name&gt;\n                  &lt;LocalizedString value=\"XDSSubmissionSet.patientId\"/&gt;\n                &lt;/Name&gt;\n              &lt;/ExternalIdentifier&gt;\n              &lt;ExternalIdentifier registryObject=\"urn:uuid:a459a58b-1c47-4b43-b7db-82eb1b340168\" identificationScheme=\"urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8\" value=\"2.25.194301908197721326796925171598754063498\" id=\"urn:uuid:b19fdbbd-f545-43e6-82c1-2b7b60560635\"&gt;\n                &lt;Name&gt;\n                  &lt;LocalizedString value=\"XDSSubmissionSet.uniqueId\"/&gt;\n                &lt;/Name&gt;\n              &lt;/ExternalIdentifier&gt;\n              &lt;ExternalIdentifier registryObject=\"urn:uuid:a459a58b-1c47-4b43-b7db-82eb1b340168\" identificationScheme=\"urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832\" value=\"2.16.756.5.30.1.139.1.1.11\" id=\"urn:uuid:c85aeade-175b-47ac-803e-efe2d1556895\"&gt;\n                &lt;Name&gt;\n                  &lt;LocalizedString value=\"XDSSubmissionSet.sourceId\"/&gt;\n                &lt;/Name&gt;\n              &lt;/ExternalIdentifier&gt;\n</code></pre>"},{"location":"ProvideAndRegister/#document-metadata","title":"Document Metadata","text":"<p>The request contains 1..N ExtrinsicObject representing the document metadata for each document. The interpretation of the document metadata matches the document metadata interpretation, which is explained in detail in step by step example in the Registry Stored Query page and will not be reproduced here. Please see Registry Stored Query for the interpretation of the document metadata.</p>"},{"location":"ProvideAndRegister/#association","title":"Association","text":"<p>The request contains one Association object linking the document and document metadata to a submission set defined in the RegistryPackage (see Submission Set).</p> <p>The Association object thus conveys two parameter to link the objects:</p> <ul> <li>sourceObject: The attribute value must match the id attribute of the submission set RegistryPackage.</li> <li>targetObject: The attribute value must match the id attribute value of the document metadata ExtrinsicObject.  </li> </ul> <p>In addition the Association object conveys a status indicator, which must take the value Original (see snippet below).</p> Association element<pre><code>            &lt;Association associationType=\"urn:oasis:names:tc:ebxml-regrep:AssociationType:HasMember\" sourceObject=\"urn:uuid:a459a58b-1c47-4b43-b7db-82eb1b340168\" targetObject=\"urn:uuid:af516d8d-c449-4a8b-bbb4-9e36489d474d\" id=\"urn:uuid:9aabf9f9-1a16-47d8-b280-281edd2fc3fc\"&gt;\n              &lt;Slot name=\"SubmissionSetStatus\"&gt;\n                &lt;ValueList&gt;\n                  &lt;Value&gt;Original&lt;/Value&gt;\n                &lt;/ValueList&gt;\n              &lt;/Slot&gt;\n            &lt;/Association&gt;\n</code></pre>"},{"location":"ProvideAndRegister/#response-message","title":"Response Message","text":"<p>The provide and register service responds with a message indicating the success of the transaction. The outcome indicator is encoded in the Body element of the SOAP envelope as follows:</p> <pre><code>&lt;ns2:RegistryResponse xmlns=\"namespace omitted\" status=\"urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success\"/&gt;\n</code></pre> <p>The raw version of a response message may be found here.</p>"},{"location":"ProvideAndRegister/#transport-protocol","title":"Transport Protocol","text":"<p>The system shall send the request messages to the repository service of the community using the MIME Multipart/Related binding as specified in the SOAP MTOM specification of the W3C.</p> <p>The request in MTOM format may look as follows:</p> <pre><code>POST /XDSDocumentRepositoryService HTTP/1.1\nHost: 10.2.101.10:11076\nContent-Type: multipart/related; boundary=\"MIMEBoundary_05b39a33e8effeb90c1ccb1c58c4b93b5af2935a13853149\"; type=\"application/xop+xml\"; start=\"&lt;0.15b39a33e8effeb90c1ccb1c58c4b93b5af2935a13853149@apache.org&gt;\"; start-info=\"application/soap+xml\"; action=\"urn:ihe:iti:2007:ProvideAndRegisterDocumentSet-b\"\nConnection: Keep-Alive\nContent-Length: 181931\n\n--MIMEBoundary_05b39a33e8effeb90c1ccb1c58c4b93b5af2935a13853149\nContent-Type: application/xop+xml; charset=utf-8; type=\"application/soap+xml\"\nContent-Transfer-Encoding: binary\nContent-ID: &lt;0.15b39a33e8effeb90c1ccb1c58c4b93b5af2935a13853149@apache.org&gt;\n\n&lt;!-- message omittedd --&gt;\n\n--MIMEBoundary_05b39a33e8effeb90c1ccb1c58c4b93b5af2935a13853149\nContent-Type: application/octet-stream\nContent-Transfer-Encoding: binary\nContent-ID: &lt;1.c5b39a33e8effeb94a97121c58c4b93b53d2935a13853149@apache.org&gt;\n\n&lt;!-- binary document data omitted --&gt;\n\n--MIMEBoundary_05b39a33e8effeb90c1ccb1c58c4b93b5af2935a13853149--\n</code></pre> <p>The provide and register service sends the response message in the MIME Multipart/Related binding as specified in the SOAP MTOM specification of the W3C.</p> <p>The response in MTOM format may look as follows:</p> <pre><code>DefaultHttpResponse(chunked: false)\nHTTP/1.1 200 OK\nConnection: keep-alive\nContent-Type: multipart/related; type=\"application/xop+xml\"; boundary=\"uuid:2a1acced-0234-4a54-8dd3-b9f9b753169c\"; start=\"&lt;root.message@cxf.apache.org&gt;\"; start-info=\"application/soap+xml\"\nDate: Thu, 24 Sep 2020 15:43:11 GMT\nContent-Length: 1136\n\n--uuid:2a1acced-0234-4a54-8dd3-b9f9b753169c\nContent-Type: application/xop+xml; charset=UTF-8; type=\"application/soap+xml\"\nContent-Transfer-Encoding: binary\nContent-ID: &lt;root.message@cxf.apache.org&gt;\n\n&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n &lt;soap:Header&gt;\n  &lt;Action xmlns=\"http://www.w3.org/2005/08/addressing\" soap:mustUnderstand=\"true\"&gt;urn:ihe:iti:2007:ProvideAndRegisterDocumentSet-bResponse&lt;/Action&gt;\n  &lt;MessageID xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:3dbfa2b7-3cd6-46b3-b642-9569bb3b43fb&lt;/MessageID&gt;\n  &lt;To xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/To&gt;\n  &lt;RelatesTo xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;d22ebb69-8368-4eb6-929b-b382f1b37c72&lt;/RelatesTo&gt;\n &lt;/soap:Header&gt;\n &lt;soap:Body&gt;\n  &lt;ns2:RegistryResponse\n  xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"\n  xmlns:ns2=\"urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0\"\n  xmlns:ns3=\"urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0\"\n  xmlns:ns4=\"urn:ihe:iti:xds-b:2007\"\n  status=\"urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success\"/&gt;\n &lt;/soap:Body&gt;\n&lt;/soap:Envelope&gt;\n--uuid:2a1acced-0234-4a54-8dd3-b9f9b753169c--\n</code></pre>"},{"location":"ProvideAndRegister/#audit-log","title":"Audit Log","text":"<p>Primary systems shall store syslog messages to the audit record repository of the community using TLS transport protocol. The audit message uses XML formatting as specified in RFC 3881 with restrictions specified in the IHE ITI TF and the Extension 1 to Annex5 in the ordinances of the Swiss electronic patient record (see Section 1.5 \"Requirements on ATNA\").  </p> <p>The following snippet shows an example audit message to be written by the primary system:</p> iti-41-log.xml<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;AuditMessage&gt;\n &lt;EventIdentification EventActionCode=\"R\" EventDateTime=\"2020-11-17T18:39:39+01:00\" EventOutcomeIndicator=\"0\"&gt;\n  &lt;EventID csd-code=\"110106\" originalText=\"Export\" codeSystemName=\"DCM\"/&gt;\n  &lt;EventTypeCode csd-code=\"ITI-41\" originalText=\"Provide and Register Document Set-b\" codeSystemName=\"IHE Transactions\"/&gt;\n &lt;/EventIdentification&gt;\n &lt;ActiveParticipant UserID=\"pma@gnt.com\" UserName=\"JD&amp;lt;pma@gnt.com&amp;gt;\"/&gt;\n &lt;ActiveParticipant UserID=\"2000000090108\" UserName=\"Dr. med. John Doe\" UserIsRequestor=\"true\"&gt;\n  &lt;RoleIDCode csd-code=\"HCP\" codeSystemName=\"2.16.756.5.30.1.127.3.10.6\" originalText=\"Healthcare professional\"/&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant UserID=\"https://repositoryService.com\" AlternativeUserID=\"1\" UserIsRequestor=\"false\" NetworkAccessPointID=\"172.18.0.49\" NetworkAccessPointTypeCode=\"2\"&gt;\n  &lt;RoleIDCode csd-code=\"110153\" codeSystemName=\"DCM\" originalText=\"Source Role ID\"/&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant UserID=\"https://primarySystem.com\" AlternativeUserID=\"UNKNOWN\" UserIsRequestor=\"true\" NetworkAccessPointID=\"hcohcdemo01-app06-icwpxs01.net.swisscom-health.it\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"110152\" codeSystemName=\"DCM\" originalText=\"Destination Role ID\"/&gt;\n &lt;/ActiveParticipant&gt;\n &lt;AuditSourceIdentification code=\"1\" AuditSourceID=\"connectathon\"/&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"752343^^^&amp;amp;2.16.840.1.113883.3.37.4.1.1.2.1.1&amp;amp;ISO\" ParticipantObjectTypeCode=\"1\" ParticipantObjectTypeCodeRole=\"1\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"2\" originalText=\"Patient Number\" codeSystemName=\"RFC-3881\"/&gt;\n &lt;/ParticipantObjectIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"urn:uuid:6b948daf-ab4a-4d51-a1a4-e9f4b2e05ff7\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"20\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd\" originalText=\"submission set classificationNode\" codeSystemName=\"IHE XDS Metadata\"/&gt;\n &lt;/ParticipantObjectIdentification&gt;\n&lt;/AuditMessage&gt;\n</code></pre> <p>The message is made of the following blocks:</p> <ul> <li>EventIdentification: Element with event related information including the timestamp.</li> <li>ActiveParticipant: Information related to the community repository which is the source of the documents.</li> <li>ActiveParticipant: Information on the user as required by the IHE XUA profile.</li> <li>ActiveParticipant: Element with information on the authenticated user initiating the request.</li> <li>ActiveParticipant: Element with information on the primary system performing which is the destination of the documents.</li> <li>ParticipantObjectIdentification: Element conveying the master patient ID (XAD-PID) in CX format (see PIX Feed).  </li> <li>ParticipantObjectIdentification: Element with request message related information.  </li> </ul> <p>TODO Update with gazelle example</p>"},{"location":"ProvideAndRegister/#security-requirements","title":"Security Requirements","text":"<p>To ensure privacy the transaction must be secured using https with mutual authentication, with X.509 certificates (extended validation required) and client and server side certificate validation.</p> <p>To enable authorization, the transaction must convey the XUA Assertion for authorization in the security header of the SOAP envelope. See Provide X-User Assertion for the implementation details.</p> <p>Note</p> <ul> <li>Some test environments dropped the mutual authentication or TLS for testing purposes. Please contact your test system provider on the details.</li> <li>Some test environments may also drop authorization for testing purposes. Please contact your test system provider on the details.</li> </ul>"},{"location":"ProvideAndRegister/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment, test systems of the EPR communities or the EPR Playground.</p>"},{"location":"ProvideXAssertion/","title":"Provide X-User Assertion","text":"<p>Method to provide a SAML 2.0 assertion in the Web Service Security header to authorize transactions. Primary systems shall use this transaction to provide a SAML Assertion to authorize transactions.</p>"},{"location":"ProvideXAssertion/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction to provide SAML 2 assertions retrieved by the Get X-User Assertion  with XDS.b transactions as defined in the IHE XUA profile with Swiss specific extensions defined in Amendment 1 to Annex 5.   </p>"},{"location":"ProvideXAssertion/#transaction","title":"Transaction","text":"<p>This transaction is not used standalone and shall be used in conjunction with other transactions which require authorization. These are:</p> <ul> <li>Registry Stored Query - get and display document metadata</li> <li>Retrieve Document Set - get and display documents</li> <li>Provide and Register Document Set - store documents in the EPR </li> </ul>"},{"location":"ProvideXAssertion/#message-semantics","title":"Message Semantics","text":"<p>Primary systems shall use a Get X-User Assertion  transaction to retrieve XUA SAML Assertion for authorization, before performing transactions which require authorization. The XUA SAML Assertion for authorization shall be added to the Security header of the SOAP envelope used for the transaction, which requires authorization.  </p> <p>The following snippet shows an abbreviated example message with a SAML Assertion:  </p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;soap:Envelope xmlns=\" !-- namespaces omitted -- \"&gt;\n &lt;soap:Header&gt;\n   &lt;wsa:To soap:mustUnderstand=\"1\"&gt; &lt;!-- id of transaction used in conjunction --&gt;&lt;/wsa:To&gt;\n   &lt;wsa:MessageID soap:mustUnderstand=\"1\"&gt;urn:uuid:31D7E4B5-C117-481E-9EE1-F32849E81BF8&lt;/wsa:MessageID&gt;\n   &lt;wsa:Action soap:mustUnderstand=\"1\"&gt;urn:ihe:iti:2007:RegistryStoredQuery&lt;/wsa:Action&gt;\n   &lt;wsse:Security&gt;\n     &lt;saml2:Assertion&gt;\n       &lt;!-- assertion content omitted for brevity --&gt;\n     &lt;/saml2:Assertion&gt;\n   &lt;/wsse:Security&gt;\n &lt;/soap:Header&gt;\n &lt;soap:Body&gt;\n  &lt;!-- body elements of transaction used in conjunction omitted for brevity --&gt;\n &lt;/soap:Body&gt;\n&lt;/soap:Envelope&gt;\n</code></pre> <p>For the details on the Assertion content, please see the step by step example in Get X-User Assertion .</p>"},{"location":"ProvideXAssertion/#audit-log","title":"Audit Log","text":"<p>This transaction does not require separate ATNA audit log messages, but adds requirements to the transactions used with, as described in section 1.6.4.3.5 of Amendment 1 to Annex 5.</p>"},{"location":"ProvideXAssertion/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment or test systems of the EPR communities.</p>"},{"location":"Questionnaire/","title":"How to build a FHIR-Questionnaire","text":"<p>This guide aims to explain how to build a FHIR Questionnaire, and in particular how to use the extensions necessary to make full use of the <code>@i4mi/fhir-questionnaire-renderer</code> library. You can use the Questionnaire Prototype from the mHealth prototype project to render the questionnaire.</p>"},{"location":"Questionnaire/#useful-links","title":"Useful Links","text":"<ul> <li>FHIR Resource Questionnaire: Official documentation for FHIR Questionnaire</li> <li>@i4mi/fhir-questionnaire-renderer: Library for rendering a <code>Questionnaire</code> resource in Quasar</li> <li>@i4mi/fhir_questionnaire: Library for managing the logic of FHIR Questionnaires, with updating depending questions, generation of <code>QuestionnaireResponse</code> resources, prepopulation and more.</li> <li>LHC FHIR Questionnaire Builder: Tool to build basic FHIR Questionnaire.</li> <li>FHIR Validator: Useful tool to check if your Questionnaire is a valid FHIR resource.</li> </ul>"},{"location":"Questionnaire/#minimal-example","title":"Minimal Example","text":"<p>Your are free to set whatever fields you want inside your <code>Questionnaire</code> resource (note that the <code>status</code> field is mandatory), however only the following fields will be rendered by the Questionnaire Renderer:</p> <ul> <li><code>title</code> the title of the questionnaire</li> <li><code>description</code> the description as a markdown string</li> <li><code>item</code> the array that contains the questions</li> </ul> Minimal example<pre><code>{\n  \"resourceType\": \"Questionnaire\",\n  \"status\": \"draft\",\n  \"title\": \"Basic Data Questionnaire\",\n  \"description\": \"# How it works?\\n\\n Simply enter your date of birth and your name and press save!\",\n  \"item\": [\n    {\n      \"linkId\": \"Q1\",\n      \"type\": \"dateTime\",\n      \"required\": true,\n      \"text\": \"Date of Birth\"\n    },\n    {\n      \"linkId\": \"Q2\",\n      \"type\": \"boolean\",\n      \"required\": true,\n      \"text\": \"Vaccinated against polio\"\n    }\n  ]\n}\n</code></pre> <p>For a more detailed and commented example, see the last chapter of this guide.</p>"},{"location":"Questionnaire/#adding-a-question","title":"Adding a question","text":"<p>To add a question, add an object inside the <code>item</code> array. Every question should have a unique <code>linkId</code> and a <code>type</code>. The rendering library supports the following subset of the questionnaire item types:</p> <ul> <li><code>group</code></li> <li><code>display</code></li> <li><code>boolean</code></li> <li><code>decimal</code></li> <li><code>integer</code></li> <li><code>date</code></li> <li><code>datetime</code></li> <li><code>time</code></li> <li><code>string</code></li> <li><code>text</code></li> <li><code>url</code></li> </ul>"},{"location":"Questionnaire/#required-questions","title":"Required questions","text":"<p>To specify if a questionnaire item is required to be answered, set the field <code>required</code> to <code>true</code>.</p> <p>For details, please see the official documentation for enableWhen.</p>"},{"location":"Questionnaire/#answer-options-for-choice-questions","title":"Answer options for choice questions","text":"<p>For choice questions, you can specify the potential answer options in the answerOptions field. Usually, it makes the most sense to use the valueCoding type here, but in this documentation we chose valueString for keeping it simpler.</p> Choice question<pre><code>{\n  \"linkId\": \"Q4\",\n  \"type\": \"choice\",\n  \"text\": \"Eye color\",\n  \"repeats\": false,\n  \"answerOptions\": [\n    {\n      \"valueString\": \"green\"\n    },\n    {\n      \"valueString\": \"brown\"\n    },\n    {\n      \"valueString\": \"blue\"\n    },\n    {\n      \"valueString\": \"other\"\n    }\n  ]\n}\n</code></pre> <p>The <code>repeats</code> field declares if a choice question can have multiple answers or not. Set it to <code>true</code> to have a multiple choice question.</p> <p>As an alternative to <code>answerOptions</code>, you can link to a ValueSet in the <code>answerValueSet</code> field with an <code>#</code> and the id of the contained value-set. The valueSet resource must be in the <code>contained</code> of the Questionnaire, external ValueSets are not supported as of now.</p> Linking a ValueSet<pre><code>{\n  ...,\n  \"answerValueSet\": \"#ORGAN-DONATION-LIST-ValueSet\"\n}\n</code></pre>"},{"location":"Questionnaire/#subquestions","title":"Subquestions","text":"<p>In a FHIR questionnaire, it is possible to have subquestions for a question. Just add the subquestion in the <code>item</code> field of the parent question. Of course, a parent item can have multiple subquestions, and the subquestions themselves can have subquestions again. This is rendered in a hierarchical way by the questionnaire renderer. If you want to display the subquestions depending from the answer given to the parent question, you have to declare them as depending questions (see next chapter).</p> Sub-question<pre><code>{\n  \"linkId\": \"parent\",\n  \"type\": \"boolean\",\n  \"text\": \"Do you have children?\",\n  \"item\": [\n    {\n      \"linkId\": \"subQuestion\",\n      \"type\": \"integer\",\n      \"text\": \"How many children do you have?\"\n    }\n  ]\n}\n</code></pre>"},{"location":"Questionnaire/#depending-questions","title":"Depending questions","text":"<p>You can also dynamically enable or not some questions, depending on the status of other questions.</p> Depending question<pre><code>{\n  \"linkId\": \"Q3\",\n  \"type\": \"date\",\n  \"text\": \"Date of vaccination\",\n  \"enableWhen\": [\n    {\n      \"question\": \"Q2\",\n      \"operator\": \"=\",\n      \"answerBoolean\": true\n    }\n  ]\n}\n</code></pre>"},{"location":"Questionnaire/#initial-values","title":"Initial values","text":"<p>You can also define an initial answer, that is preset to a question and can be changed by the user.</p> Initial value<pre><code>{\n  \"linkId\": \"initial\",\n  \"type\": \"boolean\",\n  \"text\": \"Do you want to receive our amazing newsletter?\",\n  \"initial\": [\n    {\n      \"valueBoolean\": true\n    }\n  ]\n}\n</code></pre>"},{"location":"Questionnaire/#questionnaire-item-ui-control-codes","title":"Questionnaire Item UI Control Codes","text":"<p>It is possible to specify how questions should be rendered by adding an extension to an element or to its child (see next chapters for more information).</p> <p>Currently only the <code>Help-Button</code>, <code>Prompt</code> and <code>Unit</code> codes are supported. To see which items do support these codes, please refer on documentation of fhir-questionnaire-renderer.</p> <p>For <code>choice</code> questions you can specify if the question should be rendered with radio control (one answer) or with checkboxes (multiple answer allowed) by adding an extension directly to the question. If you do not use this extension on <code>choice</code> questions, they will be rendered as dropdown control and the <code>repeats</code> will be used to determine if it is or not a multiple answers question.</p>"},{"location":"Questionnaire/#help-button","title":"Help Button","text":"<p>If you want to add explanatory/help text to a question, you can do so by adding an item with <code>display</code> element with the <code>help</code> code and <code>questionnaire-itemControl</code> extension as described below.</p> <p>The help element will take the form of an icon with a question mark which will display the text when hovering over it on a computer or pressing it on a mobile device.</p> Help button<pre><code>{\n  \"linkId\": \"Q1-with-help\",\n  \"text\": \"Where did you put your advanced directives?\",\n  \"type\": \"text\",\n  \"item\": [\n    {\n      \"extension\": [\n        {\n          \"url\": \"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl\",\n          \"valueCodeableConcept\": {\n            \"coding\": [\n              {\n                \"system\": \"http://hl7.org/fhir/questionnaire-item-control\",\n                \"code\": \"help\",\n                \"display\": \"Help-Button\"\n              }\n            ],\n            \"text\": \"Help-Button\"\n          }\n        }\n      ],\n      \"linkId\": \"H-Q1\",\n      \"text\": \"Please, be precise e.g \u201dIn the middle drawer of my desk at my house.\u201d\",\n      \"type\": \"display\"\n    }\n  ]\n}\n</code></pre>"},{"location":"Questionnaire/#prompt","title":"Prompt","text":"<p>If you want to add prompt/placeholder to an input question, you can do so by adding an item with <code>display</code> element with the <code>prompt</code> code and <code>questionnaire-itemControl</code> extension as described below.</p> <p>The prompt element will take the form of a text inside an input to give information about what should be entered.</p> Prompt<pre><code>{\n  \"extension\": [\n    {\n      \"url\": \"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl\",\n      \"valueCodeableConcept\": {\n        \"coding\": [\n          {\n            \"system\": \"http://hl7.org/fhir/questionnaire-item-control\",\n            \"code\": \"prompt\",\n            \"display\": \"Prompt\"\n          }\n        ],\n        \"text\": \"Prompt\"\n      }\n    }\n  ],\n  \"linkId\": \"P-Q1\",\n  \"text\": \"Your advanced directive is ...\",\n  \"type\": \"display\"\n}\n</code></pre>"},{"location":"Questionnaire/#unit","title":"Unit","text":"<p>If you want to add unit to an input question, you can do so by adding an item with <code>display</code> element with the <code>unit</code> code and <code>questionnaire-itemControl</code> extension as described below.</p> <p>The unit element will be displayed at the end of the input field as an indication of the unit of what the user should enter. Please not that the unit is only cosmetic, if you want to have an answer corresponding to an input with its unit, you should use a quantity item, but its not supported by this project.</p> Unit<pre><code>{\n  \"extension\": [\n    {\n      \"url\": \"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl\",\n      \"valueCodeableConcept\": {\n        \"coding\": [\n          {\n            \"system\": \"http://hl7.org/fhir/questionnaire-item-control\",\n            \"code\": \"unit\",\n            \"display\": \"Unit\"\n          }\n        ],\n        \"text\": \"Unit\"\n      }\n    }\n  ],\n  \"linkId\": \"U-Q1\",\n  \"text\": \"m / s ^ 2\",\n  \"type\": \"display\"\n}\n</code></pre>"},{"location":"Questionnaire/#check-box","title":"Check-box","text":"<p>If you want to render <code>choice</code> question with checkbox control, you can do so by adding the <code>check-box</code> code and <code>questionnaire-itemControl</code> extension as described below.</p> Checkbox<pre><code>{\n  \"extension\": [\n    {\n      \"url\": \"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl\",\n      \"valueCodeableConcept\": {\n        \"coding\": [\n          {\n            \"system\": \"http://hl7.org/fhir/questionnaire-item-control\",\n            \"code\": \"check-box\",\n            \"display\": \"Check-box\"\n          }\n        ],\n        \"text\": \"Check-box\"\n      }\n    }\n  ],\n  \"linkId\": \"Q1-\",\n  \"type\": \"choice\",\n  \"required\": true,\n  \"repeats\": true,\n  \"text\": \"I CONSENT to the removal of the following organs, tissues or cells, and to the associated preparatory medical measures:\",\n  \"answerValueSet\": \"#ORGAN-DONATION-LIST-ValueSet\"\n}\n</code></pre>"},{"location":"Questionnaire/#radio-button","title":"Radio Button","text":"<p>If you want to render <code>choice</code> question with radio control, you can do so by adding the <code>radio-button</code> code and <code>questionnaire-itemControl</code> extension as described below.</p> Radio button<pre><code>{\n      \"extension\": [\n        {\n          \"url\": \"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl\",\n          \"valueCodeableConcept\": {\n            \"coding\": [\n              {\n                \"system\": \"http://hl7.org/fhir/questionnaire-item-control\",\n                \"code\": \"radio-button\",\n                \"display\": \"Radio Button\"\n              }\n            ],\n            \"text\": \"Radio Button\"\n          }\n        }\n      ],\n      \"linkId\": \"Q1\",\n      \"text\": \"In the event that removal of organs, tissues or cells is possible after my death, my wishes are as follows:\",\n      \"type\": \"choice\",\n      \"required\": true,\n      \"repeats\": false,\n      \"answerValueSet\": \"#ORGAN-DONATION-RESPONSE-ValueSet\",\n</code></pre>"},{"location":"Questionnaire/#internationalisation","title":"Internationalisation","text":"<p>To add internationalisation to a questionnaire, use the FHIR extension translation. The following is applicable for most text elements of a questionnaire (<code>text</code>, <code>title</code>, <code>description</code>, ...). Please note, that for choice questions with answerOptions, internationalisation is not supported. In this case, you need to use an answerValueSet with designation.</p> Internationalisation<pre><code>{\n  \"title\": \"Digital Organ Donation Card\",\n  \"_title\": {\n    \"extension\": [\n      {\n        \"url\": \"http://hl7.org/fhir/StructureDefinition/translation\",\n        \"extension\": [\n          {\n            \"url\": \"lang\",\n            \"valueCode\": \"de\"\n          },\n          {\n            \"url\": \"content\",\n            \"valueString\": \"Digitale Organspende-Karte\"\n          }\n        ]\n      },\n      {\n        \"url\": \"http://hl7.org/fhir/StructureDefinition/translation\",\n        \"extension\": [\n          {\n            \"url\": \"lang\",\n            \"valueCode\": \"fr\"\n          },\n          {\n            \"url\": \"content\",\n            \"valueString\": \"Carte num\u00e9rique de don d'organes\"\n          }\n        ]\n      },\n      {\n        \"url\": \"http://hl7.org/fhir/StructureDefinition/translation\",\n        \"extension\": [\n          {\n            \"url\": \"lang\",\n            \"valueCode\": \"it\"\n          },\n          {\n            \"url\": \"content\",\n            \"valueString\": \"Carta digitale per la donazione di organi\"\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre> <p>The <code>@i4mi/fhir_questionnaire</code> library will process the extension, see the documentation for more information.</p>"},{"location":"Questionnaire/#prepopulation","title":"Prepopulation","text":"<p>Besides the initial value (see above), it is also possible to prepopulate the answers to the questions, using another FHIR resource with the information contained. The difference between initial values and prepopulation is that, with initial values, the preset answers are the same for every user, while with prepopulation, the answers can be set dynamically for every user, depending on the resource that is passed to the Questionnaire library. How the information is to be extracted from the passed resource is described in FHIRPath.</p> <p>For this, you have to have the initialExpression extension in every item that should be prepopulated, with the FHIRPath expression that extracts the wanted value from the passed resource.</p> Prepopulation<pre><code>{\n  \"linkId\": \"populateExample\",\n  \"text\": \"Birthdate\",\n  \"type\": \"date\",\n  \"extension\": [\n    {\n      \"url\": \"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression\",\n      \"valueExpression\": {\n        \"language\": \"text/fhirpath\",\n        \"expression\": \"%patient.birthDate\"\n      }\n    }\n  ]\n}\n</code></pre> <p>Of course, you also have to pass the resource containing the information to the QuestionnaireData library. You can do this like this:</p> QuestionnaireData library<pre><code>const fhirQuestionnaire = new QuestionnaireData(myQuestionnaire, languages); // fhirQuestionnaire is the instance of your QuestionnaireData\nfhirQuestionnaire.populate(\n  [myPatientResource], // the resources containing the needed information; you can only provide one resource of every ResourceType (e.g. Patient)\n  true // true if you want to overwrite potentially already existing answers\n);\n</code></pre> <p>More information on prepopulating are found on the @i4mi/fhir-questionnaire README.</p>"},{"location":"Questionnaire/#detailed-example-with-comments","title":"Detailed example with comments","text":"<p>This is a detailled example using many of the concepts explained above. It is based on the organ donation questionnaire used in this app, however some redundancies are stripped out for better readability.</p> Detailed example<pre><code>{\n  \"resourceType\": \"Questionnaire\",\n  \"url\": \"https://github.com/mHealth-Prototyp/Questionnaires/blob/main/resources/Questionnaire/organ-donation.json\",\n  \"version\": \"0.0.1\", // the questionnaire needs a version number so the QuestionnaireResponse resource can be matched with the exact version of the questionnaire\n  \"name\": \"OrganDonation\", // the technical name of the questionnaire, which is usually not displayed to the user\n  \"title\": \"Digital Organ Donation Card\", // the title of the questionnaire as it is displayed to the user\n  \"_title\": {\n    \"extension\": [\n      {\n        // for every language translation of the title, we need an extension of the title field, which are placed in the \"_title\" field\n        \"url\": \"http://hl7.org/fhir/StructureDefinition/translation\",\n        \"extension\": [\n          {\n            \"url\": \"lang\",\n            \"valueCode\": \"de\"\n          },\n          {\n            \"url\": \"content\",\n            \"valueString\": \"Digitale Organspende-Karte\"\n          }\n        ]\n      },\n      {\n        \"url\": \"http://hl7.org/fhir/StructureDefinition/translation\",\n        \"extension\": [\n          {\n            \"url\": \"lang\",\n            \"valueCode\": \"fr\"\n          },\n          {\n            \"url\": \"content\",\n            \"valueString\": \"Carte num\u00e9rique de don d'organes\"\n          }\n        ]\n      }\n    ]\n  },\n  \"status\": \"draft\", // the status of the questionnaire\n  \"date\": \"2023-03-20\", // when the questionnaire was published\n  \"description\": \"**Here's how it works**  \\n1. Fill in the online form completely.  \\n2. Register it in your EPR.  \\n3. Inform your relatives of your wishes and inform them of the presence of this form on your EPD. If you change your mind, fill in the form again, and inform your relatives of this new decision.\",\n  \"_description\": {\n    \"extension\": [\n      // internationalisation for the description works the same as for the title and is stripped out for better readability\n    ]\n  },\n  \"code\": [\n    // this code represents the whole questionnaire\n    {\n      \"system\": \"urn:prototype-4-codes\", // in lack of a better alternative, we use an own code system\n      \"code\": \"organ-donation\",\n      \"display\": \"Organ Donation\"\n    }\n  ],\n  \"item\": [\n    {\n      \"linkId\": \"Dgroup\", // a question group is also a question...\n      \"type\": \"group\", // ... of type group\n      \"item\": [\n        // the actual subquestions of the group are in the \"item\" field\n        {\n          \"linkId\": \"D1\", // the unique ID of the question\n          \"text\": \"First and familiy name\", // text displayed for the question\n          \"_text\": {\n            \"extension\": [\n              // internationalisation for the item texts works the same as for the title and is stripped out for better readability\n            ]\n          },\n          \"type\": \"string\", // the name of the user is a string\n          \"required\": \"true\", // this question is mandatory\n          \"repeats\": false, // but only one answer is allowed\n          \"readOnly\": true, // because we populate it from the Patient resource, in this case the name is read only\n          \"extension\": [\n            {\n              // with this extension, we can define with a FHIRPath expression, how the value of the question should be prepopulated\n              \"url\": \"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression\",\n              \"valueExpression\": {\n                \"language\": \"text/fhirpath\",\n                \"expression\": \"%patient.name.given.first() + ' ' + %patient.name.family.first()\"\n              }\n            }\n          ]\n        },\n        {\n          \"linkId\": \"D2\",\n          \"text\": \"Birthdate\",\n          \"_text\": {\n            \"extension\": [\n              // internationalisation for the item texts works the same as for the title and is stripped out for better readability\n            ]\n          },\n          \"type\": \"date\", // type of birth date is a date\n          \"required\": \"true\", // this question is mandatory\n          \"repeats\": false, // but only one answer is allowed\n          \"readOnly\": true, // because we populate it from the Patient resource, in this case the name is read only\n          \"extension\": [\n            {\n              // another example how to prepopulate the answer with the birthdate from the patient resource\n              \"url\": \"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression\",\n              \"valueExpression\": {\n                \"language\": \"text/fhirpath\",\n                \"expression\": \"%patient.birthDate\"\n              }\n            }\n          ]\n        }\n      ]\n    },\n    {\n      \"linkId\": \"Q1\",\n      \"text\": \"In the event that removal of organs, tissues or cells is possible after my death, my wishes are as follows:\",\n      \"_text\": {\n        \"extension\": [\n          // internationalisation for the item texts works the same as for the title and is stripped out for better readability\n        ]\n      },\n      \"type\": \"choice\", // this is a choice question\n      \"required\": true, // that is also required\n      \"repeats\": false, // but only one answer can be selected\n      \"answerValueSet\": \"#ORGAN-DONATION-RESPONSE-ValueSet\", // this refers to the answerValueset, where the answers options are defined\n      // the valueSet can be found in the \"contained\" field of the Questionnaire resource\n      \"item\": [\n        // the choice question has some sub-questions\n        {\n          \"linkId\": \"Q1-SQ1\",\n          \"type\": \"choice\",\n          \"required\": true,\n          \"repeats\": true, // other than the parent question, multiple answers are allowed here\n          \"text\": \"I CONSENT to the removal of the following organs, tissues or cells, and to the associated preparatory medical measures:\",\n          \"_text\": {\n            \"extension\": [\n              // internationalisation for the item texts works the same as for the title and is stripped out for better readability\n            ]\n          },\n          \"enableWhen\": [\n            {\n              // here we can define when the question should be enabled and thus displayed to the user\n              \"question\": \"Q1\", // this declares on which question this question depends\n              \"operator\": \"=\", // we want to enable it when the answer to Q1 equals the following answer (could also be not equal, or bigger / smaller for numeric answers)\n              \"answerCoding\": {\n                // and here we define the answer that must be set in Q1 to enable this question\n                \"system\": \"https://github.com/mHealth-Prototyp/Questionnaires/blob/main/resources/ValueSet/organ-donation-response.json\",\n                \"code\": \"yes_following\"\n              }\n            }\n          ],\n          \"answerValueSet\": \"#ORGAN-DONATION-LIST-ValueSet\" // this refers to the answerValueset, where the answers options are defined\n          // the valueSet can be found in the \"contained\" field of the Questionnaire resource\n        }\n      ],\n      \"extension\": [\n        {\n          // this itemControl extensions defines that the answer options should be displayed as radio buttons\n          \"url\": \"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl\",\n          \"valueCodeableConcept\": {\n            \"coding\": [\n              {\n                \"system\": \"http://hl7.org/fhir/questionnaire-item-control\",\n                \"code\": \"radio-button\",\n                \"display\": \"Radio Button\"\n              }\n            ],\n            \"text\": \"Radio Button\"\n          }\n        }\n      ]\n    },\n    {\n      \"linkId\": \"I1\",\n      \"text\": \"The information you provide here is only recorded on your EPR.\",\n      \"type\": \"display\", // the final question is only for displaying the information, and does not take any answers\n      \"_text\": {\n        \"extension\": [\n          // internationalisation for the item texts works the same as for the title and is stripped out for better readability\n        ]\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"RegistryStoredQuery/","title":"Registry Stored Query","text":"<p>Transaction to lookup the document metadata for the documents stored in a patient's EPR. Primary systems shall use this transaction to view the metadata of the available documents for to display the data in the UI.   </p>"},{"location":"RegistryStoredQuery/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction to retrieve the document metadata for the documents stored in a patients EPR. In the Swiss EPR the IHE XDS.b profile and transactions shall be used to retrieve the document metadata.</p> <p>To retrieve the document metadata of the document stored in a patients EPR, the primary system shall perform a Registry Stored Query [ITI-18]. The Registry Stored Query [ITI-18] supports various query parameter as search and filter parameter. The most common parameter used in the Swiss EPR are the patient ID in CX format and the status information, which must be Approved.</p> <p>The community responds with the metadata sets of all documents registered in the patient's EPR, which match the search and filter parameter of the query. The profile is based upon the ebXML standard. Due to the genericity of the ebXML standard, the response is not human readable and needs without background information given below.</p>"},{"location":"RegistryStoredQuery/#transaction","title":"Transaction","text":""},{"location":"RegistryStoredQuery/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in the ebXML standard with restrictions defined in the IHE profile and the ordinances to the Swiss EPR.</p>"},{"location":"RegistryStoredQuery/#request-message","title":"Request Message","text":"<p>The following snippet is taken from a sample request recorded during the EPR projectathon in September 2020. Some elements were omitted to increase readability. The raw request file may be found here.</p> <p>The request message shall be a XML SOAP envelope with the query embedded in the Body element of the SOAP envelope. The SOAP Header element conveys the following information:</p> <ul> <li>To element: The URL of the registry stored query service.</li> <li>MessageID element: a UUID of the message.</li> <li>Action element: The SOAP action identifier of the query as defined in the IHE ITI Technical Framework.</li> <li>Security element: The Web Service Security header as defined in the WS Security specification. This element conveys the XUA Assertion used for authorization (see Provide X-User Assertion).  </li> </ul> <p>The SOAP Body element conveys the AdhocQuery (lines 15 to 26 below) with the following information:</p> <ul> <li>Slot element with name $XDSDocumentEntryStatus: The status filter parameter, which must take the value urn:oasis:namesebxml-regrep:StatusType:Approved (line 18).  </li> <li>Slot element with name $XDSDocumentEntryPatientId: The master patient ID (XAD-PID) of the patient in CX format (see PIX Feed) (line 23).</li> </ul> ITI-18_request.xml<pre><code>&lt;soapenv:Envelope xmlns=\"!-- namespaces ommitted --&gt;\"&gt;\n &lt;soapenv:Header&gt;\n  &lt;wsa:To soapenv:mustUnderstand=\"1\"&gt;https://epd-test.com/Registry/services/RegistryService&lt;/wsa:To&gt;\n  &lt;wsa:MessageID soapenv:mustUnderstand=\"1\"&gt;urn:uuid:31D7E4B5-C117-481E-9EE1-F32849E81BF8&lt;/wsa:MessageID&gt;\n  &lt;wsa:Action soapenv:mustUnderstand=\"1\"&gt;urn:ihe:iti:2007:RegistryStoredQuery&lt;/wsa:Action&gt;\n  &lt;wsse:Security&gt;\n   &lt;saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\"&gt;\n    &lt;!-- CH:XUA Assertion omitted --&gt;\n   &lt;/saml2:Assertion&gt;\n  &lt;/wsse:Security&gt;\n &lt;/soapenv:Header&gt;\n &lt;soapenv:Body&gt;\n  &lt;ns0:AdhocQueryRequest&gt;\n   &lt;ns0:ResponseOption returnType=\"ObjectRef\" returnComposedObjects=\"true\"/&gt;\n   &lt;rim:AdhocQuery id=\"urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d\"&gt;\n    &lt;rim:Slot name=\"$XDSDocumentEntryStatus\"&gt;\n     &lt;rim:ValueList&gt;\n      &lt;rim:Value&gt;('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')&lt;/rim:Value&gt;\n     &lt;/rim:ValueList&gt;\n    &lt;/rim:Slot&gt;\n    &lt;rim:Slot name=\"$XDSDocumentEntryPatientId\"&gt;\n     &lt;rim:ValueList&gt;\n      &lt;rim:Value&gt;'7e1c6e78-58f1-4a43-ae88-0d5a5c4ab43e^^^&amp;amp;1.3.6.1.4.1.21367.2017.2.5.45&amp;amp;ISO'&lt;/rim:Value&gt;\n     &lt;/rim:ValueList&gt;\n    &lt;/rim:Slot&gt;\n   &lt;/rim:AdhocQuery&gt;\n  &lt;/ns0:AdhocQueryRequest&gt;\n &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre>"},{"location":"RegistryStoredQuery/#response-message","title":"Response Message","text":"<p>TODO add the originalProvider to the response message.</p> <p>Since the ebXML standard is very generic, the response message is quite lengthy and needs some background information to interpret.</p> <p>The structure of the result set is as follows (see example below):</p> <ul> <li>The metadata of the individual documents are bundled in a ExtrinsicObject element.</li> <li>The metadata attributes are encoded as Slot, as Classification or as ExternalIdentifier elements.</li> <li>Metadata attributes encoded as Slots can be identified and interpreted by the slot's name attribute.</li> <li>Metadata attributes encoded as Classification can be identified and interpreted by the classification's classificationScheme attribute.</li> <li>The unique ID of the document is encoded as ExternalIdentifier, which has an identificationScheme attribute with a fixed value.</li> </ul> <p>The table of the identifier used to indicate the metadata attributes is defined by the metadata model used by IHE XDS.b in IHE ITI Technical Framework Vol. 3, Section 4.2.5.2.</p> <p>The corresponding interpretation of the metadata attributes in the Swiss EPR and the supported value sets may be found in Annex 3 of the ordinances of the Swiss electronic patient dossier.</p> <p>A request message is quite lengthy. A listing with abrevations used in the step by step interpretation below is found here. The raw version of the message may be found here.</p>"},{"location":"RegistryStoredQuery/#message-interpretation","title":"Message Interpretation","text":"<p>The response message is not very complex, but quite lengthy due to the genericity of the ebXML standard. Therefore the following step by step interpretation may be of help to interpret the response.</p> <p>The SOAP Header element conveys the following information:</p> <ul> <li>Action element: The SOAP action identifier of the response as defined in the IHE ITI Technical Framework.</li> <li>RelatesTo element: The messageID of the query request (see above).</li> </ul> ITI-18_response.xml<pre><code> &lt;S:Header&gt;\n  &lt;wsa:Action s:mustUnderstand=\"1\"\n   xmlns:s=\"http://www.w3.org/2003/05/soap-envelope\"\n   xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;urn:ihe:iti:2007:RegistryStoredQueryResponse&lt;/wsa:Action&gt;\n  &lt;wsa:RelatesTo xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:a8313b99-aad5-4880-94d2-4b02197cb650&lt;/wsa:RelatesTo&gt;\n &lt;/S:Header&gt;\n</code></pre> <p>The SOAP body element conveys 0..N ExtrinsicObject elements, each conveying the metadata of a single document.</p> <pre><code>    &lt;ExtrinsicObject mimeType=\"application/fhir+json\" objectType=\"urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1\" id=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" lid=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" status=\"urn:oasis:names:tc:ebxml-regrep:StatusType:Approved\" home=\"urn:oid:1.1.4567334.1.6\"\n</code></pre> <p>The element has fixed attributes defined in the IHE ITI Technical Framework. Beyond these, the ExtrinsicObject conveys the following information for the primary system:</p> <ul> <li>mimeType attribute: The document mime type. It's value must match a mime type supported by the Swiss EPR as defined in Annex 3.</li> <li>status attribute: The status of the document, which should be Approved.  </li> </ul> <p>As explained above, a subset of the relevant metadata are defined in ebXML slot elements. These are:   </p> <pre><code>     &lt;Slot name=\"repositoryUniqueId\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;1.1.4567332.1.75&lt;/Value&gt;\n      &lt;/ValueList&gt;\n     &lt;/Slot&gt;\n</code></pre> <ul> <li>repositoryUniqueId: The unique ID of the repository the document is stored. This value must be used when retrieving documents to display (see Retrieve Document Set).</li> </ul> <pre><code>     &lt;Slot name=\"hash\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;a72f1824ea1d57af00faf5dd5ccb9aea0b0ce390&lt;/Value&gt;\n      &lt;/ValueList&gt;\n     &lt;/Slot&gt;\n</code></pre> <ul> <li>hash: The hash value of the binary.</li> </ul> <pre><code>     &lt;Slot name=\"size\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;5375&lt;/Value&gt;\n      &lt;/ValueList&gt;\n     &lt;/Slot&gt;\n</code></pre> <ul> <li>size: The size of the binary.</li> </ul> <pre><code>     &lt;Slot name=\"creationTime\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;20231219095121&lt;/Value&gt;\n      &lt;/ValueList&gt;\n     &lt;/Slot&gt;\n</code></pre> <ul> <li>creationTime: The timestamp the document was uploaded to the patient EPR (or last modified).</li> </ul> <pre><code>     &lt;Slot name=\"languageCode\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;en&lt;/Value&gt;\n      &lt;/ValueList&gt;\n     &lt;/Slot&gt;\n</code></pre> <ul> <li>languageCode: The coded value of the documents language. It's value must match one code value supported by the Swiss EPR as defined in Annex 3.</li> </ul> <pre><code>     &lt;Slot name=\"sourcePatientId\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;CHPAM3946^^^&amp;amp;1.3.6.1.4.1.12559.11.20.1&amp;amp;ISO&lt;/Value&gt;\n      &lt;/ValueList&gt;\n     &lt;/Slot&gt;\n</code></pre> <ul> <li>sourcePatientId: The local ID of the patient in the document source system which uploaded the document.</li> </ul> <pre><code>     &lt;Slot name=\"urn:e-health-suisse:2020:originalProviderRole\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;HCP^^^&amp;amp;2.16.756.5.30.1.127.3.10.6&amp;amp;ISO&lt;/Value&gt;\n      &lt;/ValueList&gt;\n     &lt;/Slot&gt;\n</code></pre> <ul> <li>urn:e-health-suisse:2020:originalProviderRole: The Role of original uploader who uploaded the initial version of the document as defined in Attachment 1 to Annex 5. This attribute is used to track the initial uploader role which shall never be modified by metadat update transactions.</li> </ul> <pre><code>     &lt;Name xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;LocalizedString charset=\"UTF-8\" value=\"Vaccination - FSME-Immun 0.25 ml Junior\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/Name&gt;\n</code></pre> <ul> <li>Name: The document name to display in the UI.</li> </ul> <pre><code>     &lt;VersionInfo versionName=\"1\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n</code></pre> <ul> <li>the version info to track upadated by metadata update transactions and document replacements. </li> </ul> <p>A subset of the relevant metadata are defined in ebXML Classification elements. These are:  </p> <pre><code>     &lt;Classification classificationScheme=\"urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d\" classifiedObject=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" nodeRepresentation=\"\" id=\"urn:uuid:e0fcf0a2-f44c-46c5-bc4a-26ac0743f193\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;Slot name=\"authorPerson\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n        &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;^Max^Mustermann^^^Dr.Med&lt;/Value&gt;\n       &lt;/ValueList&gt;\n      &lt;/Slot&gt;\n      &lt;Slot name=\"authorRole\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n        &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;HCP^^^&amp;amp;2.16.756.5.30.1.127.3.10.6&amp;amp;ISO&lt;/Value&gt;\n       &lt;/ValueList&gt;\n      &lt;/Slot&gt;\n      &lt;Slot name=\"authorSpecialty\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n        &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;1050^^^&amp;amp;2.16.756.5.30.1.127.3.5&amp;amp;ISO&lt;/Value&gt;\n       &lt;/ValueList&gt;\n      &lt;/Slot&gt;\n      &lt;VersionInfo versionName=\"-1\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/Classification&gt;\n</code></pre> <ul> <li>authorPerson: The Name of the author of the document binary as defined in IHE ITI Technical Framework Vol. 3. </li> <li>authorRole: The Role of the author of the document binary as defined in IHE ITI Technical Framework Vol. 3 with a code value talen from Annex 3.</li> <li>authorSpeciality: The author speciality of the document binary as defined in IHE ITI Technical Framework Vol. 3 with a code value talen from Annex 3.</li> </ul> <pre><code>     &lt;Classification classificationScheme=\"urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a\" classifiedObject=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" nodeRepresentation=\"184216000\" id=\"urn:uuid:b6a1074e-c92e-4648-9f08-f011b6453689\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;Slot name=\"codingScheme\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n        &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;2.16.840.1.113883.6.96&lt;/Value&gt;\n       &lt;/ValueList&gt;\n      &lt;/Slot&gt;\n      &lt;Name xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;LocalizedString charset=\"UTF-8\" value=\"Patient record type (record artifact)\"\n        xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n      &lt;/Name&gt;\n      &lt;VersionInfo versionName=\"-1\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/Classification&gt;\n</code></pre> <ul> <li>Class Code: The document Class Code metadata attribute, indicated by the value of the classificationScheme equal to urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a as defined in IHE ITI Technical Framework Vol. 3, Section 4.2.5.2. The value conveyed with the nodeRepresentation attribute and the codingScheme value must match one of the supported values in the Swiss EPR as defined in Annex 3.</li> <li>Name : The human readable display name of the document class.</li> </ul> <pre><code>     &lt;Classification classificationScheme=\"urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1\" classifiedObject=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" nodeRepresentation=\"43741000\" id=\"urn:uuid:84594dc4-814a-495f-94d7-08ee5741bbe3\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;Slot name=\"codingScheme\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n        &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;2.16.840.1.113883.6.96&lt;/Value&gt;\n       &lt;/ValueList&gt;\n      &lt;/Slot&gt;\n      &lt;Name xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;LocalizedString charset=\"UTF-8\" value=\"Site of Care (environment)\"\n        xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n      &lt;/Name&gt;\n      &lt;VersionInfo versionName=\"-1\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/Classification&gt;\n</code></pre> <ul> <li>Healthcare Facility Type Code: The type of the healthcare facility from which the document was registered. The value conveyed with the   nodeRepresentation attribute and the codingScheme value must match one of the supported values in the Swiss EPR as   defined in Annex 3.</li> <li>Name : The human readable display name of the healthcare facility type code.</li> </ul> <pre><code>     &lt;Classification classificationScheme=\"urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead\" classifiedObject=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" nodeRepresentation=\"394802001\" id=\"urn:uuid:56fd7e42-192f-4c6b-a2ca-ad0cb9f93e42\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;Slot name=\"codingScheme\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n        &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;2.16.840.1.113883.6.96&lt;/Value&gt;\n       &lt;/ValueList&gt;\n      &lt;/Slot&gt;\n      &lt;Name xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;LocalizedString charset=\"UTF-8\" value=\"General medicine (qualifier value)\"\n        xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n      &lt;/Name&gt;\n      &lt;VersionInfo versionName=\"-1\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/Classification&gt;\n</code></pre> <ul> <li>Practice Setting Code: The practice setting code the document is registered with. The value conveyed with the nodeRepresentation attribute and the codingScheme value must match one of the supported values in the Swiss EPR as defined in Annex 3.</li> <li>Name : The human readable display name of the practice setting code.</li> </ul> <pre><code>     &lt;Classification classificationScheme=\"urn:uuid:f0306f51-975f-434e-a61c-c59651d33983\" classifiedObject=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" nodeRepresentation=\"41000179103\" id=\"urn:uuid:bb58016b-ec14-498f-9969-a9a8e6b1ab03\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;Slot name=\"codingScheme\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n        &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;2.16.840.1.113883.6.96&lt;/Value&gt;\n       &lt;/ValueList&gt;\n      &lt;/Slot&gt;\n      &lt;Name xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;LocalizedString charset=\"UTF-8\" value=\"Immunization Record (record artifact)\"\n        xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n      &lt;/Name&gt;\n      &lt;VersionInfo versionName=\"-1\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/Classification&gt;\n</code></pre> <ul> <li>Document Type Code: The type code of the document. The value conveyed with the nodeRepresentation attribute and the codingScheme value must match one of the supported values in the Swiss EPR as defined in Annex 3.</li> <li>Name : The human readable display name of the document type code.</li> </ul> <pre><code>     &lt;Classification classificationScheme=\"urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f\" classifiedObject=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" nodeRepresentation=\"17621005\" id=\"urn:uuid:4819ee10-581a-49f0-b144-6f85be87b38b\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;Slot name=\"codingScheme\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;ValueList xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n        &lt;Value xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;2.16.840.1.113883.6.96&lt;/Value&gt;\n       &lt;/ValueList&gt;\n      &lt;/Slot&gt;\n      &lt;Name xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;LocalizedString xml:lang=\"en-US\" charset=\"UTF-8\" value=\"Normal\"\n        xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n      &lt;/Name&gt;\n      &lt;VersionInfo versionName=\"-1\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/Classification&gt;\n</code></pre> <ul> <li>confidentiality code: The confidentiality of the the document. The value conveyed with the nodeRepresentation attribute and the codingScheme value must match one of the supported values in the Swiss EPR as defined in Annex 3.</li> <li>Name : The human readable display name of the document confidentiality.</li> </ul> <p>A subset of the relevant metadata are defined in ebXML ExternalIdentifier elements. These are:  </p> <pre><code>     &lt;ExternalIdentifier registryObject=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" identificationScheme=\"urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427\" value=\"CHPAM3946^^^&amp;amp;1.3.6.1.4.1.12559.11.20.1&amp;amp;ISO\" id=\"urn:uuid:a019bc95-f172-42cf-af20-38406d848c5b\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;Name xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;LocalizedString value=\"XDSDocumentEntry.patientId\"\n        xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n      &lt;/Name&gt;\n      &lt;VersionInfo versionName=\"-1\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/ExternalIdentifier&gt;\n</code></pre> <ul> <li>The master patient ID (XAD-SPID): The value conveyed with the value attribute conveys the master patient ID (XAD-SPID)   in the repository. Its value must be used when retrieving documents to display (see Retrieve Document Set).</li> </ul> <pre><code>     &lt;ExternalIdentifier registryObject=\"urn:uuid:1415538d-41bc-41b2-9ae6-8b785f7f3aa6\" identificationScheme=\"urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab\" value=\"2.25.306443472873218838784535217290635593269\" id=\"urn:uuid:b37c4f57-e554-43fb-ab34-8f74dfc5376a\"\n      xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n      &lt;Name xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"&gt;\n       &lt;LocalizedString value=\"XDSDocumentEntry.uniqueId\"\n        xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n      &lt;/Name&gt;\n      &lt;VersionInfo versionName=\"-1\"\n       xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\"/&gt;\n     &lt;/ExternalIdentifier&gt;\n</code></pre> <ul> <li>The document unique ID, indicated by the value of the identificationScheme equal to urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab as defined in IHE ITI Technical Framework Vol. 3, Section 4.2.5.2. The value conveyed with the id attribute uniquely identifies the document in the repository. It's   value must be used when retrieving documents to display (see Retrieve Document Set).</li> </ul>"},{"location":"RegistryStoredQuery/#transport-protocol","title":"Transport Protocol","text":"<p>The primary system shall send the request messages to the registry of the community using the http POST binding as defined in the W3C SOAP specification. It may look like:  </p> <pre><code>POST /RegistryStoredQueryService HTTP/1.1\nHost: company.example.org\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nContent-Type: application/soap+xml; charset=\"utf-8\"\nContent-Length: nnnn  \n</code></pre>"},{"location":"RegistryStoredQuery/#audit-log","title":"Audit Log","text":"<p>Primary systems shall store syslog messages to the audit record repository of the community using TLS transport protocol. The audit message uses XML formatting as specified in RFC 3881 with restrictions specified in the IHE ITI TF and the Extension 1 to Annex5 in the ordinances of the Swiss electronic patient record (see Section 1.5 \"Requirements on ATNA\").  </p> <p>The following snippet shows a example audit message to be written by the primary system:</p> iti-18-log.xml<pre><code>&lt;AuditMessage&gt;\n  &lt;EventIdentification EventActionCode=\"E\" EventDateTime=\"2023-09-11T14:18:27.579+02:00\" EventOutcomeIndicator=\"0\"&gt;\n    &lt;EventID csd-code=\"110112\" codeSystemName=\"DCM\" originalText=\"Query\" /&gt;\n    &lt;EventTypeCode csd-code=\"ITI-18\" codeSystemName=\"IHE Transactions\" originalText=\"Registry Stored Query\" /&gt;\n    &lt;PurposeOfUse csd-code=\"NORM\" codeSystemName=\"2.16.756.5.30.1.127.3.10.5\" originalText=\"Normaler Zugriff\" /&gt;\n  &lt;/EventIdentification&gt;\n  &lt;ActiveParticipant UserID=\"761337610410035724\" UserName=\"&amp;lt;761337610410035724@http://ith-icoserve.com/eHealthSolutionsSTS&amp;gt;\"/&gt;\n  &lt;ActiveParticipant UserID=\"761337610410035724\" UserName=\"Andreas Friederich TANNER-WELTI\" UserIsRequestor=\"true\"&gt;\n    &lt;RoleIDCode csd-code=\"PAT\" codeSystemName=\"2.16.756.5.30.1.127.3.10.6\" originalText=\"Patient\" /&gt;\n  &lt;/ActiveParticipant&gt;\n  &lt;ActiveParticipant UserID=\"http://www.w3.org/2005/08/addressing/anonymous\" AlternativeUserID=\"20559@epd-test.ith-icoserve.com.ForkJoinPool-5-worker-3\" UserIsRequestor=\"true\" NetworkAccessPointID=\"81.223.215.43\" NetworkAccessPointTypeCode=\"2\"&gt;\n    &lt;RoleIDCode csd-code=\"110153\" codeSystemName=\"DCM\" originalText=\"Source\" /&gt;\n  &lt;/ActiveParticipant&gt;\n  &lt;ActiveParticipant UserID=\"https://localhost:7443/Registry/services/RegistryService\" UserIsRequestor=\"false\" NetworkAccessPointID=\"localhost\" NetworkAccessPointTypeCode=\"1\"&gt;\n    &lt;RoleIDCode csd-code=\"110152\" codeSystemName=\"DCM\" originalText=\"Destination\" /&gt;\n  &lt;/ActiveParticipant&gt;\n  &lt;AuditSourceIdentification AuditEnterpriseSiteID=\"1.3.6.1.4.1.21367.2017.2.6.19\" AuditSourceID=\"1.3.6.1.4.1.12559.11.20.1\"&gt;\n    &lt;AuditSourceTypeCode csd-code=\"4\" codeSystemName=\"1.3.6.1.4.1.9784.999200\" originalText=\"ITH icoserve information technology for healthcare sense (tm)\" /&gt;\n  &lt;/AuditSourceIdentification&gt;\n  &lt;ParticipantObjectIdentification ParticipantObjectID=\"d5e42fed-5962-4bb9-b8b6-5d9e8afb0f2a^^^&amp;amp;1.3.6.1.4.1.21367.2017.2.5.93&amp;amp;ISO\" ParticipantObjectTypeCode=\"1\" ParticipantObjectTypeCodeRole=\"1\"&gt;\n    &lt;ParticipantObjectIDTypeCode csd-code=\"2\" codeSystemName=\"RFC-3881\" originalText=\"Patient Number\" /&gt;\n  &lt;/ParticipantObjectIdentification&gt;\n  &lt;ParticipantObjectIdentification ParticipantObjectID=\"urn:uuid:10b545ea-725c-446d-9b95-8aeb444eddf3\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"24\"&gt;\n    &lt;ParticipantObjectIDTypeCode csd-code=\"ITI-18\" codeSystemName=\"IHE Transactions\" originalText=\"Registry Stored Query\" /&gt;\n    &lt;ParticipantObjectQuery&gt;PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxBZGhvY1F1ZXJ5UmVxdWVzdCB4bWxucz0idXJuOm9hc2lzOm5hbWVzOnRjOmVieG1sLXJlZ3JlcDp4c2Q6cXVlcnk6My4wIiB4bWxuczpuczY9InVybjpvYXNpczpuYW1lczp0YzplYnhtbC1yZWdyZXA6eHNkOmxjbTozLjAiIHhtbG5zOm5zNT0idXJuOm9hc2lzOm5hbWVzOnRjOmVieG1sLXJlZ3JlcDp4c2Q6cnM6My4wIiB4bWxuczpuczc9InVybjppaGU6aXRpOnJtZDoyMDE3IiB4bWxuczpuczI9InVybjppaGU6aXRpOnhkcy1iOjIwMDciIHhtbG5zOm5zND0idXJuOm9hc2lzOm5hbWVzOnRjOmVieG1sLXJlZ3JlcDp4c2Q6cmltOjMuMCIgeG1sbnM6bnMzPSJ1cm46aWhlOnJhZDp4ZHNpLWI6MjAwOSI+PFJlc3BvbnNlT3B0aW9uIHJldHVyblR5cGU9IkxlYWZDbGFzcyIgcmV0dXJuQ29tcG9zZWRPYmplY3RzPSJ0cnVlIi8+PG5zNDpBZGhvY1F1ZXJ5IGlkPSJ1cm46dXVpZDoxMGI1NDVlYS03MjVjLTQ0NmQtOWI5NS04YWViNDQ0ZWRkZjMiPjxuczQ6U2xvdCBuYW1lPSIkcGF0aWVudElkIj48bnM0OlZhbHVlTGlzdD48bnM0OlZhbHVlPidkNWU0MmZlZC01OTYyLTRiYjktYjhiNi01ZDllOGFmYjBmMmFeXl4mYW1wOzEuMy42LjEuNC4xLjIxMzY3LjIwMTcuMi41LjkzJmFtcDtJU08nPC9uczQ6VmFsdWU+PC9uczQ6VmFsdWVMaXN0PjwvbnM0OlNsb3Q+PG5zNDpTbG90IG5hbWU9IiRYRFNEb2N1bWVudEVudHJ5U3RhdHVzIj48bnM0OlZhbHVlTGlzdD48bnM0OlZhbHVlPigndXJuOm9hc2lzOm5hbWVzOnRjOmVieG1sLXJlZ3JlcDpTdGF0dXNUeXBlOkFwcHJvdmVkJyk8L25zNDpWYWx1ZT48bnM0OlZhbHVlPigndXJuOm9hc2lzOm5hbWVzOnRjOmVieG1sLXJlZ3JlcDpTdGF0dXNUeXBlOkRlcHJlY2F0ZWQnKTwvbnM0OlZhbHVlPjwvbnM0OlZhbHVlTGlzdD48L25zNDpTbG90PjxuczQ6U2xvdCBuYW1lPSIkWERTRm9sZGVyU3RhdHVzIj48bnM0OlZhbHVlTGlzdD48bnM0OlZhbHVlPigndXJuOm9hc2lzOm5hbWVzOnRjOmVieG1sLXJlZ3JlcDpTdGF0dXNUeXBlOkFwcHJvdmVkJyk8L25zNDpWYWx1ZT48L25zNDpWYWx1ZUxpc3Q+PC9uczQ6U2xvdD48bnM0OlNsb3QgbmFtZT0iJFhEU1N1Ym1pc3Npb25TZXRTdGF0dXMiPjxuczQ6VmFsdWVMaXN0PjxuczQ6VmFsdWU+KCd1cm46b2FzaXM6bmFtZXM6dGM6ZWJ4bWwtcmVncmVwOlN0YXR1c1R5cGU6QXBwcm92ZWQnKTwvbnM0OlZhbHVlPjwvbnM0OlZhbHVlTGlzdD48L25zNDpTbG90PjxuczQ6U2xvdCBuYW1lPSIkWERTRG9jdW1lbnRFbnRyeVR5cGUiPjxuczQ6VmFsdWVMaXN0PjxuczQ6VmFsdWU+KCd1cm46dXVpZDozNDI2OGU0Ny1mZGY1LTQxYTYtYmEzMy04MjEzM2M0NjUyNDgnKTwvbnM0OlZhbHVlPjxuczQ6VmFsdWU+KCd1cm46dXVpZDo3ZWRjYTgyZi0wNTRkLTQ3ZjItYTAzMi05YjJhNWI1MTg2YzEnKTwvbnM0OlZhbHVlPjwvbnM0OlZhbHVlTGlzdD48L25zNDpTbG90PjwvbnM0OkFkaG9jUXVlcnk+PC9BZGhvY1F1ZXJ5UmVxdWVzdD4=&lt;/ParticipantObjectQuery&gt;\n    &lt;ParticipantObjectDetail type=\"QueryEncoding\" value=\"VVRGLTg=\" /&gt;\n    &lt;ParticipantObjectDetail type=\"urn:ihe:iti:xca:2010:homeCommunityId\" value=\"MS4zLjYuMS40LjEuMjEzNjcuMjAxNy4yLjYuMTk=\" /&gt;\n  &lt;/ParticipantObjectIdentification&gt;\n&lt;/AuditMessage&gt;\n</code></pre> <p>The message is made of the following blocks:</p> <ul> <li>EventIdentification: Event related information including the timestamp.</li> <li>ActiveParticipant: Information related to the portal or primary system performing the query.</li> <li>ActiveParticipant: Information on the authenticated user as required by IHE XUA profile.</li> <li>ActiveParticipant: Information on the authenticated user including the user name who initiated the request.</li> <li>ActiveParticipant: Information on the responding service endpoint.</li> <li>AuditSourceIdentification: Information related to the primary system performing the query.</li> <li>ParticipantObjectIdentification: Request message related information including a BASE-64 encoded copy of the query.</li> <li>ParticipantObjectIdentification: Information on the patients EPR accessed.</li> </ul>"},{"location":"RegistryStoredQuery/#security-requirements","title":"Security Requirements","text":"<p>To ensure privacy the transaction must be secured using https with mutual authentication, using X.509 certificates (extended validation required) and client and server side certificate validation.</p> <p>To enable authorization, the transaction must convey the XUA Assertion for authorization in the security header of the SOAP envelope. See Provide X-User Assertion for the implementation details.</p> <p>Note</p> <ul> <li>Some test environments dropped the mutual authentication or TLS for testing purposes. Please contact your test system provider on the details.</li> <li>Some test environments may also drop authorization for testing purposes. Please contact your test system provider on the details.  </li> </ul>"},{"location":"RegistryStoredQuery/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment, test systems of the EPR communities or the EPR Playground.</p>"},{"location":"RetrieveDocumentSet/","title":"Retrieve Document Set","text":"<p>Transaction to retrieve one or more documents from a community. Primary systems shall use this transaction to read documents from the EPR and integrate to the primary system or to display the document in the UI.   </p>"},{"location":"RetrieveDocumentSet/#overview","title":"Overview","text":"<p>Primary systems shall use this transaction to retrieve documents from a patients EPR. In the Swiss EPR the IHE XDS.b profile and transactions shall be used.</p> <p>To retrieve the document metadata of the document, the the primary system shall perform a Retrieve Document Set [ITI-43] transaction. Within the request, the primary systems shall provide the master patient ID as retrieved from the PIX Query, and the repository as well as the documents unique IDs taken from the response of the Registry Stored Query. In the Swiss EPR currently only supports the synchronous exchange option is supported.    </p> <p>The community responds the set of documents.</p>"},{"location":"RetrieveDocumentSet/#transaction","title":"Transaction","text":""},{"location":"RetrieveDocumentSet/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in the ebXML standard with restrictions defined in the IHE profile and the ordinances to the Swiss EPR.</p>"},{"location":"RetrieveDocumentSet/#request-message","title":"Request Message","text":"<p>The following snippet displays a sample request recorded during the EPR projectathon in September 2020, with abrevations to increase readability. The raw request file may be found here.</p> <p>The request message shall be a XML SOAP envelope with the query embedded in the Body element of the SOAP envelope. The SOAP Header element conveys the following information:</p> <ul> <li>To element: The URL of the repository service.</li> <li>MessageID element: a UUID of the message.</li> <li>Action element: The SOAP action identifier of the query as defined in the IHE ITI Technical Framework.</li> <li>Security element: The Web Service Security header as defined in the WS Security specification. This element conveys the XUA Assertion used for authorization (see Provide X-User Assertion).  </li> </ul> <p>The SOAP Body element conveys the ebXML RetrieveDocumentSetRequest which shall convey 1..N DocumentRequest elements (lines 12 to 16 below) with the following information:</p> <ul> <li>HomeCommunityId : Unique ID of the community.</li> <li>RepositoryUniqueId: Unique ID of repository taken from a Registry Stored Query response.</li> <li>DocumentUniqueId: Unique ID of the document taken from a Registry Stored Query response.</li> </ul> ITI-43_request.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;soapenv:Envelope xmlns=\" !-- namespaces omitted -- \"&gt;\n  &lt;soapenv:Header&gt;\n    &lt;wsa:To soapenv:mustUnderstand=\"1\"&gt;https://epd-test.com/Repository/services/RepositoryService&lt;/wsa:To&gt;\n    &lt;wsa:MessageID soapenv:mustUnderstand=\"1\"&gt;urn:uuid:1EB10F67-6562-46D5-9B6B-5DC42EB2B4A6&lt;/wsa:MessageID&gt;\n    &lt;wsa:Action soapenv:mustUnderstand=\"1\"&gt;urn:ihe:iti:2007:RetrieveDocumentSet&lt;/wsa:Action&gt;\n    &lt;wsse:Security&gt;\n      &lt;saml2:Assertion&gt; &lt;!-- XUA assertion omitted --&gt;&lt;/saml2:Assertion&gt;\n    &lt;/wsse:Security&gt;\n  &lt;/soapenv:Header&gt;\n  &lt;soapenv:Body&gt;\n    &lt;xsdb:RetrieveDocumentSetRequest&gt;\n      &lt;xsdb:DocumentRequest&gt;\n        &lt;xsdb:HomeCommunityId&gt;urn:oid:1.3.6.1.4.1.21367.2017.2.6.19&lt;/xsdb:HomeCommunityId&gt;\n        &lt;xsdb:RepositoryUniqueId&gt;1.3.6.1.4.1.21367.2017.2.3.54&lt;/xsdb:RepositoryUniqueId&gt;\n        &lt;xsdb:DocumentUniqueId&gt;1.3.6.1.4.1.21367.2017.2.1.75.20200922130227623&lt;/xsdb:DocumentUniqueId&gt;\n      &lt;/xsdb:DocumentRequest&gt;\n    &lt;/xsdb:RetrieveDocumentSetRequest&gt;\n  &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre>"},{"location":"RetrieveDocumentSet/#response-message","title":"Response Message","text":"<p>The following snippet displays a sample response recorded during the EPR projectathon in September 2020, with abrevations to increase readability. The raw request file may be found here.</p> <p>The SOAP Header element of the response conveys the following information:</p> <ul> <li>Action element: The SOAP action identifier of the response as defined in the IHE ITI Technical Framework.</li> <li>RelatesTo element: The messageID of the request (see above).  </li> </ul> ITI-43_response.xml<pre><code>&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;soapenv:Envelope xmlns:soapenv=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n  &lt;soapenv:Header xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n    &lt;wsa:Action&gt;urn:ihe:iti:2007:RetrieveDocumentSetResponse&lt;/wsa:Action&gt;\n    &lt;wsa:RelatesTo&gt;urn:uuid:1EB10F67-6562-46D5-9B6B-5DC42EB2B4A6&lt;/wsa:RelatesTo&gt;\n  &lt;/soapenv:Header&gt;\n  &lt;soapenv:Body&gt;\n    &lt;ns3:RetrieveDocumentSetResponse xmlns=\" !-- namespaces omitted -- \"&gt;\n      &lt;ns6:RegistryResponse status=\"urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success\"/&gt;\n      &lt;ns3:DocumentResponse&gt;\n        &lt;ns3:HomeCommunityId&gt;urn:oid:1.3.6.1.4.1.21367.2017.2.6.19&lt;/ns3:HomeCommunityId&gt;\n        &lt;ns3:RepositoryUniqueId&gt;1.3.6.1.4.1.21367.2017.2.3.54&lt;/ns3:RepositoryUniqueId&gt;\n        &lt;ns3:DocumentUniqueId&gt;1.3.6.1.4.1.21367.2017.2.1.75.20200922130227623&lt;/ns3:DocumentUniqueId&gt;\n        &lt;ns3:mimeType&gt;application/pdf&lt;/ns3:mimeType&gt;\n        &lt;ns3:Document xmlns:xop=\"http://www.w3.org/2004/08/xop/include\"&gt;\n          &lt;xop:Include href=\"cid:72f7c587daaacb8b81212de4e80e442e5f43394482e12edd@apache.org\"/&gt;\n        &lt;/ns3:Document&gt;\n      &lt;/ns3:DocumentResponse&gt;\n    &lt;/ns3:RetrieveDocumentSetResponse&gt;\n  &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre> <p>The SOAP Body element conveys the ebXML RetrieveDocumentSetResponse which conveys 1..N DocumentResponse elements (lines 9 to 17 below) with the following information:</p> <ul> <li>HomeCommunityId : Unique ID of the community.</li> <li>RepositoryUniqueId: Unique ID of repository.</li> <li>DocumentUniqueId: Unique ID of the document.</li> <li>Document element (line 14 to 16): It's Include element conveys the content-id reference of the attached document in the MTOM response (see below).</li> </ul>"},{"location":"RetrieveDocumentSet/#transport-protocol","title":"Transport Protocol","text":"<p>The system shall send the request messages to the repository service of the community using the MIME Multipart/Related binding as specified in the SOAP MTOM specification of the W3C.</p> <p>The repository responds the documents using the MIME Multipart/Related binding as specified in the SOAP MTOM specification of the W3C. A full message may look like:</p> <pre><code>DefaultHttpResponse(chunked: false)\nHTTP/1.1 200 OK\nConnection: Keep-Alive\nContent-Length: nnnn  \nContent-Type: multipart/related; boundary=MIMEBoundary4A7AE55984E7438034;type=\"application/xop+xml\"; start=\"&lt;0.09BC7F4BE2E4D3EF1B@apache.org&gt;\";start-info=\"text/xml; charset=utf-8\"\n\n--MIMEBoundary4A7AE55984E7438034\ncontent-type: application/xop+xml; charset=utf-8; type=\"application/soap+xml;\"\ncontent-transfer-encoding: binary\ncontent-id: &lt;0.09BC7F4BE2E4D3EF1B@apache.org&gt;\n\n&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;soapenv:Envelope xmlns:soapenv=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n  &lt;soapenv:Header xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"&gt;\n    &lt;wsa:Action&gt;urn:ihe:iti:2007:RetrieveDocumentSetResponse&lt;/wsa:Action&gt;\n    &lt;wsa:RelatesTo&gt;urn:uuid:1EB10F67-6562-46D5-9B6B-5DC42EB2B4A6&lt;/wsa:RelatesTo&gt;\n  &lt;/soapenv:Header&gt;\n  &lt;soapenv:Body&gt;\n    &lt;ns3:RetrieveDocumentSetResponse xmlns=\" !-- namespaces omitted -- \"&gt;\n      &lt;ns6:RegistryResponse status=\"urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success\"/&gt;\n      &lt;ns3:DocumentResponse&gt;\n        &lt;ns3:HomeCommunityId&gt;urn:oid:1.3.6.1.4.1.21367.2017.2.6.19&lt;/ns3:HomeCommunityId&gt;\n        &lt;ns3:RepositoryUniqueId&gt;1.3.6.1.4.1.21367.2017.2.3.54&lt;/ns3:RepositoryUniqueId&gt;\n        &lt;ns3:DocumentUniqueId&gt;1.3.6.1.4.1.21367.2017.2.1.75.20200922130227623&lt;/ns3:DocumentUniqueId&gt;\n        &lt;ns3:mimeType&gt;application/pdf&lt;/ns3:mimeType&gt;\n        &lt;ns3:Document xmlns:xop=\"http://www.w3.org/2004/08/xop/include\"&gt;\n          &lt;xop:Include href=\"cid:72f7c587daaacb8b81212de4e80e442e5f43394482e12edd@apache.org\"/&gt;\n        &lt;/ns3:Document&gt;\n      &lt;/ns3:DocumentResponse&gt;\n    &lt;/ns3:RetrieveDocumentSetResponse&gt;\n  &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n\n--MIMEBoundary4A7AE55984E7438034\ncontent-type: application/octet-stream\ncontent-transfer-encoding: binary\ncontent-id: &lt;72f7c587daaacb8b81212de4e80e442e5f43394482e12edd@apache.org&gt;\n\n!-- Binary Data omitted --\n\n--MIMEBoundary4A7AE55984E7438034--\n</code></pre>"},{"location":"RetrieveDocumentSet/#audit-log","title":"Audit Log","text":"<p>Primary systems shall store syslog messages to the audit record repository of the community using TLS transport protocol. The audit message uses XML formatting as specified in RFC 3881 with restrictions specified in the IHE ITI TF and the Extension 1 to Annex5 in the ordinances of the Swiss electronic patient record (see Section 1.5 \"Requirements on ATNA\").  </p> <p>The following snippet shows a example audit message to be written by the primary system:</p> iti-43-log.xml<pre><code>&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;AuditMessage&gt;\n &lt;EventIdentification EventActionCode=\"C\" EventDateTime=\"2020-06-04T10:54:39.571Z\" EventOutcomeIndicator=\"0\"&gt;\n  &lt;EventID csd-code=\"110107\" codeSystemName=\"DCM\" originalText=\"Import\"/&gt;\n  &lt;EventTypeCode csd-code=\"ITI-43\" codeSystemName=\"IHE Transactions\" originalText=\"Retrieve Document Set\"/&gt;\n  &lt;PurposeOfUse csd-code=\"NORM\" codeSystemName=\"2.16.756.5.30.1.127.3.10.5\" originalText=\"Normal\"/&gt;\n &lt;/EventIdentification&gt;\n &lt;ActiveParticipant UserID=\"pma@gnt.com\" UserName=\"JD&amp;lt;pma@gnt.com&amp;gt;\"/&gt;\n &lt;ActiveParticipant UserID=\"2000000090108\" UserName=\"Dr. med. John Doe\" UserIsRequestor=\"true\"&gt;\n  &lt;RoleIDCode csd-code=\"HCP\" codeSystemName=\"2.16.756.5.30.1.127.3.10.6\" originalText=\"Healthcare professional\"/&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant UserID=\"https://repositoryService.com\" AlternativeUserID=\"1\" UserIsRequestor=\"false\" NetworkAccessPointID=\"172.18.0.49\" NetworkAccessPointTypeCode=\"2\"&gt;\n  &lt;RoleIDCode csd-code=\"110153\" codeSystemName=\"DCM\" originalText=\"Source Role ID\"/&gt;\n &lt;/ActiveParticipant&gt;\n &lt;ActiveParticipant UserID=\"https://primarySystem.com\" AlternativeUserID=\"UNKNOWN\" UserIsRequestor=\"true\" NetworkAccessPointID=\"hcohcdemo01-app06-icwpxs01.net.swisscom-health.it\" NetworkAccessPointTypeCode=\"1\"&gt;\n  &lt;RoleIDCode csd-code=\"110152\" codeSystemName=\"DCM\" originalText=\"Destination Role ID\"/&gt;\n &lt;/ActiveParticipant&gt;\n &lt;AuditSourceIdentification AuditEnterpriseSiteID=\"2.16.756.5.30.1.194\" AuditSourceID=\"LE-Portal\"&gt;\n  &lt;AuditSourceTypeCode csd-code=\"9\" codeSystemName=\"DCM\" originalText=\"Other\"/&gt;\n &lt;/AuditSourceIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"761337615343338300^^^&amp;amp;2.16.756.5.30.1.127.3.10.3&amp;amp;ISO\" ParticipantObjectTypeCode=\"1\" ParticipantObjectTypeCodeRole=\"1\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"2\" codeSystemName=\"RFC-3881\" originalText=\"Patient Number\"/&gt;\n &lt;/ParticipantObjectIdentification&gt;\n &lt;ParticipantObjectIdentification ParticipantObjectID=\"2.16.756.5.30.1.194.130880.1591258526941\" ParticipantObjectTypeCode=\"2\" ParticipantObjectTypeCodeRole=\"3\"&gt;\n  &lt;ParticipantObjectIDTypeCode csd-code=\"9\" codeSystemName=\"RFC-3881\" originalText=\"Report Number\"/&gt;\n  &lt;ParticipantObjectDetail type=\"Repository Unique Id\" value=\"Mi4xNi43NTYuNS4zMC4xLjE5NC4zLjMuMQ==\"/&gt;\n  &lt;ParticipantObjectDetail type=\"ihe:homeCommunityID\" value=\"dXJuOm9pZDoyLjE2Ljc1Ni41LjMwLjEuMTk0\"/&gt;\n &lt;/ParticipantObjectIdentification&gt;\n&lt;/AuditMessage&gt;\n</code></pre> <p>The message is made of the following blocks:</p> <ul> <li>EventIdentification: Event related information including the timestamp and purpose of use (line 3 .. 7).</li> <li>ActiveParticipant: Information related to the primary system performing the query (line 8 .. 10).</li> <li>ActiveParticipant: Information on the user initiating the transaction (line 11 .. 13).</li> <li>ActiveParticipant: Additional information on the user initiating the transaction (line 14 .. 16).</li> <li>ActiveParticipant: Information on the responding service endpoint (line 17 .. 19).</li> <li>AuditSourceIdentification: Information related to the primary system performing the query (line 20 .. 22).</li> <li>ParticipantObjectIdentification: Additional information on the patient local ID (line 23 .. 25).</li> <li>ParticipantObjectIdentification: Request message related information (line 26 .. 30).</li> <li>ParticipantObjectIdentification: Information on the patients EPR accessed (line 31 .. 33).</li> </ul>"},{"location":"RetrieveDocumentSet/#security-requirements","title":"Security Requirements","text":"<p>To ensure privacy the transaction must be secured using https with mutual authentication, with X.509 certificates (extended validation required) and client and server side certificate validation.</p> <p>To enable authorization, the transaction must convey the XUA Assertion for authorization in the security header of the SOAP envelope. See Provide X-User Assertion for the implementation details.</p> <p>Note</p> <ul> <li>Some test environments dropped the mutual authentication or TLS for testing purposes. Please contact your test system provider on the details.</li> <li>Some test environments may also drop authorization for testing purposes. Please contact your test system provider on the details.  </li> </ul>"},{"location":"RetrieveDocumentSet/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the test suite of the EPR reference environment, test systems of the EPR communities or the EPR Playground.</p>"},{"location":"SSOLogout/","title":"SSO Logout","text":"<p>Transaction to log out a user from the IdP and all session participants. Primary systems shall perform this transaction to notify the IdP, when a user logs out, or to receive a notification from the IdP, when the user logged out from another application sharing the same IdP session.</p>"},{"location":"SSOLogout/#overview","title":"Overview","text":"<p>Primary systems shall perform this transaction to notify the IdP, when a user logs out, or to receive a notification from the IdP, when the user logged from another relying party sharing the same session.</p>"},{"location":"SSOLogout/#transaction","title":"Transaction","text":""},{"location":"SSOLogout/#message-semantics","title":"Message Semantics","text":"<p>Messages are encoded as described in Assertions and Protocols for the OASIS Security Assertion Markup Language (SAML) V2.0 and the ordinances to the Swiss EPR.</p>"},{"location":"SSOLogout/#request-message","title":"Request Message","text":"<p>The following snippet shows the content of a logout request, with some elements omitted to increase readability.</p> <p>The major content (lines 9..32) of the message is required for to sign the message compliant with the SAML 2.0 specification. Apart from that, the message conveys the following information:</p> <ul> <li>ID: A unique ID of the request message (line 4).</li> <li>Destination: An identifier of the receiver endpoint. For primary systems sending the request, this shall be the URL of IdP logout endpoint (line 7).</li> <li>NameID: The electronic ID used to authenticate the user (line 33). It's value shall match the value provided in the IdP Assertion (see Authenticate User).</li> <li>SessionIndex: The unique ID of the session used to identify all systems sharing the same session. It's value shall match the Session Index provided in the IdP Assertion (see Authenticate User).  </li> </ul> 2_Logout Request.xml<pre><code>&lt;samlp:LogoutRequest\n    xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"\n    xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\"\n    ID=\"pfxd4d369e8-9ea1-780c-aff8-a1d11a9862a1\"\n    Version=\"2.0\"\n    IssueInstant=\"2020-07-18T01:13:06Z\"\n    Destination=\"http://idp.example.com/SSOLogoutService\"&gt;\n    &lt;saml:Issuer&gt;http://sp.application.com&lt;/saml:Issuer&gt;\n    &lt;ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n        &lt;ds:SignedInfo&gt;\n            &lt;ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n            &lt;ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/&gt;\n            &lt;ds:Reference URI=\"#pfxd4d369e8-9ea1-780c-aff8-a1d11a9862a1\"&gt;\n                &lt;ds:Transforms&gt;\n                    &lt;ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n                    &lt;ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n                &lt;/ds:Transforms&gt;\n                &lt;ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/&gt;\n                &lt;ds:DigestValue&gt;Q9PRlugQZKSBt+Ed9i6bKUGWND0=&lt;/ds:DigestValue&gt;\n            &lt;/ds:Reference&gt;\n        &lt;/ds:SignedInfo&gt;\n        &lt;ds:SignatureValue&gt;\n            &lt;!-- omitted for brevity --&gt;\n        &lt;/ds:SignatureValue&gt;\n        &lt;ds:KeyInfo&gt;\n            &lt;ds:X509Data&gt;\n                &lt;ds:X509Certificate&gt;\n                    &lt;!-- omitted for brevity --&gt;\n                &lt;/ds:X509Certificate&gt;\n            &lt;/ds:X509Data&gt;\n        &lt;/ds:KeyInfo&gt;\n    &lt;/ds:Signature&gt;\n    &lt;saml:NameID SPNameQualifier=\"http://sp.application.com\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\"&gt;IdP_User_ID_f92cc183&lt;/saml:NameID&gt;\n    &lt;saml:SessionIndex&gt;bdfe3302-3ed8-11eb-b378-0242ac130002&lt;/saml:SessionIndex&gt;\n&lt;/samlp:LogoutRequest&gt;\n</code></pre>"},{"location":"SSOLogout/#response-message","title":"Response Message","text":"<p>The following snippet shows the content of a logout response, with some elements omitted to increase readability.</p> <p>The major content (lines 9..32) of the message is required for to sign the message compliant with the SAML 2.0 specification. Apart from that, the message conveys the following information:</p> <ul> <li>ID: A unique ID of the request message (line 4).</li> <li>Destination: An identifier of the receiver endpoint as URL (line 7).</li> <li>InResponseTo: The unique ID of the initial request (line 8).</li> <li>Status: The return status of the request, indicating success or failure (line 34 .. 36).</li> </ul> 2_Logout Response.xml<pre><code>&lt;samlp:LogoutResponse\n    xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"\n    xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\"\n    ID=\"pfxe335499f-e73b-80bd-60c4-1628984aed4f\"\n    Version=\"2.0\"\n    IssueInstant=\"2020-07-18T01:13:06Z\"\n    Destination=\"http://sp.example.com/demo1/index.php?acs\"\n    InResponseTo=\"pfxd4d369e8-9ea1-780c-aff8-a1d11a9862a1\"&gt;\n    &lt;saml:Issuer&gt;http://idp.example.com/SSOLogoutService&lt;/saml:Issuer&gt;\n    &lt;ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n        &lt;ds:SignedInfo&gt;\n            &lt;ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n            &lt;ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/&gt;\n            &lt;ds:Reference URI=\"#pfxe335499f-e73b-80bd-60c4-1628984aed4f\"&gt;\n                &lt;ds:Transforms&gt;\n                    &lt;ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n                    &lt;ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n                &lt;/ds:Transforms&gt;\n                &lt;ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/&gt;\n                &lt;ds:DigestValue&gt;PusFPAn+RUZV+fBvwPffNMOENwE=&lt;/ds:DigestValue&gt;\n            &lt;/ds:Reference&gt;\n        &lt;/ds:SignedInfo&gt;\n        &lt;ds:SignatureValue&gt;\n            &lt;!-- omitted for brevity --&gt;\n        &lt;/ds:SignatureValue&gt;\n        &lt;ds:KeyInfo&gt;\n            &lt;ds:X509Data&gt;\n                &lt;ds:X509Certificate&gt;\n                    &lt;!-- omitted for brevity --&gt;\n                &lt;/ds:X509Certificate&gt;\n            &lt;/ds:X509Data&gt;\n        &lt;/ds:KeyInfo&gt;\n    &lt;/ds:Signature&gt;\n    &lt;samlp:Status&gt;\n        &lt;samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/&gt;\n    &lt;/samlp:Status&gt;\n&lt;/samlp:LogoutResponse&gt;\n</code></pre>"},{"location":"SSOLogout/#transport-protocol","title":"Transport Protocol","text":"<p>The LogoutRequest may be send by primary systems to the IdP using one of the following bindings:</p> <ul> <li>SAML 2.0 HTTP POST binding via the frontchannel (involving the browser).</li> <li>SAML 2.0 SOAP binding via the backchannel.</li> </ul>"},{"location":"SSOLogout/#audit-log","title":"Audit Log","text":"<p>Primary systems shall protocol the transaction in their logs to ensure traceability. No further requirements are defined in the ordinances of the Swiss EPR.</p>"},{"location":"SSOLogout/#security-requirements","title":"Security Requirements","text":"<p>Communication via the SOAP backchannel shall be secured with TLS and mutual authentication, using client and server certificate validation. The certificates used, shall be exchanged during the client registration process.  </p> <p>Communication via the frontchannel (involving the browser) shall be secured with HTTPS and mutual authentication, using server certificate validation.  </p>"},{"location":"SSOLogout/#test-opportunity","title":"Test Opportunity","text":"<p>The transaction can be tested with the Gazelle test suite of the EPR reference environment, or test systems of the EPR communities. </p>"},{"location":"gazelle/","title":"EPR Reference Environment","text":"<p>The EPR Reference Environment is a public available test environment which is also used for the Swiss projectathon. Vendors of primary systems can use the EPR Reference Environment for isolated tests (no peer) of the EPR confomal transactions and exchange formats.</p> <p>While the EPR Reference Environment provides a rich coverage of no peer tests to verify the EPR compliance, the no peer tests have limited support for data exchange in real use cases (e.g., echange of document between different primary systems).</p> <p>The EPR reference environment is currently available with the URL EPR reference environment.   </p>"},{"location":"playground/","title":"EPR Playground","text":"<p>The EPR Playground is a sponsored project provided by the BfH Medizininformtik in Biel to provide a testbed for the implementation of Use Cases on the Swiss EPR. It provides the components and actors of a typical EPR community it-infrastructure with a focus on patient management and document sharing.   </p> <p>The characteristics of the EPR Playground are:</p> <ul> <li>no registration required. Knowing the endpoints is all you need to connect to the EPR Playground.</li> <li>mTLS authentication is not required. The endpoints can be accessed without exchanging X.509 certificates.</li> <li>Authoritzation is deactivaed to lower the gap and complexity of Use Cases.</li> </ul>"},{"location":"playground/#endpoint-urls","title":"Endpoint URLs","text":"<p>Forther information on the EPR Playground is available on the Wiki Pages.</p> <p>For the list of supported interfaces and their endpoint URL please checkout the Endpoints and Transaction page of the EPR playground.</p>"}]}